!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("@ngrx/store"),require("rxjs/operators"),require("@angular/common/http"),require("@soushians/user"),require("@soushians/shared"),require("@angular/common"),require("@angular/router"),require("@angular/forms"),require("@ngrx/effects"),require("@angular/material"),require("@angular/flex-layout"),require("@soushians/grid")):"function"==typeof define&&define.amd?define("@soushians/page",["exports","@angular/core","rxjs","@ngrx/store","rxjs/operators","@angular/common/http","@soushians/user","@soushians/shared","@angular/common","@angular/router","@angular/forms","@ngrx/effects","@angular/material","@angular/flex-layout","@soushians/grid"],e):e((t.soushians=t.soushians||{},t.soushians.page={}),t.ng.core,t.rxjs,null,t.rxjs.operators,t.ng.common.http,null,null,t.ng.common,t.ng.router,t.ng.forms,null,t.ng.material,t.ng["flex-layout"],null)}(this,function(t,e,o,n,i,r,a,s,u,c,p,f,d,l,y){"use strict";var h=function(){return(h=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function g(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a}function m(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function v(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}var P,E={env:{production:!1,frontend_server:"frontend_server/did/not/set"},endpoints:{upsert:"/api/page","delete":"/api/page/${model._id}",find:"/api/page",get:"/api/page/${model.name}"}},b=new e.InjectionToken("PageModuleConfig"),x=function(){function t(t,e){this.store=e,this.config$=new o.BehaviorSubject(E),this._config=Object.assign({},E,t),this.config$.next(this._config)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[b]}]},{type:n.Store}]},t}();!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n}(P||(P={}));var _,A=function(){this.type="[GET_PAGES][API][GetPages] start"},w=function(t){this.payload=t,this.type="[GET_PAGES][API][GetPages] succeed"},G=function(t){this.payload=t,this.type="[GET_PAGES][API][GetPages] failed"};!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n}(_||(_={}));var $,I=function(t){this.payload=t,this.type="[PAGE][API][GetPage] start"},M=function(t){this.payload=t,this.type="[PAGE][API][GetPage] succeed"},R=function(t){this.payload=t,this.type="[PAGE][API][GetPage] failed"};!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n}($||($={}));var j,L=function(t){this.payload=t,this.type="[PAGE][API][DELETE] start"},T=function(t){this.payload=t,this.type="[PAGE][API][DELETE] succeed"},S=function(t){this.payload=t,this.type="[PAGE][API][DELETE] failed"},O=function(t){var e=void 0===t?{}:t,n=e._id,r=e.name,o=e.grid;this._id=n,this.name=r||"",this.grid=o||""};!function(t){var e=function(){function t(t){void 0===t&&(t={}),this.page=new O(t)}return t.prototype.getRequestBody=function(){return this.page},t}();t.Request=e;var n=function(){};t.Response=n}(j||(j={}));var F=function(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] start"},q=function(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] succeed"},k=function(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] failed"},U=function(){function t(t,e,n,r,o){this.http=t,this.store=e,this.configurationService=n,this._location=r,this.userFacadeService=o,this.userId$=this.userFacadeService.getDisplayName().filter(function(t){return t!=undefined})}return t.prototype.get=function(r){var o=this;return this.configurationService.config$.pipe(i.filter(function(t){return""!==t.endpoints.get}),i.take(1),i.combineLatest(this.userId$),i.switchMap(function(t){var e=v(t,2),n=e[0];e[1];return o.http.get(s.stringTemplate(n.env.frontend_server+n.endpoints.get,{name:r}))}),i.map(function(t){return t.Result}))},t.prototype["delete"]=function(e){var n=this;return this.configurationService.config$.pipe(i.filter(function(t){return""!==t.endpoints["delete"]}),i.take(1),i.switchMap(function(t){return n.http["delete"](s.stringTemplate(t.env.frontend_server+t.endpoints["delete"],{_id:e}))}),i.map(function(t){return t.Result}))},t.prototype.getPages=function(){var r=this;return this.configurationService.config$.pipe(i.filter(function(t){return""!=t.endpoints.find}),i.combineLatest(this.userId$),i.switchMap(function(t){var e=v(t,2),n=e[0];e[1];return r.http.get(n.env.frontend_server+n.endpoints.find)}),i.map(function(t){return t.Result}))},t.prototype.upsert=function(t){var r=this,o=new j.Request(t);return this.configurationService.config$.pipe(i.filter(function(t){return""!=t.endpoints.upsert}),i.take(1),i.combineLatest(this.userId$),i.switchMap(function(t){var e=v(t,2),n=e[0];e[1];return r.http.post(n.env.frontend_server+n.endpoints.upsert,o.getRequestBody())}),i.map(function(t){return t.Result}),i.tap(function(){return r._location.back()}))},t.prototype.selectByName=function(e){var n=this,r=new o.BehaviorSubject(undefined);return this.store.select(function(t){return t.pages.db.data}).pipe(i.filter(function(t){return null!=t}),i.map(function(t){return t.find(function(t){return t.name==e})}),i.tap(function(t){null==t&&n.store.dispatch(new I(e))})).subscribe(function(t){return r.next(t)}),r.asObservable()},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:r.HttpClient},{type:n.Store},{type:x},{type:u.Location},{type:a.UserFacadeService}]},t}(),C=function(){function t(t,e,n,r,o){this.store=t,this.service=e,this.route=n,this.resolver=r,this.container=o}return t.prototype.ngOnInit=function(){this._selectPage()},t.prototype._selectPage=function(){var e=this;this.page$=this.route.params.pipe(i.pluck("name"),i.switchMap(function(t){return e.service.selectByName(t)}),i.filter(function(t){return t!=undefined}))},t.decorators=[{type:e.Component,args:[{template:'<div *ngIf="(page$ | async)?.grid">\n    <ngs-grid [oid]="(page$ | async)?.grid"></ngs-grid>\n</div>'}]}],t.ctorParameters=function(){return[{type:n.Store},{type:U},{type:c.ActivatedRoute},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t}(),D=function(){function t(){}return t.decorators=[{type:e.Component,args:[{selector:"page-root",template:"<router-outlet></router-outlet>"}]}],t}(),B=function(){function t(t,e,n){this.store=t,this.route=e,this.service=n,this._init_formgroup()}return t.prototype.upsert=function(){var t=h({},this.formGroup.value);this.store.dispatch(new F(t))},t.prototype.ngOnInit=function(){this._select_page(),this._update_formgroup_base_on_page()},t.prototype._init_formgroup=function(){this.formGroup=new p.FormGroup({_id:new p.FormControl(""),name:new p.FormControl(""),grid:new p.FormControl("")})},t.prototype._select_page=function(){var e=this;this.page$=this.route.params.pipe(i.pluck("name"),i.filter(function(t){return t!=undefined}),i.switchMap(function(t){return e.service.selectByName(t)}),i.filter(function(t){return t!=undefined}))},t.prototype._update_formgroup_base_on_page=function(){var e=this;this.page$.subscribe(function(t){e.formGroup.patchValue(t)})},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center center">\n    <mat-card fxFlex="50">\n        <mat-card-content [formGroup]="formGroup">\n            <mat-form-field>\n                <input type="text" matInput placeholder="نام"  formControlName="name">\n            </mat-form-field>\n        </mat-card-content>\n        <mat-card-actions align="end">\n            <button mat-raised-button color="primary" (click)="upsert()">ثبت</button>\n        </mat-card-actions>\n    </mat-card>\n</div>'}]}],t.ctorParameters=function(){return[{type:n.Store},{type:c.ActivatedRoute},{type:U}]},t}(),N=function(){function t(t){this.store=t,this.pages$=this.store.select(function(t){return t.pages.db.data})}return t.prototype.ngOnInit=function(){this.store.dispatch(new A)},t.prototype["delete"]=function(t){this.store.dispatch(new L(t._id))},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center" fxLayoutGap="25px" class="main-container">\n\n  <div class="content-action">\n    <mat-card class="with-sticky-action">\n      <mat-card-header>\n        <mat-card-title fxLayout="row" fxLayoutGap="5px">\n          <mat-icon>settings_input_component</mat-icon>\n          <span>مدیریت صغحات</span>\n        </mat-card-title>\n        <mat-card-subtitle fxLayout="row" fxLayoutAlign="space-between center">\n          <span>\n            شامل تمامی درخواست‌ها از قبیل دائری، جمع‌آوری و ...\n          </span>\n        </mat-card-subtitle>\n      </mat-card-header>\n\n      <div fxLayout="column" fxLayoutAlign="center" fxLayoutGap="25px">\n        <div fxFlex="100" fxLayout="row wrap" fxLayoutGap="20px">\n          <mat-card class="cards-item" *ngFor="let item of (pages$ | async)" fxFlex="32" fxLayout="row">\n\n            <div fxFlex fxLayoutAlign="start center">\n              <h3> {{item.name}}</h3>\n            </div>\n            <div fxFlex fxLayoutAlign="center center">\n              {{item.type}}\n            </div>\n            <div fxLayout="row">\n              <div fxFlex="nogrow">\n                <a mat-icon-button [routerLink]="[\'../upsert\' , item.name]">\n                  <mat-icon aria-label="edit page">edit</mat-icon>\n                </a>\n              </div>\n\n              <div fxFlex="nogrow">\n                <button mat-icon-button (click)="delete(item)">\n                  <mat-icon aria-label="delete page">delete</mat-icon>\n                </button>\n              </div>\n              <div fxFlex="nogrow">\n                <a mat-icon-button [routerLink]="[\'/page\' , item.name]">\n                  <mat-icon aria-label="edit page">remove_red_eye</mat-icon>\n                </a>\n              </div>\n            </div>\n          </mat-card>\n        </div>\n      </div>\n    </mat-card>\n    <div fxLayout="column" class="sticky-action">\n      <a color="primary" mat-mini-fab routerLink="../upsert">\n        <mat-icon>add</mat-icon>\n      </a>\n    </div>\n  </div>\n</div>'}]}],t.ctorParameters=function(){return[{type:n.Store}]},t}(),V=[{path:"pages",component:D,children:[{path:"management",component:N},{path:"upsert",component:B},{path:"upsert/:name",component:B}]},{path:"page/:name",component:C}],H=c.RouterModule.forChild(V),K="[PAGE][DB] UPSERT",z="[PAGE][DB] DELETE",J=function(t){this.payload=t,this.type=K},Q=function(t){this.payload=t,this.type=z},W=function(){function t(t){this.actions$=t,this.Upsert$=this.actions$.ofType("[PAGE][API][GetPage] succeed").pipe(i.pluck("payload"),i.map(function(t){return new J([t])})),this.UpsertMany$=this.actions$.ofType("[GET_PAGES][API][GetPages] succeed").pipe(i.pluck("payload"),i.map(function(t){return new J(t)})),this.delete$=this.actions$.ofType("[PAGE][API][DELETE] succeed").pipe(i.pluck("payload"),i.map(function(t){return new Q(t)}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions}]},g([f.Effect(),m("design:type",Object)],t.prototype,"Upsert$",void 0),g([f.Effect(),m("design:type",Object)],t.prototype,"UpsertMany$",void 0),g([f.Effect(),m("design:type",Object)],t.prototype,"delete$",void 0),t}(),X={data:[]};function Y(t,e){var n;switch(void 0===t&&(t=X),e.type){case K:n=t.data.concat();var r=e.payload;return r instanceof Array||(r=[r],console.error("'PagesActionTypes.UPSERT' does not get array payload")),r.forEach(function(e){var t=n.findIndex(function(t){return t._id==e._id});-1<t?n.splice(t,1,e):n.push(e)}),h({},t,{data:n});case z:n=t.data.concat();var o=t.data.findIndex(function(t){return t._id==e.payload._id});return n.splice(o,1),h({},t,{data:n});default:return t}}var Z={db:Y},tt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[PAGE][API][GetPage] start").pipe(i.map(function(t){return t.payload}),i.switchMap(function(t){return n.service.get(t)}),i.map(function(t){return new M(t)}),i.catchError(function(t){return o.of(new R(t))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:U}]},g([f.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),et=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[GET_PAGES][API][GetPages] start").pipe(i.switchMap(function(){return n.service.getPages().pipe(i.map(function(t){return new w(t)}),i.catchError(function(t){return o.of(new G(t))}))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:U}]},g([f.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),nt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[UPSERT_PAGE][API][UpsertPage] start").pipe(i.map(function(t){return t.payload}),i.switchMap(function(t){return n.service.upsert(t)}),i.map(function(t){return new q(t)}),i.catchError(function(t){return o.of(new k(t))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:U}]},g([f.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),rt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[PAGE][API][DELETE] start").pipe(i.map(function(t){return t.payload}),i.switchMap(function(t){return n.service["delete"](t)}),i.map(function(t){return new T(t)}),i.catchError(function(t){return o.of(new S(t))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:U}]},g([f.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),ot=function(){function t(){}return t.forRoot=function(t){return{ngModule:it,providers:[{provide:b,useValue:t},x,U]}},t.decorators=[{type:e.NgModule,args:[{imports:[u.CommonModule,c.RouterModule,d.MatInputModule,d.MatFormFieldModule,d.MatCardModule,d.MatButtonModule,d.MatIconModule,d.MatDividerModule,l.FlexLayoutModule,p.FormsModule,p.ReactiveFormsModule,y.NgsGridModule],declarations:[C,N,D,B],exports:[]}]}],t}(),it=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[ot,H,n.StoreModule.forFeature("pages",Z),f.EffectsModule.forFeature([W,tt,et,nt,rt])],exports:[ot]}]}],t}();t.NgsPageModule=ot,t.NgsPageRootModule=it,t.MODULE_DEFAULT_CONFIG=E,t.MODULE_CONFIG_TOKEN=b,t.ɵf=N,t.ɵi=H,t.ɵb=Z,t.ɵk=W,t.ɵj=Y,t.ɵg=D,t.ɵr=rt,t.ɵl=tt,t.ɵn=et,t.ɵp=nt,t.ɵe=x,t.ɵd=U,t.ɵh=B,t.ɵa=C,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-page.umd.min.js.map