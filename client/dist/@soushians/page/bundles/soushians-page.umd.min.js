!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("@ngrx/store"),require("rxjs/operators"),require("@angular/common/http"),require("@soushians/user"),require("@soushians/shared"),require("@angular/common"),require("@angular/router"),require("@angular/forms"),require("@ngrx/effects"),require("@angular/material"),require("@angular/flex-layout"),require("@soushians/grid")):"function"==typeof define&&define.amd?define("@soushians/page",["exports","@angular/core","rxjs","@ngrx/store","rxjs/operators","@angular/common/http","@soushians/user","@soushians/shared","@angular/common","@angular/router","@angular/forms","@ngrx/effects","@angular/material","@angular/flex-layout","@soushians/grid"],e):e((t.soushians=t.soushians||{},t.soushians.page={}),t.ng.core,t.rxjs,null,t.rxjs.operators,t.ng.common.http,null,null,t.ng.common,t.ng.router,t.ng.forms,null,t.ng.material,t.ng["flex-layout"],null)}(this,function(t,e,o,n,a,r,i,u,s,c,p,f,d,l,h){"use strict";var y=function(){return(y=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function g(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;0<=u;u--)(o=t[u])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a}function m(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function v(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(u){o={error:u}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}var P,E={env:{production:!1,frontend_server:"frontend_server/did/not/set"},endpoints:{upsert:"/api/page","delete":"/api/page/${model._id}",find:"/api/page",get:"/api/page/${model.name}"}},b=new e.InjectionToken("PageModuleConfig"),_=function(){function t(t,e){this.store=e,this.config$=new o.BehaviorSubject(E),this._config=Object.assign({},E,t),this.config$.next(this._config)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[b]}]},{type:n.Store}]},t}();!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n}(P||(P={}));var x,A=function(){this.type="[GET_PAGES][API][GetPages] start"},w=function(t){this.payload=t,this.type="[GET_PAGES][API][GetPages] succeed"},G=function(t){this.payload=t,this.type="[GET_PAGES][API][GetPages] failed"};!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n}(x||(x={}));var I,$=function(t){this.payload=t,this.type="[PAGE][API][GetPage] start"},M=function(t){this.payload=t,this.type="[PAGE][API][GetPage] succeed"},R=function(t){this.payload=t,this.type="[PAGE][API][GetPage] failed"};!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n}(I||(I={}));var j,T=function(t){this.payload=t,this.type="[PAGE][API][DELETE] start"},L=function(t){this.payload=t,this.type="[PAGE][API][DELETE] succeed"},S=function(t){this.payload=t,this.type="[PAGE][API][DELETE] failed"},F=function(t){var e=void 0===t?{}:t,n=e._id,r=e.name,o=e.grid;this._id=n,this.name=r||"",this.grid=o||""};!function(t){var e=function(){function t(t){void 0===t&&(t={}),this.page=new F(t)}return t.prototype.getRequestBody=function(){return this.page},t}();t.Request=e;var n=function(){};t.Response=n}(j||(j={}));var O=function(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] start"},q=function(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] succeed"},k=function(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] failed"},U=function(){function t(t,e,n,r,o){this.http=t,this.store=e,this.configurationService=n,this._location=r,this.userFacadeService=o,this.userId$=this.userFacadeService.getDisplayName().filter(function(t){return t!=undefined})}return t.prototype.get=function(o){var i=this;return this.configurationService.config$.pipe(a.filter(function(t){return""!==t.endpoints.get}),a.take(1),a.combineLatest(this.userId$),a.switchMap(function(t){var e=v(t,2),n=e[0],r=e[1];return i.http.get(u.stringTemplate(n.env.frontend_server+n.endpoints.get,{name:o}),{params:{userId:r}})}),a.map(function(t){return t.Result}))},t.prototype["delete"]=function(e){var n=this;return this.configurationService.config$.pipe(a.filter(function(t){return""!==t.endpoints["delete"]}),a.take(1),a.switchMap(function(t){return n.http["delete"](u.stringTemplate(t.env.frontend_server+t.endpoints["delete"],{_id:e}))}),a.map(function(t){return t.Result}))},t.prototype.getPages=function(){var o=this;return this.configurationService.config$.pipe(a.filter(function(t){return""!=t.endpoints.find}),a.combineLatest(this.userId$),a.switchMap(function(t){var e=v(t,2),n=e[0],r=e[1];return o.http.get(n.env.frontend_server+n.endpoints.find,{params:{userId:r}})}),a.map(function(t){return t.Result}))},t.prototype.upsert=function(t){var o=this,i=new j.Request(t);return this.configurationService.config$.pipe(a.filter(function(t){return""!=t.endpoints.upsert}),a.take(1),a.combineLatest(this.userId$),a.switchMap(function(t){var e=v(t,2),n=e[0],r=e[1];return o.http.post(n.env.frontend_server+n.endpoints.upsert,i.getRequestBody(),{params:{userId:r}})}),a.map(function(t){return t.Result}),a.tap(function(){return o._location.back()}))},t.prototype.selectByName=function(e){var n=this,r=new o.BehaviorSubject(undefined);return this.store.select(function(t){return t.pages.db.data}).pipe(a.filter(function(t){return null!=t}),a.map(function(t){return t.find(function(t){return t.name==e})}),a.tap(function(t){null==t&&n.store.dispatch(new $(e))})).subscribe(function(t){return r.next(t)}),r.asObservable()},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:r.HttpClient},{type:n.Store},{type:_},{type:s.Location},{type:i.UserFacadeService}]},t}(),C=function(){function t(t,e,n,r,o){this.store=t,this.service=e,this.route=n,this.resolver=r,this.container=o}return t.prototype.ngOnInit=function(){this._selectPage()},t.prototype._selectPage=function(){var e=this;this.page$=this.route.params.pipe(a.pluck("name"),a.switchMap(function(t){return e.service.selectByName(t)}),a.filter(function(t){return t!=undefined}))},t.decorators=[{type:e.Component,args:[{template:'<div *ngIf="(page$ | async)?.grid">\n    <ngs-grid [oid]="(page$ | async)?.grid"></ngs-grid>\n</div>'}]}],t.ctorParameters=function(){return[{type:n.Store},{type:U},{type:c.ActivatedRoute},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t}(),B=function(){function t(){}return t.decorators=[{type:e.Component,args:[{selector:"page-root",template:"<router-outlet></router-outlet>"}]}],t}(),D=function(){function t(t,e,n){this.store=t,this.route=e,this.service=n,this._init_formgroup()}return t.prototype.upsert=function(){var t=y({},this.formGroup.value);this.store.dispatch(new O(t))},t.prototype.ngOnInit=function(){this._select_page(),this._update_formgroup_base_on_page()},t.prototype._init_formgroup=function(){this.formGroup=new p.FormGroup({_id:new p.FormControl(""),name:new p.FormControl(""),grid:new p.FormControl("")})},t.prototype._select_page=function(){var e=this;this.page$=this.route.params.pipe(a.pluck("name"),a.filter(function(t){return t!=undefined}),a.switchMap(function(t){return e.service.selectByName(t)}),a.filter(function(t){return t!=undefined}))},t.prototype._update_formgroup_base_on_page=function(){var e=this;this.page$.subscribe(function(t){e.formGroup.patchValue(t)})},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center center">\n    <mat-card fxFlex="50">\n        <mat-card-content [formGroup]="formGroup">\n            <mat-form-field>\n                <input type="text" matInput placeholder="نام"  formControlName="name">\n            </mat-form-field>\n        </mat-card-content>\n        <mat-card-actions align="end">\n            <button mat-raised-button color="primary" (click)="upsert()">ثبت</button>\n        </mat-card-actions>\n    </mat-card>\n</div>'}]}],t.ctorParameters=function(){return[{type:n.Store},{type:c.ActivatedRoute},{type:U}]},t}(),N=function(){function t(t){this.store=t,this.pages$=this.store.select(function(t){return t.pages.db.data})}return t.prototype.ngOnInit=function(){this.store.dispatch(new A)},t.prototype["delete"]=function(t){this.store.dispatch(new T(t._id))},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="column" fxLayoutAlign="center" fxLayoutGap="25px">\n  <div fXFlex fxLayout="row">\n    <button  color="primary" mat-mini-fab routerLink="../upsert">\n      <mat-icon>add</mat-icon>\n    </button>\n  </div>\n  <div fxFlex="100" fxLayout="row wrap" fxLayoutGap="20px">\n    <mat-card class="cards-item" *ngFor="let item of (pages$ | async)" fxFlex="32" fxLayout="row">\n\n      <div fxFlex fxLayoutAlign="start center">\n        {{item.name}}\n      </div>\n      <div fxFlex fxLayoutAlign="center center">\n        {{item.type}}\n      </div>\n      <div fxLayout="row" >\n          <div fxFlex="nogrow">\n              <a mat-icon-button [routerLink]="[\'../upsert\' , item.name]">\n                <mat-icon aria-label="edit page">edit</mat-icon>\n              </a>\n            </div>\n    \n        <div fxFlex="nogrow">\n          <button mat-icon-button (click)="delete(item)">\n            <mat-icon aria-label="delete page">delete</mat-icon>\n          </button>\n        </div>\n                <div fxFlex="nogrow">\n          <a mat-icon-button [routerLink]="[\'/page\' , item.name]">\n            <mat-icon aria-label="edit page">remove_red_eye</mat-icon>\n          </a>\n        </div>\n      </div>\n    </mat-card>\n  </div>\n</div>'}]}],t.ctorParameters=function(){return[{type:n.Store}]},t}(),V=[{path:"pages",component:B,children:[{path:"management",component:N},{path:"upsert",component:D},{path:"upsert/:name",component:D}]},{path:"page/:name",component:C}],H=c.RouterModule.forChild(V),K="[PAGE][DB] UPSERT",X="[PAGE][DB] DELETE",z=function(t){this.payload=t,this.type=K},J=function(t){this.payload=t,this.type=X},Q=function(){function t(t){this.actions$=t,this.Upsert$=this.actions$.ofType("[PAGE][API][GetPage] succeed").pipe(a.pluck("payload"),a.map(function(t){return new z([t])})),this.UpsertMany$=this.actions$.ofType("[GET_PAGES][API][GetPages] succeed").pipe(a.pluck("payload"),a.map(function(t){return new z(t)})),this.delete$=this.actions$.ofType("[PAGE][API][DELETE] succeed").pipe(a.pluck("payload"),a.map(function(t){return new J(t)}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions}]},g([f.Effect(),m("design:type",Object)],t.prototype,"Upsert$",void 0),g([f.Effect(),m("design:type",Object)],t.prototype,"UpsertMany$",void 0),g([f.Effect(),m("design:type",Object)],t.prototype,"delete$",void 0),t}(),W={data:[]};function Y(t,e){var n;switch(void 0===t&&(t=W),e.type){case K:n=t.data.concat();var r=e.payload;return r instanceof Array||(r=[r],console.error("'PagesActionTypes.UPSERT' does not get array payload")),r.forEach(function(e){var t=n.findIndex(function(t){return t._id==e._id});-1<t?n.splice(t,1,e):n.push(e)}),y({},t,{data:n});case X:n=t.data.concat();var o=t.data.findIndex(function(t){return t._id==e.payload._id});return n.splice(o,1),y({},t,{data:n});default:return t}}var Z={db:Y},tt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[PAGE][API][GetPage] start").pipe(a.map(function(t){return t.payload}),a.switchMap(function(t){return n.service.get(t)}),a.map(function(t){return new M(t)}),a.catchError(function(t){return o.of(new R(t))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:U}]},g([f.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),et=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[GET_PAGES][API][GetPages] start").pipe(a.switchMap(function(){return n.service.getPages().pipe(a.map(function(t){return new w(t)}),a.catchError(function(t){return o.of(new G(t))}))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:U}]},g([f.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),nt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[UPSERT_PAGE][API][UpsertPage] start").pipe(a.map(function(t){return t.payload}),a.switchMap(function(t){return n.service.upsert(t)}),a.map(function(t){return new q(t)}),a.catchError(function(t){return o.of(new k(t))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:U}]},g([f.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),rt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[PAGE][API][DELETE] start").pipe(a.map(function(t){return t.payload}),a.switchMap(function(t){return n.service["delete"](t)}),a.map(function(t){return new L(t)}),a.catchError(function(t){return o.of(new S(t))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:U}]},g([f.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),ot=function(){function t(){}return t.forRoot=function(t){return{ngModule:it,providers:[{provide:b,useValue:t},_,U]}},t.decorators=[{type:e.NgModule,args:[{imports:[s.CommonModule,c.RouterModule,d.MatInputModule,d.MatFormFieldModule,d.MatCardModule,d.MatButtonModule,d.MatIconModule,l.FlexLayoutModule,p.FormsModule,p.ReactiveFormsModule,h.NgsGridModule],declarations:[C,N,B,D],exports:[]}]}],t}(),it=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[ot,H,n.StoreModule.forFeature("pages",Z),f.EffectsModule.forFeature([Q,tt,et,nt,rt])],exports:[ot]}]}],t}();t.NgsPageModule=ot,t.NgsPageRootModule=it,t.MODULE_DEFAULT_CONFIG=E,t.MODULE_CONFIG_TOKEN=b,t.ɵf=N,t.ɵi=H,t.ɵb=Z,t.ɵk=Q,t.ɵj=Y,t.ɵg=B,t.ɵr=rt,t.ɵl=tt,t.ɵn=et,t.ɵp=nt,t.ɵe=_,t.ɵd=U,t.ɵh=D,t.ɵa=C,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-page.umd.min.js.map