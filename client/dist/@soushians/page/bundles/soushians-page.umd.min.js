!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/material"),require("@angular/flex-layout"),require("@soushians/grid"),require("@angular/common/http"),require("@soushians/user"),require("@soushians/shared"),require("@angular/common"),require("@angular/router"),require("@ngrx/store"),require("@angular/forms"),require("@angular/core"),require("@ngrx/effects"),require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define("@soushians/page",["exports","@angular/material","@angular/flex-layout","@soushians/grid","@angular/common/http","@soushians/user","@soushians/shared","@angular/common","@angular/router","@ngrx/store","@angular/forms","@angular/core","@ngrx/effects","rxjs/operators","rxjs"],e):e((t.soushians=t.soushians||{},t.soushians.page={}),t.ng.material,t.ng["flex-layout"],t.grid,t.ng.common.http,t.user,t.shared,t.ng.common,t.ng.router,t.store,t.ng.forms,t.ng.core,t.effects,t.rxjs.operators,t.rxjs)}(this,function(t,e,n,r,o,i,a,s,c,u,p,f,d,l,y){"use strict";var h=function(){return(h=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function g(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a}function m(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function v(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}var x,P={env:{production:!1,frontend_server:"frontend_server/did/not/set"},endpoints:{upsert:"/api/page","delete":"/api/page/${model._id}",find:"/api/page",get:"/api/page/${model.name}"}},b=new f.InjectionToken("PageModuleConfig"),E=function(){function t(t,e){this.store=e,this.config$=new y.BehaviorSubject(P),this._config=Object.assign({},P,t),this.config$.next(this._config)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.decorators=[{type:f.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:f.Inject,args:[b]}]},{type:u.Store}]},t}();!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function r(){};t.Response=n}(x||(x={}));var A,_=function at(){this.type="[GET_PAGES][API][GetPages] start"},w=function st(t){this.payload=t,this.type="[GET_PAGES][API][GetPages] succeed"},G=function ct(t){this.payload=t,this.type="[GET_PAGES][API][GetPages] failed"};!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function r(){};t.Response=n}(A||(A={}));var $,I=function ut(t){this.payload=t,this.type="[PAGE][API][GetPage] start"},M=function pt(t){this.payload=t,this.type="[PAGE][API][GetPage] succeed"},L=function ft(t){this.payload=t,this.type="[PAGE][API][GetPage] failed"};!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function r(){};t.Response=n}($||($={}));var R,j=function dt(t){this.payload=t,this.type="[PAGE][API][DELETE] start"},F=function lt(t){this.payload=t,this.type="[PAGE][API][DELETE] succeed"},T=function yt(t){this.payload=t,this.type="[PAGE][API][DELETE] failed"},S=function ht(t){var e=void 0===t?{}:t,n=e._id,r=e.name,o=e.grid;this._id=n,this.name=r||"",this.grid=o||""};!function(t){var e=function(){function t(t){void 0===t&&(t={}),this.page=new S(t)}return t.prototype.getRequestBody=function(){return this.page},t}();t.Request=e;var n=function r(){};t.Response=n}(R||(R={}));var O=function gt(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] start"},q=function mt(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] succeed"},k=function vt(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] failed"},U=function(){function t(t,e,n,r,o){this.http=t,this.store=e,this.configurationService=n,this._location=r,this.userFacadeService=o,this.userId$=this.userFacadeService.getDisplayName().pipe(l.filter(function(t){return t!=undefined}))}return t.prototype.get=function(r){var o=this;return this.configurationService.config$.pipe(l.filter(function(t){return""!==t.endpoints.get}),l.take(1),l.combineLatest(this.userId$),l.switchMap(function(t){var e=v(t,2),n=e[0];e[1];return o.http.get(a.stringTemplate(n.env.frontend_server+n.endpoints.get,{name:r}))}),l.map(function(t){return t.Result}))},t.prototype["delete"]=function(e){var n=this;return this.configurationService.config$.pipe(l.filter(function(t){return""!==t.endpoints["delete"]}),l.take(1),l.switchMap(function(t){return n.http["delete"](a.stringTemplate(t.env.frontend_server+t.endpoints["delete"],{_id:e}))}),l.map(function(t){return t.Result}))},t.prototype.getPages=function(){var r=this;return this.configurationService.config$.pipe(l.filter(function(t){return""!=t.endpoints.find}),l.combineLatest(this.userId$),l.switchMap(function(t){var e=v(t,2),n=e[0];e[1];return r.http.get(n.env.frontend_server+n.endpoints.find)}),l.map(function(t){return t.Result}))},t.prototype.upsert=function(t){var r=this,o=new R.Request(t);return this.configurationService.config$.pipe(l.filter(function(t){return""!=t.endpoints.upsert}),l.take(1),l.combineLatest(this.userId$),l.switchMap(function(t){var e=v(t,2),n=e[0];e[1];return r.http.post(n.env.frontend_server+n.endpoints.upsert,o.getRequestBody())}),l.map(function(t){return t.Result}),l.tap(function(){return r._location.back()}))},t.prototype.selectByName=function(e){var n=this,r=new y.BehaviorSubject(undefined);return this.store.select(function(t){return t.pages.db.data}).pipe(l.filter(function(t){return null!=t}),l.map(function(t){return t.find(function(t){return t.name==e})}),l.tap(function(t){null==t&&n.store.dispatch(new I(e))})).subscribe(function(t){return r.next(t)}),r.asObservable()},t.decorators=[{type:f.Injectable}],t.ctorParameters=function(){return[{type:o.HttpClient},{type:u.Store},{type:E},{type:s.Location},{type:i.UserFacadeService}]},t}(),C=function(){function t(t,e,n,r,o){this.store=t,this.service=e,this.route=n,this.resolver=r,this.container=o}return t.prototype.ngOnInit=function(){this._selectPage()},t.prototype._selectPage=function(){var e=this;this.page$=this.route.params.pipe(l.pluck("name"),l.switchMap(function(t){return e.service.selectByName(t)}),l.filter(function(t){return t!=undefined}))},t.decorators=[{type:f.Component,args:[{template:'<div *ngIf="(page$ | async)?.grid">\r\n    <ngs-grid [oid]="(page$ | async)?.grid"></ngs-grid>\r\n</div>'}]}],t.ctorParameters=function(){return[{type:u.Store},{type:U},{type:c.ActivatedRoute},{type:f.ComponentFactoryResolver},{type:f.ViewContainerRef}]},t}(),D=function(){function t(){}return t.decorators=[{type:f.Component,args:[{selector:"page-root",template:"<router-outlet></router-outlet>"}]}],t}(),B=function(){function t(t,e,n){this.store=t,this.route=e,this.service=n,this._init_formgroup()}return t.prototype.upsert=function(){var t=h({},this.formGroup.value);this.store.dispatch(new O(t))},t.prototype.ngOnInit=function(){this._select_page(),this._update_formgroup_base_on_page()},t.prototype._init_formgroup=function(){this.formGroup=new p.FormGroup({_id:new p.FormControl(""),name:new p.FormControl(""),grid:new p.FormControl("")})},t.prototype._select_page=function(){var e=this;this.page$=this.route.params.pipe(l.pluck("name"),l.filter(function(t){return t!=undefined}),l.switchMap(function(t){return e.service.selectByName(t)}),l.filter(function(t){return t!=undefined}))},t.prototype._update_formgroup_base_on_page=function(){var e=this;this.page$.subscribe(function(t){e.formGroup.patchValue(t)})},t.decorators=[{type:f.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center center" class="main-container">\r\n    <mat-card fxFlex="50">\r\n        <mat-card-header>\r\n            <mat-card-title fxLayout="row" fxLayoutGap="5px">\r\n                <mat-icon>receipt</mat-icon>\r\n                <span>ایجاد صفحه جدید</span>\r\n            </mat-card-title>\r\n            <mat-card-subtitle fxLayout="row" fxLayoutAlign="space-between center">\r\n                <span>\r\n                    نام صفحه را وارد نمایید و به مرحله بعد بروید ...\r\n                </span>\r\n            </mat-card-subtitle>\r\n        </mat-card-header>\r\n\r\n        <mat-card-content [formGroup]="formGroup">\r\n            <mat-form-field>\r\n                <input type="text" matInput placeholder="نام" formControlName="name">\r\n            </mat-form-field>\r\n        </mat-card-content>\r\n        <mat-card-actions align="end">\r\n            <button mat-raised-button color="primary" (click)="upsert()">ثبت</button>\r\n        </mat-card-actions>\r\n    </mat-card>\r\n</div>'}]}],t.ctorParameters=function(){return[{type:u.Store},{type:c.ActivatedRoute},{type:U}]},t}(),N=function(){function t(t){this.store=t,this.pages$=this.store.select(function(t){return t.pages.db.data})}return t.prototype.ngOnInit=function(){this.store.dispatch(new _)},t.prototype["delete"]=function(t){this.store.dispatch(new j(t._id))},t.decorators=[{type:f.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center" fxLayoutGap="25px" class="main-container">\r\n\r\n  <div class="content-action">\r\n    <mat-card class="with-sticky-action">\r\n      <mat-card-header>\r\n        <mat-card-title fxLayout="row" fxLayoutGap="5px">\r\n          <mat-icon>list_alt</mat-icon>\r\n          <span>مدیریت صغحات</span>\r\n        </mat-card-title>\r\n        <mat-card-subtitle fxLayout="row" fxLayoutAlign="space-between center">\r\n          <span>\r\n            در این قسمت می‌توانید صغحات با گریدهای دلخواه خود را ایجاد نمایید ...\r\n          </span>\r\n        </mat-card-subtitle>\r\n      </mat-card-header>\r\n\r\n      <div fxLayout="column" fxLayoutAlign="center" fxLayoutGap="25px">\r\n        <div fxFlex="100" fxLayout="row wrap" fxLayoutAlign="start center">\r\n          <mat-card fxFlex.gt-lg="24" fxFlex.lg="32" fxFlex.md="48" fxFlex.sm="100" fxFlex.xs="100" class="link" *ngFor="let item of (pages$ | async)"\r\n            fxFlex="32" fxLayout="row" fxLayoutAlign="center center">\r\n            <div fxFlex fxLayoutAlign="start center">\r\n              <h3> {{item.name}}</h3>\r\n            </div>\r\n            <div fxFlex fxLayoutAlign="center center">\r\n              {{item.type}}\r\n            </div>\r\n            <div fxLayout="row">\r\n              <div fxFlex="nogrow">\r\n                <a mat-icon-button [routerLink]="[\'../upsert\' , item.name]">\r\n                  <mat-icon aria-label="edit page">edit</mat-icon>\r\n                </a>\r\n              </div>\r\n\r\n              <div fxFlex="nogrow">\r\n                <button mat-icon-button (click)="delete(item)">\r\n                  <mat-icon aria-label="delete page">delete</mat-icon>\r\n                </button>\r\n              </div>\r\n              <div fxFlex="nogrow">\r\n                <a mat-icon-button [routerLink]="[\'/page\' , item.name]">\r\n                  <mat-icon aria-label="edit page">remove_red_eye</mat-icon>\r\n                </a>\r\n              </div>\r\n            </div>\r\n          </mat-card>\r\n        </div>\r\n      </div>\r\n    </mat-card>\r\n    <div fxLayout="column" class="sticky-action">\r\n      <a color="primary" mat-mini-fab routerLink="../upsert">\r\n        <mat-icon>add</mat-icon>\r\n      </a>\r\n    </div>\r\n  </div>\r\n</div>',styles:["mat-card.link{padding:25px 15px;margin:.5%;box-sizing:border-box}"]}]}],t.ctorParameters=function(){return[{type:u.Store}]},t}(),V=[{path:"pages",component:D,children:[{path:"management",component:N},{path:"upsert",component:B},{path:"upsert/:name",component:B}]},{path:"page/:name",component:C}],z=c.RouterModule.forChild(V),H="[PAGE][DB] UPSERT",K="[PAGE][DB] DELETE",J=function xt(t){this.payload=t,this.type=H},Q=function Pt(t){this.payload=t,this.type=K},W=function(){function t(t){this.actions$=t,this.Upsert$=this.actions$.ofType("[PAGE][API][GetPage] succeed").pipe(l.pluck("payload"),l.map(function(t){return new J([t])})),this.UpsertMany$=this.actions$.ofType("[GET_PAGES][API][GetPages] succeed").pipe(l.pluck("payload"),l.map(function(t){return new J(t)})),this.delete$=this.actions$.ofType("[PAGE][API][DELETE] succeed").pipe(l.pluck("payload"),l.map(function(t){return new Q(t)}))}return t.decorators=[{type:f.Injectable}],t.ctorParameters=function(){return[{type:d.Actions}]},g([d.Effect(),m("design:type",Object)],t.prototype,"Upsert$",void 0),g([d.Effect(),m("design:type",Object)],t.prototype,"UpsertMany$",void 0),g([d.Effect(),m("design:type",Object)],t.prototype,"delete$",void 0),t}(),X={data:[]};function Y(t,e){var n;switch(void 0===t&&(t=X),e.type){case H:n=t.data.concat();var r=e.payload;return r instanceof Array||(r=[r],console.error("'PagesActionTypes.UPSERT' does not get array payload")),r.forEach(function(e){var t=n.findIndex(function(t){return t._id==e._id});-1<t?n.splice(t,1,e):n.push(e)}),h({},t,{data:n});case K:n=t.data.concat();var o=t.data.findIndex(function(t){return t._id==e.payload._id});return n.splice(o,1),h({},t,{data:n});default:return t}}var Z={db:Y},tt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[PAGE][API][GetPage] start").pipe(l.map(function(t){return t.payload}),l.switchMap(function(t){return n.service.get(t)}),l.map(function(t){return new M(t)}),l.catchError(function(t){return y.of(new L(t))}))}return t.decorators=[{type:f.Injectable}],t.ctorParameters=function(){return[{type:d.Actions},{type:U}]},g([d.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),et=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[GET_PAGES][API][GetPages] start").pipe(l.switchMap(function(){return n.service.getPages().pipe(l.map(function(t){return new w(t)}),l.catchError(function(t){return y.of(new G(t))}))}))}return t.decorators=[{type:f.Injectable}],t.ctorParameters=function(){return[{type:d.Actions},{type:U}]},g([d.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),nt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[UPSERT_PAGE][API][UpsertPage] start").pipe(l.map(function(t){return t.payload}),l.switchMap(function(t){return n.service.upsert(t)}),l.map(function(t){return new q(t)}),l.catchError(function(t){return y.of(new k(t))}))}return t.decorators=[{type:f.Injectable}],t.ctorParameters=function(){return[{type:d.Actions},{type:U}]},g([d.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),rt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[PAGE][API][DELETE] start").pipe(l.map(function(t){return t.payload}),l.switchMap(function(t){return n.service["delete"](t)}),l.map(function(t){return new F(t)}),l.catchError(function(t){return y.of(new T(t))}))}return t.decorators=[{type:f.Injectable}],t.ctorParameters=function(){return[{type:d.Actions},{type:U}]},g([d.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}(),ot=function(){function t(){}return t.forRoot=function(t){return{ngModule:it,providers:[{provide:b,useValue:t},E,U]}},t.decorators=[{type:f.NgModule,args:[{imports:[s.CommonModule,c.RouterModule,e.MatInputModule,e.MatFormFieldModule,e.MatCardModule,e.MatButtonModule,e.MatIconModule,e.MatDividerModule,n.FlexLayoutModule,p.FormsModule,p.ReactiveFormsModule,r.NgsGridModule],declarations:[C,N,D,B],exports:[]}]}],t}(),it=function(){function t(){}return t.decorators=[{type:f.NgModule,args:[{imports:[ot,z,u.StoreModule.forFeature("pages",Z),d.EffectsModule.forFeature([W,tt,et,nt,rt])],exports:[ot]}]}],t}();t.NgsPageModule=ot,t.NgsPageRootModule=it,t.MODULE_DEFAULT_CONFIG=P,t.MODULE_CONFIG_TOKEN=b,t.ɵf=N,t.ɵi=z,t.ɵb=Z,t.ɵk=W,t.ɵj=Y,t.ɵg=D,t.ɵr=rt,t.ɵl=tt,t.ɵn=et,t.ɵp=nt,t.ɵe=E,t.ɵd=U,t.ɵh=B,t.ɵa=C,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-page.umd.min.js.map