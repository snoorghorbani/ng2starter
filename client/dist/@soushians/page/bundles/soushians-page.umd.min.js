!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/material"),require("@angular/flex-layout"),require("@ngrx/store"),require("@angular/router"),require("@ngrx/effects"),require("@soushians/grid"),require("rxjs/operators"),require("rxjs"),require("@angular/common/http"),require("@soushians/user"),require("@soushians/shared"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@soushians/page",["exports","@angular/core","@angular/common","@angular/material","@angular/flex-layout","@ngrx/store","@angular/router","@ngrx/effects","@soushians/grid","rxjs/operators","rxjs","@angular/common/http","@soushians/user","@soushians/shared","@angular/forms"],e):e(((t=t||self).soushians=t.soushians||{},t.soushians.page={}),t.ng.core,t.ng.common,t.ng.material,t.ng["flex-layout"],t.store,t.ng.router,t.effects,t.grid,t.rxjs.operators,t.rxjs,t.ng.common.http,t.user,t.shared,t.ng.forms)}(this,(function(t,e,n,r,o,a,i,s,c,u,p,f,d,l,y){"use strict";var h=function(){return(h=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function g(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i}function m(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function v(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,a=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}var P,x={env:{production:!1,frontend_server:"frontend_server/did/not/set"},endpoints:{upsert:"/api/page",delete:"/api/page/${model._id}",find:"/api/page",get:"/api/page/${model.name}"}},E=new e.InjectionToken("PageModuleConfig"),b=function(){function t(t,e){this.store=e,this.config$=new p.BehaviorSubject(x),this._config=Object.assign({},x,t),this.config$.next(this._config)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[E]}]},{type:a.Store}]},t}();(function(t){var e=function(){function t(t){var e=this;void 0===t&&(t={}),Object.keys(t).forEach((function(n){return e[n]=t[n]}))}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n})(P||(P={}));var _=function(){this.type="[GET_PAGES][API][GetPages] start"};var w=function(t){this.payload=t,this.type="[GET_PAGES][API][GetPages] succeed"};var A,G=function(t){this.payload=t,this.type="[GET_PAGES][API][GetPages] failed"};(function(t){var e=function(){function t(t){var e=this;void 0===t&&(t={}),Object.keys(t).forEach((function(n){return e[n]=t[n]}))}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n})(A||(A={}));var $=function(t){this.payload=t,this.type="[PAGE][API][GetPage] start"};var L=function(t){this.payload=t,this.type="[PAGE][API][GetPage] succeed"};var I,M=function(t){this.payload=t,this.type="[PAGE][API][GetPage] failed"};(function(t){var e=function(){function t(t){var e=this;void 0===t&&(t={}),Object.keys(t).forEach((function(n){return e[n]=t[n]}))}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n})(I||(I={}));var R=function(t){this.payload=t,this.type="[PAGE][API][DELETE] start"};var j=function(t){this.payload=t,this.type="[PAGE][API][DELETE] succeed"};var T=function(t){this.payload=t,this.type="[PAGE][API][DELETE] failed"};var F,S=function(t){var e=void 0===t?{}:t,n=e._id,r=e.name,o=e.grid;this._id=n,this.name=r||"",this.grid=o||""};(function(t){var e=function(){function t(t){void 0===t&&(t={}),this.page=new S(t)}return t.prototype.getRequestBody=function(){return this.page},t}();t.Request=e;var n=function(){};t.Response=n})(F||(F={}));var O=function(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] start"};var q=function(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] succeed"};var k=function(t){this.payload=t,this.type="[UPSERT_PAGE][API][UpsertPage] failed"};var U=function(){function t(t,e,n,r,o){this.http=t,this.store=e,this.configurationService=n,this._location=r,this.userFacadeService=o,this.userId$=this.userFacadeService.getDisplayName().pipe(u.filter((function(t){return null!=t})))}return t.prototype.get=function(t){var e=this;return this.configurationService.config$.pipe(u.filter((function(t){return""!==t.endpoints.get})),u.take(1),u.combineLatest(this.userId$),u.switchMap((function(n){var r=v(n,2),o=r[0];r[1];return e.http.get(l.stringTemplate(o.env.frontend_server+o.endpoints.get,{name:t}))})),u.map((function(t){return t.Result})))},t.prototype.delete=function(t){var e=this;return this.configurationService.config$.pipe(u.filter((function(t){return""!==t.endpoints.delete})),u.take(1),u.switchMap((function(n){return e.http.delete(l.stringTemplate(n.env.frontend_server+n.endpoints.delete,{_id:t}))})),u.map((function(t){return t.Result})))},t.prototype.getPages=function(){var t=this;return this.configurationService.config$.pipe(u.filter((function(t){return""!=t.endpoints.find})),u.combineLatest(this.userId$),u.switchMap((function(e){var n=v(e,2),r=n[0];n[1];return t.http.get(r.env.frontend_server+r.endpoints.find)})),u.map((function(t){return t.Result})))},t.prototype.upsert=function(t){var e=this,n=new F.Request(t);return this.configurationService.config$.pipe(u.filter((function(t){return""!=t.endpoints.upsert})),u.take(1),u.combineLatest(this.userId$),u.switchMap((function(t){var r=v(t,2),o=r[0];r[1];return e.http.post(o.env.frontend_server+o.endpoints.upsert,n.getRequestBody())})),u.map((function(t){return t.Result})),u.tap((function(){return e._location.back()})))},t.prototype.selectByName=function(t){var e=this,n=new p.BehaviorSubject(void 0);return this.store.select((function(t){return t.pages.db.data})).pipe(u.filter((function(t){return null!=t})),u.map((function(e){return e.find((function(e){return e.name==t}))})),u.tap((function(n){null==n&&e.store.dispatch(new $(t))}))).subscribe((function(t){return n.next(t)})),n.asObservable()},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.HttpClient},{type:a.Store},{type:b},{type:n.Location},{type:d.UserFacadeService}]},t}();var C=function(){function t(t,e,n,r,o){this.store=t,this.service=e,this.route=n,this.resolver=r,this.container=o}return t.prototype.ngOnInit=function(){this._selectPage()},t.prototype._selectPage=function(){var t=this;this.page$=this.route.params.pipe(u.pluck("name"),u.switchMap((function(e){return t.service.selectByName(e)})),u.filter((function(t){return null!=t})))},t.decorators=[{type:e.Component,args:[{template:'<div *ngIf="(page$ | async)?.grid">\r\n    <ngs-grid [oid]="(page$ | async)?.grid"></ngs-grid>\r\n</div>'}]}],t.ctorParameters=function(){return[{type:a.Store},{type:U},{type:i.ActivatedRoute},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t}();var D=function(){function t(){}return t.decorators=[{type:e.Component,args:[{selector:"page-root",template:"<router-outlet></router-outlet>"}]}],t}(),B=function(){function t(t,e,n){this.store=t,this.route=e,this.service=n,this._init_formgroup()}return t.prototype.upsert=function(){var t=h({},this.formGroup.value);this.store.dispatch(new O(t))},t.prototype.ngOnInit=function(){this._select_page(),this._update_formgroup_base_on_page()},t.prototype._init_formgroup=function(){this.formGroup=new y.FormGroup({_id:new y.FormControl(""),name:new y.FormControl(""),grid:new y.FormControl("")})},t.prototype._select_page=function(){var t=this;this.page$=this.route.params.pipe(u.pluck("name"),u.filter((function(t){return null!=t})),u.switchMap((function(e){return t.service.selectByName(e)})),u.filter((function(t){return null!=t})))},t.prototype._update_formgroup_base_on_page=function(){var t=this;this.page$.subscribe((function(e){t.formGroup.patchValue(e)}))},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center center" class="main-container">\r\n    <mat-card fxFlex="50">\r\n        <mat-card-header>\r\n            <mat-card-title fxLayout="row" fxLayoutGap="5px">\r\n                <mat-icon>receipt</mat-icon>\r\n                <span>ایجاد صفحه جدید</span>\r\n            </mat-card-title>\r\n            <mat-card-subtitle fxLayout="row" fxLayoutAlign="space-between center">\r\n                <span>\r\n                    نام صفحه را وارد نمایید و به مرحله بعد بروید ...\r\n                </span>\r\n            </mat-card-subtitle>\r\n        </mat-card-header>\r\n\r\n        <mat-card-content [formGroup]="formGroup">\r\n            <mat-form-field>\r\n                <input type="text" matInput placeholder="نام" formControlName="name">\r\n            </mat-form-field>\r\n        </mat-card-content>\r\n        <mat-card-actions align="end">\r\n            <button mat-raised-button color="primary" (click)="upsert()">ثبت</button>\r\n        </mat-card-actions>\r\n    </mat-card>\r\n</div>'}]}],t.ctorParameters=function(){return[{type:a.Store},{type:i.ActivatedRoute},{type:U}]},t}();var N=function(){function t(t){this.store=t,this.pages$=this.store.select((function(t){return t.pages.db.data}))}return t.prototype.ngOnInit=function(){this.store.dispatch(new _)},t.prototype.delete=function(t){this.store.dispatch(new R(t._id))},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center" fxLayoutGap="25px" class="main-container">\r\n\r\n  <div class="content-action">\r\n    <mat-card class="with-sticky-action">\r\n      <mat-card-header>\r\n        <mat-card-title fxLayout="row" fxLayoutGap="5px">\r\n          <mat-icon>list_alt</mat-icon>\r\n          <span>مدیریت صغحات</span>\r\n        </mat-card-title>\r\n        <mat-card-subtitle fxLayout="row" fxLayoutAlign="space-between center">\r\n          <span>\r\n            در این قسمت می‌توانید صغحات با گریدهای دلخواه خود را ایجاد نمایید ...\r\n          </span>\r\n        </mat-card-subtitle>\r\n      </mat-card-header>\r\n\r\n      <div fxLayout="column" fxLayoutAlign="center" fxLayoutGap="25px">\r\n        <div fxFlex="100" fxLayout="row wrap" fxLayoutAlign="start center">\r\n          <mat-card fxFlex.gt-lg="24" fxFlex.lg="32" fxFlex.md="48" fxFlex.sm="100" fxFlex.xs="100" class="link" *ngFor="let item of (pages$ | async)"\r\n            fxFlex="32" fxLayout="row" fxLayoutAlign="center center">\r\n            <div fxFlex fxLayoutAlign="start center">\r\n              <h3> {{item.name}}</h3>\r\n            </div>\r\n            <div fxFlex fxLayoutAlign="center center">\r\n              {{item.type}}\r\n            </div>\r\n            <div fxLayout="row">\r\n              <div fxFlex="nogrow">\r\n                <a mat-icon-button [routerLink]="[\'../upsert\' , item.name]">\r\n                  <mat-icon aria-label="edit page">edit</mat-icon>\r\n                </a>\r\n              </div>\r\n\r\n              <div fxFlex="nogrow">\r\n                <button mat-icon-button (click)="delete(item)">\r\n                  <mat-icon aria-label="delete page">delete</mat-icon>\r\n                </button>\r\n              </div>\r\n              <div fxFlex="nogrow">\r\n                <a mat-icon-button [routerLink]="[\'/page\' , item.name]">\r\n                  <mat-icon aria-label="edit page">remove_red_eye</mat-icon>\r\n                </a>\r\n              </div>\r\n            </div>\r\n          </mat-card>\r\n        </div>\r\n      </div>\r\n    </mat-card>\r\n    <div fxLayout="column" class="sticky-action">\r\n      <a color="primary" mat-mini-fab routerLink="../upsert">\r\n        <mat-icon>add</mat-icon>\r\n      </a>\r\n    </div>\r\n  </div>\r\n</div>',styles:["mat-card.link{padding:25px 15px;margin:.5%;box-sizing:border-box}"]}]}],t.ctorParameters=function(){return[{type:a.Store}]},t}();var V=[{path:"pages",component:D,children:[{path:"management",component:N},{path:"upsert",component:B},{path:"upsert/:name",component:B}]},{path:"page/:name",component:C}],z=i.RouterModule.forChild(V),H={UPSERT:"[PAGE][DB] UPSERT",DELETE:"[PAGE][DB] DELETE"},K=function(t){this.payload=t,this.type=H.UPSERT};var J=function(t){this.payload=t,this.type=H.DELETE};var Q=function(){function t(t){this.actions$=t,this.Upsert$=this.actions$.pipe(s.ofType("[PAGE][API][GetPage] succeed"),u.pluck("payload"),u.map((function(t){return new K([t])}))),this.UpsertMany$=this.actions$.pipe(s.ofType("[GET_PAGES][API][GetPages] succeed"),u.pluck("payload"),u.map((function(t){return new K(t)}))),this.delete$=this.actions$.pipe(s.ofType("[PAGE][API][DELETE] succeed"),u.pluck("payload"),u.map((function(t){return new J(t)})))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:s.Actions}]},g([s.Effect(),m("design:type",Object)],t.prototype,"Upsert$",void 0),g([s.Effect(),m("design:type",Object)],t.prototype,"UpsertMany$",void 0),g([s.Effect(),m("design:type",Object)],t.prototype,"delete$",void 0),t}();var W={data:[]};function X(t,e){var n;switch(void 0===t&&(t=W),e.type){case H.UPSERT:n=t.data.concat();var r=e.payload;return r instanceof Array||(r=[r],console.error("'PagesActionTypes.UPSERT' does not get array payload")),r.forEach((function(t){var e=n.findIndex((function(e){return e._id==t._id}));e>-1?n.splice(e,1,t):n.push(t)})),h({},t,{data:n});case H.DELETE:n=t.data.concat();var o=t.data.findIndex((function(t){return t._id==e.payload._id}));return n.splice(o,1),h({},t,{data:n});default:return t}}var Y={db:X};var Z=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(s.ofType("[PAGE][API][GetPage] start"),u.map((function(t){return t.payload})),u.switchMap((function(t){return n.service.get(t)})),u.map((function(t){return new L(t)})),u.catchError((function(t){return p.of(new M(t))})))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:s.Actions},{type:U}]},g([s.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}();var tt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(s.ofType("[GET_PAGES][API][GetPages] start"),u.switchMap((function(){return n.service.getPages().pipe(u.map((function(t){return new w(t)})),u.catchError((function(t){return p.of(new G(t))})))})))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:s.Actions},{type:U}]},g([s.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}();var et=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(s.ofType("[UPSERT_PAGE][API][UpsertPage] start"),u.map((function(t){return t.payload})),u.switchMap((function(t){return n.service.upsert(t)})),u.map((function(t){return new q(t)})),u.catchError((function(t){return p.of(new k(t))})))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:s.Actions},{type:U}]},g([s.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}();var nt=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(s.ofType("[PAGE][API][DELETE] start"),u.map((function(t){return t.payload})),u.switchMap((function(t){return n.service.delete(t)})),u.map((function(t){return new j(t)})),u.catchError((function(t){return p.of(new T(t))})))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:s.Actions},{type:U}]},g([s.Effect(),m("design:type",Object)],t.prototype,"start$",void 0),t}();var rt=function(){function t(){}return t.forRoot=function(t){return{ngModule:ot,providers:[{provide:E,useValue:t},b,U]}},t.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule,i.RouterModule,r.MatInputModule,r.MatFormFieldModule,r.MatCardModule,r.MatButtonModule,r.MatIconModule,r.MatDividerModule,o.FlexLayoutModule,y.FormsModule,y.ReactiveFormsModule,c.NgsGridModule],declarations:[C,N,D,B],exports:[]}]}],t}(),ot=function(){function t(){window.___starter=window.___starter||{},window.___starter.page="8.0.10"}return t.decorators=[{type:e.NgModule,args:[{imports:[rt,z,a.StoreModule.forFeature("pages",Y),s.EffectsModule.forFeature([Q,Z,tt,et,nt])],exports:[rt]}]}],t.ctorParameters=function(){return[]},t}();t.MODULE_CONFIG_TOKEN=E,t.MODULE_DEFAULT_CONFIG=x,t.NgsPageModule=rt,t.NgsPageRootModule=ot,t.ɵa=C,t.ɵb=Y,t.ɵd=U,t.ɵe=b,t.ɵf=N,t.ɵg=D,t.ɵh=B,t.ɵi=z,t.ɵj=X,t.ɵk=Q,t.ɵl=Z,t.ɵn=tt,t.ɵp=et,t.ɵr=nt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=soushians-page.umd.min.js.map