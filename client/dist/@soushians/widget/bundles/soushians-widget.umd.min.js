!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("@ngrx/store"),require("rxjs/operators"),require("@angular/common/http"),require("@soushians/shared"),require("@angular/common"),require("@angular/router"),require("@ngrx/effects"),require("@angular/forms"),require("@angular/material"),require("@angular/flex-layout")):"function"==typeof define&&define.amd?define("@soushians/widget",["exports","@angular/core","rxjs","@ngrx/store","rxjs/operators","@angular/common/http","@soushians/shared","@angular/common","@angular/router","@ngrx/effects","@angular/forms","@angular/material","@angular/flex-layout"],e):e((t.soushians=t.soushians||{},t.soushians.widget={}),t.ng.core,t.rxjs,null,t.rxjs.operators,t.ng.common.http,null,t.ng.common,t.ng.router,null,t.ng.forms,t.ng.material,t.ng["flex-layout"])}(this,function(t,e,i,n,r,o,a,s,c,p,u,f,d){"use strict";var l;!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n}(l||(l={}));var y,g=function(){this.type="[GET_WIDGETS][API][GetWidgets] start"},h=function(t){this.payload=t,this.type="[GET_WIDGETS][API][GetWidgets] succeed"},m=function(t){this.payload=t,this.type="[GET_WIDGETS][API][GetWidgets] failed"};!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n}(y||(y={}));var v,_=function(t){this.payload=t,this.type="[WIDGET][API][GetWidget] start"},b=function(t){this.payload=t,this.type="[WIDGET][API][GetWidget] succeed"},w=function(t){this.payload=t,this.type="[WIDGET][API][GetWidget] failed"},x=function(t){var e=void 0===t?{}:t,n=e._id,o=e.name,i=e.type,r=e.Config;this._id=n,this.name=o||"",this.type=i,this.Config=r||{}};!function(t){var e=function(){function t(t){void 0===t&&(t={}),this.widget=new x(t)}return t.prototype.getRequestBody=function(){return this.widget},t}();t.Request=e;var n=function(){};t.Response=n}(v||(v={}));var T=function(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] start"},I=function(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] succeed"},W=function(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] failed"},M={env:{production:!1,frontend_server:"frontend_server/did/not/set"},endpoints:{upsert:"/api/uiwidget",find:"/api/uiwidget",get:"/api/uiwidget/${model._id}"},types:{}},E=new e.InjectionToken("WidgetModuleConfig"),j=function(){function t(t,e){this.store=e,this.config$=new i.BehaviorSubject(M),this._config=Object.assign({},M,t),this.config$.next(this._config)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[E]}]},{type:n.Store}]},t}(),C=function(){function t(t,e,n,o){this.http=t,this.store=e,this.configurationService=n,this._location=o}return t.prototype.get=function(e){var n=this;return this.configurationService.config$.pipe(r.filter(function(t){return""!==t.endpoints.get}),r.take(1),r.switchMap(function(t){return n.http.get(a.stringTemplate(t.env.frontend_server+t.endpoints.get,{_id:e}))}),r.map(function(t){return t.Result}))},t.prototype.getWidgets=function(){var e=this;return this.configurationService.config$.pipe(r.filter(function(t){return""!=t.endpoints.find}),r.switchMap(function(t){return e.http.get(t.env.frontend_server+t.endpoints.find)}),r.map(function(t){return t.Result}))},t.prototype.upsert=function(t){var e=this,n=new v.Request(t);return this.configurationService.config$.pipe(r.filter(function(t){return""!=t.endpoints.upsert}),r.take(1),r.switchMap(function(t){return e.http.post(t.env.frontend_server+t.endpoints.upsert,n.getRequestBody())}),r.map(function(t){return t.Result}),r.tap(function(){return e._location.back()}))},t.prototype.selectById=function(e){var n=this,o=new i.BehaviorSubject(undefined);return this.store.select(function(t){return t.widgets.db.data}).pipe(r.filter(function(t){return null!=t}),r.map(function(t){return t.find(function(t){return t._id==e})}),r.tap(function(t){null==t&&n.store.dispatch(new _(e))})).subscribe(function(t){return o.next(t)}),o.asObservable()},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:o.HttpClient},{type:n.Store},{type:j},{type:s.Location}]},t}(),P=function(){function t(t,e,n,o,i){this.store=t,this.service=e,this.configurationService=n,this.resolver=o,this.container=i,this._fill_component_map()}return Object.defineProperty(t.prototype,"oid",{set:function(t){this._selectWidget(t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.widget$.pipe(r.filter(function(t){return t!=undefined})).subscribe(function(t){e._resolve_correct_component_base_on_widget_type(t)})},t.prototype._fill_component_map=function(){var e=this;this.configurationService.config$.pipe(r.map(function(t){return t.types}),r.startWith({})).subscribe(function(t){e.mapTypeToComponent=t})},t.prototype._selectWidget=function(t){this.widget$=this.service.selectById(t)},t.prototype._resolve_correct_component_base_on_widget_type=function(t){var e=this;if(!this.mapTypeToComponent[t.type]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t.type+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t.type].view);this.component=this.container.createComponent(o),this.widget$.subscribe(function(t){return e.component.instance.widget=t})},t.decorators=[{type:e.Component,args:[{selector:"widget",template:""}]}],t.ctorParameters=function(){return[{type:n.Store},{type:C},{type:j},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t.propDecorators={oid:[{type:e.Input}]},t}(),R=function(){function t(t){this.store=t,this.widgets$=this.store.select(function(t){return t.widgets.db.data})}return Object.defineProperty(t.prototype,"valid",{get:function(){return this.config.oid!=undefined},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return{oid:this.selectedWidgetId}},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.store.dispatch(new g)},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="column wrap" fxLayoutGap="15px">\n  <h4>لیست ویجت‌ها</h4>\n        <mat-form-field fxFlex="100">\n<mat-select placeholder="نوع ویجت" [(ngModel)]="selectedWidgetId" name="selectedWidgetId">\n  <mat-option *ngFor="let item of (widgets$ | async)" [value]="item._id">\n    {{item.type}} : <b>{{item.name}}</b>\n  </mat-option>\n</mat-select> \n</mat-form-field>\n</div>'}]}],t.ctorParameters=function(){return[{type:n.Store}]},t}(),S=function(){function t(){}return t.decorators=[{type:e.Component,args:[{selector:"widget-root",template:"<router-outlet></router-outlet>"}]}],t}(),$=function(){function t(t){this.store=t,this.widgets$=this.store.select(function(t){return t.widgets.db.data}),this._fill_anghazi()}return t.prototype.ngOnInit=function(){this.store.dispatch(new g)},t.prototype._fill_anghazi=function(){this.anghazi={article:{color:"green",icon:"description"},links:{color:"orange",icon:"link"}}},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center" fxLayoutGap="25px" class="main-container">\n\n  <div class="content-action">\n    <mat-card class="with-sticky-action">\n      <mat-card-header>\n        <mat-card-title fxLayout="row" fxLayoutGap="5px">\n          <mat-icon>settings_input_component</mat-icon>\n          <span>مدیریت افزونه ها</span>\n        </mat-card-title>\n        <mat-card-subtitle fxLayout="row" fxLayoutAlign="space-between center">\n          <span>\n            شامل تمامی درخواست‌ها از قبیل دائری، جمع‌آوری و ...\n          </span>\n        </mat-card-subtitle>\n      </mat-card-header>\n\n      <div fxLayout="row wrap" fxLayoutGap="10px" fxLayoutAlign="start">\n\n        <button fxFlex.lt-lg="18" fxFlex.lg="23.5" fxFlex.md="31" fxFlex.sm="48" fxFlex.xs="100" class=\'link\'\n          mat-raised-button [routerLink]="[\'../upsert\' ,  item.type,  item._id]" *ngFor="let item of (widgets$ | async)">\n          <div fxLayout=\'column\' fxLayoutAlign=\'space-between center\'>\n            <mat-icon color=\'primary\' [style.color]="anghazi[item.type].color">{{anghazi[item.type].icon}}</mat-icon>\n            <div fxFlex="nogrow" fxFlexAlign="stretch" fxLayoutAlign="center center" class="widget-type">\n              {{item.type}}\n            </div>\n            <h4 class="title">{{item.name}}</h4>\n          </div>\n        </button>\n      </div>\n\n    </mat-card>\n\n    <div fxLayout="column" class="sticky-action">\n      <a mat-mini-fab routerLink="../upsert/article" [style.backgroundColor]="\'#ffffff\'">\n        <mat-icon [style.color]="anghazi.article.color">{{anghazi.article.icon}}</mat-icon>\n      </a>\n      <a mat-mini-fab routerLink="../upsert/links" [style.backgroundColor]="\'#ffffff\'">\n        <mat-icon [style.color]="anghazi.links.color">{{anghazi.links.icon}}</mat-icon>\n      </a>\n    </div>\n\n  </div>\n</div>',styles:[".link{margin:.5%;box-sizing:border-box;padding:25px 15px}button.link mat-icon{font-size:34px;width:34px;height:34px}.link h4{margin:0}"]}]}],t.ctorParameters=function(){return[{type:n.Store}]},t}(),G=function(){function t(){}return t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center center" class="main-container">\n    <div fxFlex="50">\n        <ng-container ngsDynamicWidgetConfig></ng-container>\n    </div>\n</div>'}]}],t}(),k=[{path:"widget",component:S,children:[{path:"management",component:$},{path:"upsert/:type",component:G},{path:"upsert/:type/:_id",component:G}]}],A=c.RouterModule.forChild(k),O=function(){return(O=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function D(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;0<=s;s--)(i=t[s])&&(a=(r<3?i(a):3<r?i(e,n,a):i(e,n))||a);return 3<r&&a&&Object.defineProperty(e,n,a),a}function F(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var L=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[WIDGET][API][GetWidget] start").pipe(r.map(function(t){return t.payload}),r.switchMap(function(t){return n.service.get(t)}),r.map(function(t){return new b(t)}),r.catchError(function(t){return i.of(new w(t))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:p.Actions},{type:C}]},D([p.Effect(),F("design:type",Object)],t.prototype,"start$",void 0),t}(),q=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[UPSERT_WIDGET][API][UpsertWidget] start").pipe(r.map(function(t){return t.payload}),r.switchMap(function(t){return n.service.upsert(t)}),r.map(function(t){return new I(t)}),r.catchError(function(t){return i.of(new W(t))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:p.Actions},{type:C}]},D([p.Effect(),F("design:type",Object)],t.prototype,"start$",void 0),t}(),U=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[GET_WIDGETS][API][GetWidgets] start").pipe(r.switchMap(function(){return n.service.getWidgets().pipe(r.map(function(t){return new h(t)}),r.catchError(function(t){return i.of(new m(t))}))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:p.Actions},{type:C}]},D([p.Effect(),F("design:type",Object)],t.prototype,"start$",void 0),t}(),B="[WIDGET][DB] UPSERT",z="[WIDGET][DB] DELETE",V=function(t){this.payload=t,this.type=B},N={data:[]};function H(t,e){var n;switch(void 0===t&&(t=N),e.type){case B:n=t.data.concat();var o=e.payload;return o instanceof Array||(o=[o],console.error("'WidgetsActionTypes.UPSERT' does not get array payload")),o.forEach(function(e){var t=n.findIndex(function(t){return t._id==e._id});-1<t?n.splice(t,1,e):n.push(e)}),O({},t,{data:n});case z:n=Object.assign({},t.data);var i=t.data.findIndex(function(t){return t._id==e.payload._id});return n.splice(i,1),O({},t,{data:n});default:return t}}var J={db:H},K=function(){function t(t){this.actions$=t,this.Upsert$=this.actions$.ofType("[WIDGET][API][GetWidget] succeed").pipe(r.pluck("payload"),r.map(function(t){return new V([t])})),this.UpsertMany$=this.actions$.ofType("[GET_WIDGETS][API][GetWidgets] succeed").pipe(r.pluck("payload"),r.map(function(t){return new V(t)}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:p.Actions}]},D([p.Effect(),F("design:type",Object)],t.prototype,"Upsert$",void 0),D([p.Effect(),F("design:type",Object)],t.prototype,"UpsertMany$",void 0),t}(),Q=function(){function t(t,e,n,o,i,r){this.store=t,this.route=e,this.service=n,this.configurationService=o,this.resolver=i,this.container=r,this._fill_component_map()}return t.prototype.ngOnInit=function(){this._react_base_on_params()},t.prototype._fill_component_map=function(){var e=this;this.configurationService.config$.pipe(r.map(function(t){return t.types}),r.startWith({})).subscribe(function(t){e.mapTypeToComponent=t})},t.prototype._react_base_on_params=function(){var o=this;this.route.params.subscribe(function(t){var e=t.type,n=t._id;n?o.service.selectById(n).subscribe(function(t){o._resolve_correct_component_base_on_widget_type(e,t)}):o._resolve_correct_component_base_on_widget_type(e)})},t.prototype._resolve_correct_component_base_on_widget_type=function(t,e){if(this.component&&this.component.destroy(),!this.mapTypeToComponent[t]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t].upsert);this.component=this.container.createComponent(o),e&&(this.component.instance.widget=e)},t.decorators=[{type:e.Directive,args:[{selector:"[ngsDynamicWidgetConfig]"}]}],t.ctorParameters=function(){return[{type:n.Store},{type:c.ActivatedRoute},{type:C},{type:j},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t}(),X=function(){function t(t,e,n,o,i,r){this.store=t,this.route=e,this.service=n,this.configurationService=o,this.resolver=i,this.container=r,this._fill_component_map()}return Object.defineProperty(t.prototype,"oid",{set:function(t){this._selectWidget(t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.widget$.pipe(r.filter(function(t){return t!=undefined})).subscribe(function(t){e._resolve_correct_component_base_on_widget_type(t)})},t.prototype._fill_component_map=function(){var e=this;this.configurationService.config$.pipe(r.map(function(t){return t.types}),r.startWith({})).subscribe(function(t){e.mapTypeToComponent=t})},t.prototype._selectWidget=function(t){this.widget$=this.service.selectById(t)},t.prototype._resolve_correct_component_base_on_widget_type=function(t){var e=this;if(!this.mapTypeToComponent[t.type]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t.type+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t.type].view);this.component=this.container.createComponent(o),this.widget$.subscribe(function(t){return e.component.instance.widget=t})},t.decorators=[{type:e.Directive,args:[{selector:"[ngsDynamicWidgetView]"}]}],t.ctorParameters=function(){return[{type:n.Store},{type:c.ActivatedRoute},{type:C},{type:j},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t.propDecorators={oid:[{type:e.Input}]},t}(),Y=function(){function t(){}return t.forRoot=function(t){return{ngModule:Z,providers:[{provide:E,useValue:t},j,C]}},t.decorators=[{type:e.NgModule,args:[{imports:[s.CommonModule,c.RouterModule,f.MatExpansionModule,f.MatSnackBarModule,f.MatIconModule,f.MatButtonModule,f.MatCardModule,f.MatSelectModule,f.MatInputModule,f.MatFormFieldModule,f.MatTabsModule,f.MatRadioModule,d.FlexLayoutModule,u.FormsModule,u.ReactiveFormsModule,f.MatSlideToggleModule,f.MatDividerModule,f.MatCheckboxModule,f.MatTableModule],declarations:[S,$,G,Q,X,R,P],entryComponents:[R,P],exports:[X,R,P]}]}],t}(),Z=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[Y,A,n.StoreModule.forFeature("widgets",J),p.EffectsModule.forFeature([K,L,U,q])],exports:[Y]}]}],t}(),tt=function(){},et=function(){};t.UpsertWidgetStartAction=T,t.DynamicWidgetViewComponent=P,t.WidgetSelectorComponent=R,t.NgsWidgetModule=Y,t.WidgetModel=x,t.IWidgetView=tt,t.IWidgetUpsert=et,t.ɵh=$,t.ɵg=S,t.ɵn=K,t.ɵm=H,t.ɵo=L,t.ɵq=U,t.ɵs=q,t.ɵf=j,t.ɵe=C,t.ɵj=Q,t.ɵi=G,t.ɵk=X,t.ɵl=A,t.ɵb=E,t.ɵa=Z,t.ɵc=J,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-widget.umd.min.js.map