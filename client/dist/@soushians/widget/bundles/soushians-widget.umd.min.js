!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common/http"),require("@soushians/shared"),require("@angular/common"),require("@angular/forms"),require("@angular/material"),require("@angular/flex-layout"),require("rxjs"),require("@ngrx/effects"),require("@angular/core"),require("@ngrx/store"),require("rxjs/operators"),require("@angular/router")):"function"==typeof define&&define.amd?define("@soushians/widget",["exports","@angular/common/http","@soushians/shared","@angular/common","@angular/forms","@angular/material","@angular/flex-layout","rxjs","@ngrx/effects","@angular/core","@ngrx/store","rxjs/operators","@angular/router"],e):e((t.soushians=t.soushians||{},t.soushians.widget={}),t.ng.common.http,t.shared,t.ng.common,t.ng.forms,t.ng.material,t.ng["flex-layout"],t.rxjs,t.effects,t.ng.core,t.store,t.rxjs.operators,t.ng.router)}(this,function(t,e,o,n,i,r,s,a,c,p,u,f,d){"use strict";var l,y=function ct(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] start"},h=function pt(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] succeed"},g=function ut(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] failed"},m={env:{production:!1,frontend_server:"frontend_server/did/not/set"},endpoints:{upsert:"/api/uiwidget",find:"/api/uiwidget",get:"/api/uiwidget/${model._id}",deleteItem:"/api/uiwidget/${model.widgetId}"},types:{}},v=new p.InjectionToken("WidgetModuleConfig"),_=function(){function t(t,e){this.store=e,this.config$=new a.BehaviorSubject(m),this._config=Object.assign({},m,t),this.config$.next(this._config)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.decorators=[{type:p.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:p.Inject,args:[v]}]},{type:u.Store}]},t}();!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function o(){};t.Response=n}(l||(l={}));var b,w=function ft(){this.type="[GET_WIDGETS][API][GetWidgets] start"},T=function dt(t){this.payload=t,this.type="[GET_WIDGETS][API][GetWidgets] succeed"},I=function lt(t){this.payload=t,this.type="[GET_WIDGETS][API][GetWidgets] failed"};!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function o(){};t.Response=n}(b||(b={}));var x,E,W=function yt(t){this.payload=t,this.type="[WIDGET][API][GetWidget] start"},M=function ht(t){this.payload=t,this.type="[WIDGET][API][GetWidget] succeed"},j=function gt(t){this.payload=t,this.type="[WIDGET][API][GetWidget] failed"},$=function mt(t){var e=void 0===t?{}:t,n=e._id,o=e.name,i=e.type,r=e.Config;this._id=n,this.name=o||"",this.type=i,this.Config=r||{}};!function(t){var e=function(){function t(t){void 0===t&&(t={}),this.widget=new $(t)}return t.prototype.getRequestBody=function(){return this.widget},t}();t.Request=e;var n=function o(){};t.Response=n}(x||(x={})),function(t){var e=function(){function t(t){void 0===t&&(t={}),this.widget=new $(t)}return t.prototype.getRequestBody=function(){return this.widget},t}();t.Request=e;var n=function o(){};t.Response=n}(E||(E={}));var D=function vt(t){this.payload=t,this.type="[DELETE_WIDGET][API][DeleteWidget] start"},P=function _t(t){this.payload=t,this.type="[DELETE_WIDGET][API][DeleteWidget] succeed"},C=function bt(t){this.payload=t,this.type="[DELETE_WIDGET][API][DeleteWidget] failed"},R=function(){function t(t,e,n,o){this.http=t,this.store=e,this.configurationService=n,this._location=o}return t.prototype.get=function(e){var n=this;return this.configurationService.config$.pipe(f.filter(function(t){return""!==t.endpoints.get}),f.take(1),f.switchMap(function(t){return n.http.get(o.stringTemplate(t.env.frontend_server+t.endpoints.get,{_id:e}))}),f.map(function(t){return t.Result}))},t.prototype.getWidgets=function(){var e=this;return this.configurationService.config$.pipe(f.filter(function(t){return""!=t.endpoints.find}),f.switchMap(function(t){return e.http.get(t.env.frontend_server+t.endpoints.find)}),f.map(function(t){return t.Result}))},t.prototype.upsert=function(t){var e=this,n=new x.Request(t);return this.configurationService.config$.pipe(f.filter(function(t){return""!=t.endpoints.upsert}),f.take(1),f.switchMap(function(t){return e.http.post(t.env.frontend_server+t.endpoints.upsert,n.getRequestBody())}),f.map(function(t){return t.Result}),f.tap(function(){return e._location.back()}))},t.prototype["delete"]=function(t){var e=this,n=t._id;return this.configurationService.config$.pipe(f.filter(function(t){return""!=t.endpoints.deleteItem}),f.switchMap(function(t){return e.http["delete"](o.stringTemplate(t.env.frontend_server+t.endpoints.deleteItem,{widgetId:n})).pipe(f.map(function(t){return t.Result}))}))},t.prototype.selectById=function(e){var n=this,o=new a.BehaviorSubject(undefined);return this.store.select(function(t){return t.widgets.db.data}).pipe(f.filter(function(t){return null!=t}),f.map(function(t){return t.find(function(t){return t._id==e})}),f.tap(function(t){null==t&&n.store.dispatch(new W(e))})).subscribe(function(t){return o.next(t)}),o.asObservable()},t.decorators=[{type:p.Injectable}],t.ctorParameters=function(){return[{type:e.HttpClient},{type:u.Store},{type:_},{type:n.Location}]},t}(),k=function(){function t(t,e,n,o,i){this.store=t,this.service=e,this.configurationService=n,this.resolver=o,this.container=i,this._fill_component_map()}return Object.defineProperty(t.prototype,"oid",{set:function(t){this._selectWidget(t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.widget$.pipe(f.filter(function(t){return t!=undefined})).subscribe(function(t){e._resolve_correct_component_base_on_widget_type(t)})},t.prototype._fill_component_map=function(){var e=this;this.configurationService.config$.pipe(f.map(function(t){return t.types}),f.startWith({})).subscribe(function(t){e.mapTypeToComponent=t})},t.prototype._selectWidget=function(t){this.widget$=this.service.selectById(t)},t.prototype._resolve_correct_component_base_on_widget_type=function(t){var e=this;if(!this.mapTypeToComponent[t.type]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t.type+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t.type].view);this.component=this.container.createComponent(o),this.widget$.subscribe(function(t){return e.component.instance.widget=t})},t.decorators=[{type:p.Component,args:[{selector:"widget",template:""}]}],t.ctorParameters=function(){return[{type:u.Store},{type:R},{type:_},{type:p.ComponentFactoryResolver},{type:p.ViewContainerRef}]},t.propDecorators={oid:[{type:p.Input}]},t}(),S=function(){function t(t){this.store=t,this.widgets$=this.store.select(function(t){return t.widgets.db.data})}return Object.defineProperty(t.prototype,"valid",{get:function(){return this.config.oid!=undefined},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return{oid:this.selectedWidgetId}},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.store.dispatch(new w)},t.decorators=[{type:p.Component,args:[{template:'<div fxLayout="column wrap" fxLayoutGap="15px">\r\n  <h4>لیست ویجت‌ها</h4>\r\n        <mat-form-field fxFlex="100">\r\n<mat-select placeholder="نوع ویجت" [(ngModel)]="selectedWidgetId" name="selectedWidgetId">\r\n  <mat-option *ngFor="let item of (widgets$ | async)" [value]="item._id">\r\n    {{item.type}} : <b>{{item.name}}</b>\r\n  </mat-option>\r\n</mat-select> \r\n</mat-form-field>\r\n</div>'}]}],t.ctorParameters=function(){return[{type:u.Store}]},t}(),G=function(){function t(){}return t.decorators=[{type:p.Component,args:[{selector:"widget-root",template:"<router-outlet></router-outlet>"}]}],t}(),A=function(){function t(t){this.store=t,this.widgets$=this.store.select(function(t){return t.widgets.db.data}),this._fill_anghazi()}return t.prototype.ngOnInit=function(){this.store.dispatch(new w)},t.prototype.remove=function(t){this.store.dispatch(new D(t))},t.prototype._fill_anghazi=function(){this.anghazi={article:{color:"green",icon:"description"},links:{color:"orange",icon:"link"},list:{color:"blue",icon:"list"}}},t.decorators=[{type:p.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center" fxLayoutGap="25px" class="main-container">\r\n\r\n  <div class="content-action">\r\n    <mat-card class="with-sticky-action">\r\n      <mat-card-header>\r\n        <mat-card-title fxLayout="row" fxLayoutGap="5px">\r\n          <mat-icon>widgets</mat-icon>\r\n          <span>مدیریت افزونه‌ها</span>\r\n        </mat-card-title>\r\n        <mat-card-subtitle fxLayout="row" fxLayoutAlign="space-between center">\r\n          <span>\r\n            افزونه‌ مورد نظر را براساس نوع آن ایجاد نمایید ...\r\n          </span>\r\n        </mat-card-subtitle>\r\n      </mat-card-header>\r\n\r\n      <div fxLayout="row wrap" fxLayoutAlign="start">\r\n\r\n        <button mat-raised-button fxFlex.gt-lg="19" fxFlex.lg="24" fxFlex.md="31.7" fxFlex.sm="49" fxFlex.xs="100"\r\n          class=\'link\' *ngFor="let item of (widgets$ | async)">\r\n          <button mat-icon-button (click)="remove(item)" class="remove-item">\r\n            <mat-icon>delete</mat-icon>\r\n          </button>\r\n          <div class="link-button" [routerLink]="[\'../upsert\' ,  item.type,  item._id]" fxLayout=\'column\' fxLayoutAlign=\'space-between center\'>\r\n            <mat-icon color=\'primary\' [style.color]="anghazi[item.type].color">{{anghazi[item.type].icon}}</mat-icon>\r\n            <div fxFlex="nogrow" fxFlexAlign="stretch" fxLayoutAlign="center center" class="widget-type">\r\n              {{item.type}}\r\n            </div>\r\n            <h4 class="title">{{item.name}}</h4>\r\n          </div>\r\n        </button>\r\n      </div>\r\n\r\n    </mat-card>\r\n\r\n    <div fxLayout="column" class="sticky-action">\r\n      <a mat-mini-fab routerLink="../upsert/article" [style.backgroundColor]="\'#ffffff\'">\r\n        <mat-icon [style.color]="anghazi.article.color">{{anghazi.article.icon}}</mat-icon>\r\n      </a>\r\n      <a mat-mini-fab routerLink="../upsert/links" [style.backgroundColor]="\'#ffffff\'">\r\n        <mat-icon [style.color]="anghazi.links.color">{{anghazi.links.icon}}</mat-icon>\r\n      </a>\r\n      <a mat-mini-fab routerLink="../upsert/list" [style.backgroundColor]="\'#ffffff\'">\r\n        <mat-icon [style.color]="anghazi.list.color">{{anghazi.list.icon}}</mat-icon>\r\n      </a>\r\n    </div>\r\n\r\n  </div>\r\n</div>',styles:[".link{margin:.5%;box-sizing:border-box;position:relative;padding:0}button.link mat-icon{font-size:34px;width:34px;height:34px}.link h4{margin:0}.remove-item{position:absolute;top:0;left:0;z-index:100}.link-button{padding:25px 15px}button.link .remove-item mat-icon{font-size:initial;width:initial;height:initial;visibility:hidden;opacity:0;transition:opacity .3s ease-in-out}button.link:hover .remove-item mat-icon{visibility:visible;opacity:1}"]}]}],t.ctorParameters=function(){return[{type:u.Store}]},t}(),O=function(){function t(){}return t.decorators=[{type:p.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center center" class="main-container">\r\n    <div fxFlex="50">\r\n        <ng-container ngsDynamicWidgetConfig></ng-container>\r\n    </div>\r\n</div>'}]}],t}(),L=[{path:"widget",component:G,children:[{path:"management",component:A},{path:"upsert/:type",component:O},{path:"upsert/:type/:_id",component:O}]}],F=d.RouterModule.forChild(L),q=function(){return(q=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function U(t,e,n,o){var i,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;0<=a;a--)(i=t[a])&&(s=(r<3?i(s):3<r?i(e,n,s):i(e,n))||s);return 3<r&&s&&Object.defineProperty(e,n,s),s}function z(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var B=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(c.ofType("[WIDGET][API][GetWidget] start"),f.pluck("payload"),f.switchMap(function(t){return n.service.get(t)}),f.map(function(t){return new M(t)}),f.catchError(function(t){return a.of(new j(t))}))}return t.decorators=[{type:p.Injectable}],t.ctorParameters=function(){return[{type:c.Actions},{type:R}]},U([c.Effect(),z("design:type",Object)],t.prototype,"start$",void 0),t}(),V=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(c.ofType("[UPSERT_WIDGET][API][UpsertWidget] start"),f.pluck("payload"),f.switchMap(function(t){return n.service.upsert(t)}),f.map(function(t){return new h(t)}),f.catchError(function(t){return a.of(new g(t))}))}return t.decorators=[{type:p.Injectable}],t.ctorParameters=function(){return[{type:c.Actions},{type:R}]},U([c.Effect(),z("design:type",Object)],t.prototype,"start$",void 0),t}(),N=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(c.ofType("[GET_WIDGETS][API][GetWidgets] start"),f.switchMap(function(){return n.service.getWidgets().pipe(f.map(function(t){return new T(t)}),f.catchError(function(t){return a.of(new I(t))}))}))}return t.decorators=[{type:p.Injectable}],t.ctorParameters=function(){return[{type:c.Actions},{type:R}]},U([c.Effect(),z("design:type",Object)],t.prototype,"start$",void 0),t}(),H=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(c.ofType("[DELETE_WIDGET][API][DeleteWidget] start"),f.pluck("payload"),f.switchMap(function(t){return n.service["delete"](t).pipe(f.map(function(t){return new P(t)}),f.catchError(function(t){return a.of(new C(t))}))}))}return t.decorators=[{type:p.Injectable}],t.ctorParameters=function(){return[{type:c.Actions},{type:R}]},U([c.Effect(),z("design:type",Object)],t.prototype,"start$",void 0),t}(),J="[WIDGET][DB] UPSERT",K="[WIDGET][DB] DELETE",Q=function wt(t){this.payload=t,this.type=J},X=function Tt(t){this.payload=t,this.type=K},Y={data:[]};function Z(t,e){var n;switch(void 0===t&&(t=Y),e.type){case J:n=t.data.concat();var o=e.payload;return o instanceof Array||(o=[o],console.error("'WidgetsActionTypes.UPSERT' does not get array payload")),o.forEach(function(e){var t=n.findIndex(function(t){return t._id==e._id});-1<t?n.splice(t,1,e):n.push(e)}),q({},t,{data:n});case K:n=t.data.concat();var i=t.data.findIndex(function(t){return t._id==e.payload._id});return-1<i&&n.splice(i,1),q({},t,{data:n});default:return t}}var tt={db:Z},et=function(){function t(t){this.actions$=t,this.Upsert$=this.actions$.pipe(c.ofType("[WIDGET][API][GetWidget] succeed"),f.pluck("payload"),f.map(function(t){return new Q([t])})),this.UpsertMany$=this.actions$.pipe(c.ofType("[GET_WIDGETS][API][GetWidgets] succeed"),f.pluck("payload"),f.map(function(t){return new Q(t)})),this.Delete$=this.actions$.pipe(c.ofType("[DELETE_WIDGET][API][DeleteWidget] succeed"),f.pluck("payload"),f.map(function(t){return new X(t)}))}return t.decorators=[{type:p.Injectable}],t.ctorParameters=function(){return[{type:c.Actions}]},U([c.Effect(),z("design:type",Object)],t.prototype,"Upsert$",void 0),U([c.Effect(),z("design:type",Object)],t.prototype,"UpsertMany$",void 0),U([c.Effect(),z("design:type",Object)],t.prototype,"Delete$",void 0),t}(),nt=function(){function t(t,e,n,o,i,r){this.store=t,this.route=e,this.service=n,this.configurationService=o,this.resolver=i,this.container=r,this._fill_component_map()}return t.prototype.ngOnInit=function(){this._react_base_on_params()},t.prototype._fill_component_map=function(){var e=this;this.configurationService.config$.pipe(f.map(function(t){return t.types}),f.startWith({})).subscribe(function(t){e.mapTypeToComponent=t})},t.prototype._react_base_on_params=function(){var o=this;this.route.params.subscribe(function(t){var e=t.type,n=t._id;n?o.service.selectById(n).subscribe(function(t){o._resolve_correct_component_base_on_widget_type(e,t)}):o._resolve_correct_component_base_on_widget_type(e)})},t.prototype._resolve_correct_component_base_on_widget_type=function(t,e){if(this.component&&this.component.destroy(),!this.mapTypeToComponent[t]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t].upsert);this.component=this.container.createComponent(o),e&&(this.component.instance.widget=e)},t.decorators=[{type:p.Directive,args:[{selector:"[ngsDynamicWidgetConfig]"}]}],t.ctorParameters=function(){return[{type:u.Store},{type:d.ActivatedRoute},{type:R},{type:_},{type:p.ComponentFactoryResolver},{type:p.ViewContainerRef}]},t}(),ot=function(){function t(t,e,n,o,i,r){this.store=t,this.route=e,this.service=n,this.configurationService=o,this.resolver=i,this.container=r,this._fill_component_map()}return Object.defineProperty(t.prototype,"oid",{set:function(t){this._selectWidget(t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.widget$.pipe(f.filter(function(t){return t!=undefined})).subscribe(function(t){e._resolve_correct_component_base_on_widget_type(t)})},t.prototype._fill_component_map=function(){var e=this;this.configurationService.config$.pipe(f.map(function(t){return t.types}),f.startWith({})).subscribe(function(t){e.mapTypeToComponent=t})},t.prototype._selectWidget=function(t){this.widget$=this.service.selectById(t)},t.prototype._resolve_correct_component_base_on_widget_type=function(t){var e=this;if(!this.mapTypeToComponent[t.type]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t.type+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t.type].view);this.component=this.container.createComponent(o),this.widget$.subscribe(function(t){return e.component.instance.widget=t})},t.decorators=[{type:p.Directive,args:[{selector:"[ngsDynamicWidgetView]"}]}],t.ctorParameters=function(){return[{type:u.Store},{type:d.ActivatedRoute},{type:R},{type:_},{type:p.ComponentFactoryResolver},{type:p.ViewContainerRef}]},t.propDecorators={oid:[{type:p.Input}]},t}(),it=function(){function t(){}return t.forRoot=function(t){return{ngModule:rt,providers:[{provide:v,useValue:t},_,R]}},t.decorators=[{type:p.NgModule,args:[{imports:[n.CommonModule,d.RouterModule,r.MatExpansionModule,r.MatSnackBarModule,r.MatIconModule,r.MatButtonModule,r.MatCardModule,r.MatSelectModule,r.MatInputModule,r.MatFormFieldModule,r.MatTabsModule,r.MatRadioModule,s.FlexLayoutModule,i.FormsModule,i.ReactiveFormsModule,r.MatSlideToggleModule,r.MatDividerModule,r.MatCheckboxModule,r.MatTableModule,r.MatMenuModule],declarations:[G,A,O,nt,ot,S,k],entryComponents:[S,k],exports:[ot,S,k]}]}],t}(),rt=function(){function t(){}return t.decorators=[{type:p.NgModule,args:[{imports:[it,F,u.StoreModule.forFeature("widgets",tt),c.EffectsModule.forFeature([et,B,N,V,H])],exports:[it]}]}],t}(),st=function It(){},at=function xt(){};t.UpsertWidgetStartAction=y,t.DynamicWidgetViewComponent=k,t.WidgetSelectorComponent=S,t.NgsWidgetModule=it,t.WidgetModel=$,t.IWidgetView=st,t.IWidgetUpsert=at,t.ɵi=A,t.ɵh=G,t.ɵo=et,t.ɵn=Z,t.ɵu=H,t.ɵp=B,t.ɵr=N,t.ɵt=V,t.ɵg=_,t.ɵf=R,t.ɵk=nt,t.ɵj=O,t.ɵl=ot,t.ɵm=F,t.ɵc=v,t.ɵb=rt,t.ɵd=tt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-widget.umd.min.js.map