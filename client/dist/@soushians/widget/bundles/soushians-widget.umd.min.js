!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ngrx/store"),require("rxjs/operators"),require("rxjs"),require("@angular/common/http"),require("@soushians/shared"),require("@angular/common"),require("@angular/router"),require("@angular/forms"),require("@angular/material"),require("@ngrx/effects"),require("@angular/flex-layout")):"function"==typeof define&&define.amd?define("@soushians/widget",["exports","@angular/core","@ngrx/store","rxjs/operators","rxjs","@angular/common/http","@soushians/shared","@angular/common","@angular/router","@angular/forms","@angular/material","@ngrx/effects","@angular/flex-layout"],e):e(((t=t||self).soushians=t.soushians||{},t.soushians.widget={}),t.ng.core,t.store,t.rxjs.operators,t.rxjs,t.ng.common.http,t.shared,t.ng.common,t.ng.router,t.ng.forms,t.ng.material,t.effects,t.ng["flex-layout"])}(this,(function(t,e,n,o,r,i,a,s,c,p,u,f,d){"use strict";var l=function(){return(l=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function y(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function h(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var g=function(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] start"};var m=function(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] succeed"};var v=function(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] failed"};var _,b={env:{production:!1,frontend_server:"frontend_server/did/not/set"},endpoints:{upsert:"/api/uiwidget",find:"/api/uiwidget",get:"/api/uiwidget/${model._id}",deleteItem:"/api/uiwidget/${model.widgetId}"},types:{}},w=new e.InjectionToken("WidgetModuleConfig"),T=function(){function t(t,e){this.store=e,this.config$=new r.BehaviorSubject(b),this._config=Object.assign({},b,t),this.config$.next(this._config)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[w]}]},{type:n.Store}]},t}();(function(t){var e=function(){function t(t){var e=this;void 0===t&&(t={}),Object.keys(t).forEach((function(n){return e[n]=t[n]}))}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n})(_||(_={}));var E=function(){this.type="[GET_WIDGETS][API][GetWidgets] start"};var I=function(t){this.payload=t,this.type="[GET_WIDGETS][API][GetWidgets] succeed"};var x,W=function(t){this.payload=t,this.type="[GET_WIDGETS][API][GetWidgets] failed"};(function(t){var e=function(){function t(t){var e=this;void 0===t&&(t={}),Object.keys(t).forEach((function(n){return e[n]=t[n]}))}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n})(x||(x={}));var M=function(t){this.payload=t,this.type="[WIDGET][API][GetWidget] start"};var P=function(t){this.payload=t,this.type="[WIDGET][API][GetWidget] succeed"};var D=function(t){this.payload=t,this.type="[WIDGET][API][GetWidget] failed"};var j,$,R=function(t){var e=void 0===t?{}:t,n=e._id,o=e.name,r=e.type,i=e.Config;this._id=n,this.name=o||"",this.type=r,this.Config=i||{}};(function(t){var e=function(){function t(t){void 0===t&&(t={}),this.widget=new R(t)}return t.prototype.getRequestBody=function(){return this.widget},t}();t.Request=e;var n=function(){};t.Response=n})(j||(j={})),function(t){var e=function(){function t(t){void 0===t&&(t={}),this.widget=new R(t)}return t.prototype.getRequestBody=function(){return this.widget},t}();t.Request=e;var n=function(){};t.Response=n}($||($={}));var C=function(t){this.payload=t,this.type="[DELETE_WIDGET][API][DeleteWidget] start"};var S=function(t){this.payload=t,this.type="[DELETE_WIDGET][API][DeleteWidget] succeed"};var k=function(t){this.payload=t,this.type="[DELETE_WIDGET][API][DeleteWidget] failed"};var G=function(){function t(t,e,n,o){this.http=t,this.store=e,this.configurationService=n,this._location=o}return t.prototype.get=function(t){var e=this;return this.configurationService.config$.pipe(o.filter((function(t){return""!==t.endpoints.get})),o.take(1),o.switchMap((function(n){return e.http.get(a.stringTemplate(n.env.frontend_server+n.endpoints.get,{_id:t}))})),o.map((function(t){return t.Result})))},t.prototype.getWidgets=function(){var t=this;return this.configurationService.config$.pipe(o.filter((function(t){return""!=t.endpoints.find})),o.switchMap((function(e){return t.http.get(e.env.frontend_server+e.endpoints.find)})),o.map((function(t){return t.Result})))},t.prototype.upsert=function(t){var e=this,n=new j.Request(t);return this.configurationService.config$.pipe(o.filter((function(t){return""!=t.endpoints.upsert})),o.take(1),o.switchMap((function(t){return e.http.post(t.env.frontend_server+t.endpoints.upsert,n.getRequestBody())})),o.map((function(t){return t.Result})),o.tap((function(){return e._location.back()})))},t.prototype.delete=function(t){var e=this,n=t._id;return this.configurationService.config$.pipe(o.filter((function(t){return""!=t.endpoints.deleteItem})),o.switchMap((function(t){return e.http.delete(a.stringTemplate(t.env.frontend_server+t.endpoints.deleteItem,{widgetId:n})).pipe(o.map((function(t){return t.Result})))})))},t.prototype.selectById=function(t){var e=this,n=new r.BehaviorSubject(void 0);return this.store.select((function(t){return t.widgets.db.data})).pipe(o.filter((function(t){return null!=t})),o.map((function(e){return e.find((function(e){return e._id==t}))})),o.tap((function(n){null==n&&e.store.dispatch(new M(t))}))).subscribe((function(t){return n.next(t)})),n.asObservable()},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:n.Store},{type:T},{type:s.Location}]},t}();var A=function(){function t(t,e,n,o,r){this.store=t,this.service=e,this.configurationService=n,this.resolver=o,this.container=r,this._fill_component_map()}return Object.defineProperty(t.prototype,"oid",{set:function(t){this._selectWidget(t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.widget$.pipe(o.filter((function(t){return null!=t}))).subscribe((function(e){t._resolve_correct_component_base_on_widget_type(e)}))},t.prototype._fill_component_map=function(){var t=this;this.configurationService.config$.pipe(o.map((function(t){return t.types})),o.startWith({})).subscribe((function(e){t.mapTypeToComponent=e}))},t.prototype._selectWidget=function(t){this.widget$=this.service.selectById(t)},t.prototype._resolve_correct_component_base_on_widget_type=function(t){var e=this;if(!this.mapTypeToComponent[t.type]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t.type+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t.type].view);this.component=this.container.createComponent(o),this.widget$.subscribe((function(t){return e.component.instance.widget=t}))},t.decorators=[{type:e.Component,args:[{selector:"widget",template:""}]}],t.ctorParameters=function(){return[{type:n.Store},{type:G},{type:T},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t.propDecorators={oid:[{type:e.Input}]},t}();var L=function(){function t(t){this.store=t,this.widgets$=this.store.select((function(t){return t.widgets.db.data}))}return Object.defineProperty(t.prototype,"valid",{get:function(){return null!=this.config.oid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return{oid:this.selectedWidgetId}},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.store.dispatch(new E)},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="column wrap" fxLayoutGap="15px">\r\n  <h4>لیست ویجت‌ها</h4>\r\n        <mat-form-field fxFlex="100">\r\n<mat-select placeholder="نوع ویجت" [(ngModel)]="selectedWidgetId" name="selectedWidgetId">\r\n  <mat-option *ngFor="let item of (widgets$ | async)" [value]="item._id">\r\n    {{item.type}} : <b>{{item.name}}</b>\r\n  </mat-option>\r\n</mat-select> \r\n</mat-form-field>\r\n</div>'}]}],t.ctorParameters=function(){return[{type:n.Store}]},t}();var O=function(){function t(){}return t.decorators=[{type:e.Component,args:[{selector:"widget-root",template:"<router-outlet></router-outlet>"}]}],t}(),F=function(){function t(t){this.store=t,this.widgets$=this.store.select((function(t){return t.widgets.db.data})),this._fill_anghazi()}return t.prototype.ngOnInit=function(){this.store.dispatch(new E)},t.prototype.remove=function(t){this.store.dispatch(new C(t))},t.prototype._fill_anghazi=function(){this.anghazi={article:{color:"green",icon:"description"},links:{color:"orange",icon:"link"},list:{color:"blue",icon:"list"}}},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center" fxLayoutGap="25px" class="main-container">\r\n\r\n  <div class="content-action">\r\n    <mat-card class="with-sticky-action">\r\n      <mat-card-header>\r\n        <mat-card-title fxLayout="row" fxLayoutGap="5px">\r\n          <mat-icon>widgets</mat-icon>\r\n          <span>مدیریت افزونه‌ها</span>\r\n        </mat-card-title>\r\n        <mat-card-subtitle fxLayout="row" fxLayoutAlign="space-between center">\r\n          <span>\r\n            افزونه‌ مورد نظر را براساس نوع آن ایجاد نمایید ...\r\n          </span>\r\n        </mat-card-subtitle>\r\n      </mat-card-header>\r\n\r\n      <div fxLayout="row wrap" fxLayoutAlign="start">\r\n\r\n        <button mat-raised-button fxFlex.gt-lg="19" fxFlex.lg="24" fxFlex.md="31.7" fxFlex.sm="49" fxFlex.xs="100"\r\n          class=\'link\' *ngFor="let item of (widgets$ | async)">\r\n          <button mat-icon-button (click)="remove(item)" class="remove-item">\r\n            <mat-icon>delete</mat-icon>\r\n          </button>\r\n          <div class="link-button" [routerLink]="[\'../upsert\' ,  item.type,  item._id]" fxLayout=\'column\' fxLayoutAlign=\'space-between center\'>\r\n            <mat-icon color=\'primary\' [style.color]="anghazi[item.type].color">{{anghazi[item.type].icon}}</mat-icon>\r\n            <div fxFlex="nogrow" fxFlexAlign="stretch" fxLayoutAlign="center center" class="widget-type">\r\n              {{item.type}}\r\n            </div>\r\n            <h4 class="title">{{item.name}}</h4>\r\n          </div>\r\n        </button>\r\n      </div>\r\n\r\n    </mat-card>\r\n\r\n    <div fxLayout="column" class="sticky-action">\r\n      <a mat-mini-fab routerLink="../upsert/article" [style.backgroundColor]="\'#ffffff\'">\r\n        <mat-icon [style.color]="anghazi.article.color">{{anghazi.article.icon}}</mat-icon>\r\n      </a>\r\n      <a mat-mini-fab routerLink="../upsert/links" [style.backgroundColor]="\'#ffffff\'">\r\n        <mat-icon [style.color]="anghazi.links.color">{{anghazi.links.icon}}</mat-icon>\r\n      </a>\r\n      <a mat-mini-fab routerLink="../upsert/list" [style.backgroundColor]="\'#ffffff\'">\r\n        <mat-icon [style.color]="anghazi.list.color">{{anghazi.list.icon}}</mat-icon>\r\n      </a>\r\n    </div>\r\n\r\n  </div>\r\n</div>',styles:[".link{margin:.5%;box-sizing:border-box;position:relative;padding:0}button.link mat-icon{font-size:34px;width:34px;height:34px}.link h4{margin:0}.remove-item{position:absolute;top:0;left:0;z-index:100}.link-button{padding:25px 15px}button.link .remove-item mat-icon{font-size:initial;width:initial;height:initial;visibility:hidden;opacity:0;transition:opacity .3s ease-in-out}button.link:hover .remove-item mat-icon{visibility:visible;opacity:1}"]}]}],t.ctorParameters=function(){return[{type:n.Store}]},t}();var q=function(){function t(){}return t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center center" class="main-container">\r\n    <div fxFlex="50">\r\n        <ng-container ngsDynamicWidgetConfig></ng-container>\r\n    </div>\r\n</div>'}]}],t}(),U=[{path:"widget",component:O,children:[{path:"management",component:F},{path:"upsert/:type",component:q},{path:"upsert/:type/:_id",component:q}]}],z=c.RouterModule.forChild(U),B=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(f.ofType("[WIDGET][API][GetWidget] start"),o.pluck("payload"),o.switchMap((function(t){return n.service.get(t)})),o.map((function(t){return new P(t)})),o.catchError((function(t){return r.of(new D(t))})))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:G}]},y([f.Effect(),h("design:type",Object)],t.prototype,"start$",void 0),t}();var V=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(f.ofType("[UPSERT_WIDGET][API][UpsertWidget] start"),o.pluck("payload"),o.switchMap((function(t){return n.service.upsert(t)})),o.map((function(t){return new m(t)})),o.catchError((function(t){return r.of(new v(t))})))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:G}]},y([f.Effect(),h("design:type",Object)],t.prototype,"start$",void 0),t}();var N=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(f.ofType("[GET_WIDGETS][API][GetWidgets] start"),o.switchMap((function(){return n.service.getWidgets().pipe(o.map((function(t){return new I(t)})),o.catchError((function(t){return r.of(new W(t))})))})))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:G}]},y([f.Effect(),h("design:type",Object)],t.prototype,"start$",void 0),t}();var H=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.pipe(f.ofType("[DELETE_WIDGET][API][DeleteWidget] start"),o.pluck("payload"),o.switchMap((function(t){return n.service.delete(t).pipe(o.map((function(t){return new S(t)})),o.catchError((function(t){return r.of(new k(t))})))})))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:G}]},y([f.Effect(),h("design:type",Object)],t.prototype,"start$",void 0),t}();var J={UPSERT:"[WIDGET][DB] UPSERT",DELETE:"[WIDGET][DB] DELETE"},K=function(t){this.payload=t,this.type=J.UPSERT};var Q=function(t){this.payload=t,this.type=J.DELETE};var X={data:[]};function Y(t,e){var n;switch(void 0===t&&(t=X),e.type){case J.UPSERT:n=t.data.concat();var o=e.payload;return o instanceof Array||(o=[o],console.error("'WidgetsActionTypes.UPSERT' does not get array payload")),o.forEach((function(t){var e=n.findIndex((function(e){return e._id==t._id}));e>-1?n.splice(e,1,t):n.push(t)})),l({},t,{data:n});case J.DELETE:n=t.data.concat();var r=t.data.findIndex((function(t){return t._id==e.payload._id}));return r>-1&&n.splice(r,1),l({},t,{data:n});default:return t}}var Z={db:Y};var tt=function(){function t(t){this.actions$=t,this.Upsert$=this.actions$.pipe(f.ofType("[WIDGET][API][GetWidget] succeed"),o.pluck("payload"),o.map((function(t){return new K([t])}))),this.UpsertMany$=this.actions$.pipe(f.ofType("[GET_WIDGETS][API][GetWidgets] succeed"),o.pluck("payload"),o.map((function(t){return new K(t)}))),this.Delete$=this.actions$.pipe(f.ofType("[DELETE_WIDGET][API][DeleteWidget] succeed"),o.pluck("payload"),o.map((function(t){return new Q(t)})))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f.Actions}]},y([f.Effect(),h("design:type",Object)],t.prototype,"Upsert$",void 0),y([f.Effect(),h("design:type",Object)],t.prototype,"UpsertMany$",void 0),y([f.Effect(),h("design:type",Object)],t.prototype,"Delete$",void 0),t}();var et=function(){function t(t,e,n,o,r,i){this.store=t,this.route=e,this.service=n,this.configurationService=o,this.resolver=r,this.container=i,this._fill_component_map()}return t.prototype.ngOnInit=function(){this._react_base_on_params()},t.prototype._fill_component_map=function(){var t=this;this.configurationService.config$.pipe(o.map((function(t){return t.types})),o.startWith({})).subscribe((function(e){t.mapTypeToComponent=e}))},t.prototype._react_base_on_params=function(){var t=this;this.route.params.subscribe((function(e){var n=e.type,o=e._id;o?t.service.selectById(o).subscribe((function(e){t._resolve_correct_component_base_on_widget_type(n,e)})):t._resolve_correct_component_base_on_widget_type(n)}))},t.prototype._resolve_correct_component_base_on_widget_type=function(t,e){if(this.component&&this.component.destroy(),!this.mapTypeToComponent[t]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t].upsert);this.component=this.container.createComponent(o),e&&(this.component.instance.widget=e)},t.decorators=[{type:e.Directive,args:[{selector:"[ngsDynamicWidgetConfig]"}]}],t.ctorParameters=function(){return[{type:n.Store},{type:c.ActivatedRoute},{type:G},{type:T},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t}();var nt=function(){function t(t,e,n,o,r,i){this.store=t,this.route=e,this.service=n,this.configurationService=o,this.resolver=r,this.container=i,this._fill_component_map()}return Object.defineProperty(t.prototype,"oid",{set:function(t){this._selectWidget(t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.widget$.pipe(o.filter((function(t){return null!=t}))).subscribe((function(e){t._resolve_correct_component_base_on_widget_type(e)}))},t.prototype._fill_component_map=function(){var t=this;this.configurationService.config$.pipe(o.map((function(t){return t.types})),o.startWith({})).subscribe((function(e){t.mapTypeToComponent=e}))},t.prototype._selectWidget=function(t){this.widget$=this.service.selectById(t)},t.prototype._resolve_correct_component_base_on_widget_type=function(t){var e=this;if(!this.mapTypeToComponent[t.type]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t.type+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t.type].view);this.component=this.container.createComponent(o),this.widget$.subscribe((function(t){return e.component.instance.widget=t}))},t.decorators=[{type:e.Directive,args:[{selector:"[ngsDynamicWidgetView]"}]}],t.ctorParameters=function(){return[{type:n.Store},{type:c.ActivatedRoute},{type:G},{type:T},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t.propDecorators={oid:[{type:e.Input}]},t}();var ot=function(){function t(){}return t.forRoot=function(t){return{ngModule:rt,providers:[{provide:w,useValue:t},T,G]}},t.decorators=[{type:e.NgModule,args:[{imports:[s.CommonModule,c.RouterModule,u.MatExpansionModule,u.MatSnackBarModule,u.MatIconModule,u.MatButtonModule,u.MatCardModule,u.MatSelectModule,u.MatInputModule,u.MatFormFieldModule,u.MatTabsModule,u.MatRadioModule,d.FlexLayoutModule,p.FormsModule,p.ReactiveFormsModule,u.MatSlideToggleModule,u.MatDividerModule,u.MatCheckboxModule,u.MatTableModule,u.MatMenuModule],declarations:[O,F,q,et,nt,L,A],entryComponents:[L,A],exports:[nt,L,A]}]}],t}(),rt=function(){function t(){window.___starter=window.___starter||{},window.___starter.widget="8.0.10"}return t.decorators=[{type:e.NgModule,args:[{imports:[ot,z,n.StoreModule.forFeature("widgets",Z),f.EffectsModule.forFeature([tt,B,N,V,H])],exports:[ot]}]}],t.ctorParameters=function(){return[]},t}(),it=function(){};var at=function(){};t.DynamicWidgetViewComponent=A,t.IWidgetUpsert=at,t.IWidgetView=it,t.NgsWidgetModule=ot,t.UpsertWidgetStartAction=g,t.WidgetModel=R,t.WidgetSelectorComponent=L,t.ɵb=rt,t.ɵc=w,t.ɵd=Z,t.ɵf=G,t.ɵg=T,t.ɵh=O,t.ɵi=F,t.ɵj=q,t.ɵk=et,t.ɵl=nt,t.ɵm=z,t.ɵn=Y,t.ɵo=tt,t.ɵp=B,t.ɵr=N,t.ɵt=V,t.ɵu=H,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=soushians-widget.umd.min.js.map