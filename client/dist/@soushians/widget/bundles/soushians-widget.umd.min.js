!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("@ngrx/store"),require("rxjs/operators"),require("@angular/common/http"),require("@soushians/shared"),require("@angular/common"),require("@angular/router"),require("@ngrx/effects"),require("@angular/forms"),require("@angular/material"),require("@angular/flex-layout")):"function"==typeof define&&define.amd?define("@soushians/widget",["exports","@angular/core","rxjs","@ngrx/store","rxjs/operators","@angular/common/http","@soushians/shared","@angular/common","@angular/router","@ngrx/effects","@angular/forms","@angular/material","@angular/flex-layout"],e):e((t.soushians=t.soushians||{},t.soushians.widget={}),t.ng.core,t.rxjs,null,t.rxjs.operators,t.ng.common.http,null,t.ng.common,t.ng.router,null,t.ng.forms,t.ng.material,t.ng["flex-layout"])}(this,function(t,e,r,n,i,o,s,c,a,p,u,f,d){"use strict";var l;!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n}(l||(l={}));var y,g=function(){this.type="[GET_WIDGETS][API][GetWidgets] start"},h=function(t){this.payload=t,this.type="[GET_WIDGETS][API][GetWidgets] succeed"},m=function(t){this.payload=t,this.type="[GET_WIDGETS][API][GetWidgets] failed"};!function(t){var e=function(){function t(e){void 0===e&&(e={});var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var n=function(){};t.Response=n}(y||(y={}));var v,_=function(t){this.payload=t,this.type="[WIDGET][API][GetWidget] start"},b=function(t){this.payload=t,this.type="[WIDGET][API][GetWidget] succeed"},w=function(t){this.payload=t,this.type="[WIDGET][API][GetWidget] failed"},T=function(t){var e=void 0===t?{}:t,n=e._id,o=e.name,r=e.type,i=e.Config;this._id=n,this.name=o||"",this.type=r,this.Config=i||{}};!function(t){var e=function(){function t(t){void 0===t&&(t={}),this.widget=new T(t)}return t.prototype.getRequestBody=function(){return this.widget},t}();t.Request=e;var n=function(){};t.Response=n}(v||(v={}));var x=function(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] start"},I=function(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] succeed"},W=function(t){this.payload=t,this.type="[UPSERT_WIDGET][API][UpsertWidget] failed"},M={env:{production:!1,frontend_server:"frontend_server/did/not/set"},endpoints:{upsert:"/api/uiwidget",find:"/api/uiwidget",get:"/api/uiwidget/${model._id}"},types:{}},E=new e.InjectionToken("WidgetModuleConfig"),j=function(){function t(t,e){this.store=e,this.config$=new r.BehaviorSubject(M),this._config=Object.assign({},M,t),this.config$.next(this._config)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[E]}]},{type:n.Store}]},t}(),C=function(){function t(t,e,n,o){this.http=t,this.store=e,this.configurationService=n,this._location=o}return t.prototype.get=function(e){var n=this;return this.configurationService.config$.pipe(i.filter(function(t){return""!==t.endpoints.get}),i.take(1),i.switchMap(function(t){return n.http.get(s.stringTemplate(t.env.frontend_server+t.endpoints.get,{_id:e}))}),i.map(function(t){return t.Result}))},t.prototype.getWidgets=function(){var e=this;return this.configurationService.config$.pipe(i.filter(function(t){return""!=t.endpoints.find}),i.switchMap(function(t){return e.http.get(t.env.frontend_server+t.endpoints.find)}),i.map(function(t){return t.Result}))},t.prototype.upsert=function(t){var e=this,n=new v.Request(t);return this.configurationService.config$.pipe(i.filter(function(t){return""!=t.endpoints.upsert}),i.take(1),i.switchMap(function(t){return e.http.post(t.env.frontend_server+t.endpoints.upsert,n.getRequestBody())}),i.map(function(t){return t.Result}),i.tap(function(){return e._location.back()}))},t.prototype.selectById=function(e){var n=this,o=new r.BehaviorSubject(undefined);return this.store.select(function(t){return t.widgets.db.data}).pipe(i.filter(function(t){return null!=t}),i.map(function(t){return t.find(function(t){return t._id==e})}),i.tap(function(t){null==t&&n.store.dispatch(new _(e))})).subscribe(function(t){return o.next(t)}),o.asObservable()},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:o.HttpClient},{type:n.Store},{type:j},{type:c.Location}]},t}(),P=function(){function t(t,e,n,o,r){this.store=t,this.service=e,this.configurationService=n,this.resolver=o,this.container=r,this._fill_component_map()}return Object.defineProperty(t.prototype,"oid",{set:function(t){this._selectWidget(t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.widget$.pipe(i.filter(function(t){return t!=undefined})).subscribe(function(t){e._resolve_correct_component_base_on_widget_type(t)})},t.prototype._fill_component_map=function(){var e=this;this.configurationService.config$.pipe(i.map(function(t){return t.types}),i.startWith({})).subscribe(function(t){e.mapTypeToComponent=t})},t.prototype._selectWidget=function(t){this.widget$=this.service.selectById(t)},t.prototype._resolve_correct_component_base_on_widget_type=function(t){var e=this;if(!this.mapTypeToComponent[t.type]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t.type+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t.type].view);this.component=this.container.createComponent(o),this.widget$.subscribe(function(t){return e.component.instance.widget=t})},t.decorators=[{type:e.Component,args:[{selector:"widget",template:""}]}],t.ctorParameters=function(){return[{type:n.Store},{type:C},{type:j},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t.propDecorators={oid:[{type:e.Input}]},t}(),R=function(){function t(t){this.store=t,this.widgets$=this.store.select(function(t){return t.widgets.db.data})}return Object.defineProperty(t.prototype,"valid",{get:function(){return this.config.oid!=undefined},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return{oid:this.selectedWidgetId}},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.store.dispatch(new g)},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="column wrap" fxLayoutGap="15px">\n  <h4>لیست ویجت‌ها</h4>\n        <mat-form-field fxFlex="100">\n<mat-select placeholder="نوع ویجت" [(ngModel)]="selectedWidgetId" name="selectedWidgetId">\n  <mat-option *ngFor="let item of (widgets$ | async)" [value]="item._id">\n    {{item.type}} : <b>{{item.name}}</b>\n  </mat-option>\n</mat-select> \n</mat-form-field>\n</div>'}]}],t.ctorParameters=function(){return[{type:n.Store}]},t}(),S=function(){function t(){}return t.decorators=[{type:e.Component,args:[{selector:"widget-root",template:"<router-outlet></router-outlet>"}]}],t}(),$=function(){function t(t){this.store=t,this.widgets$=this.store.select(function(t){return t.widgets.db.data})}return t.prototype.ngOnInit=function(){this.store.dispatch(new g)},t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center" fxLayoutGap="25px">\n  <div fXFlex="30" fxLayout="row wrap">\n    <button fxFlex="100" color="primary" mat-raised-button routerLink="../upsert/article">\n      Add Article\n    </button>\n    <button fxFlex="100" color="primary" mat-raised-button routerLink="../upsert/links">\n      Add Links\n    </button>\n  </div>\n  <div fxFlex="70" fxLayout="row wrap" fxLayoutGap="25px">\n    <mat-card class="cards-item" *ngFor="let item of (widgets$ | async)" fxFlex="33" fxLayout="row">\n      <div fxFlex>\n        <a [routerLink]="[\'../upsert\' ,  item.type,  item._id]">\n          <mat-icon aria-label="edit widget">edit</mat-icon>\n        </a>\n      </div>\n      <div fxFlex>\n        {{item.name}}\n      </div>\n      <div fxFlex>\n        {{item.type}}\n      </div>\n    </mat-card>\n  </div>\n</div>'}]}],t.ctorParameters=function(){return[{type:n.Store}]},t}(),G=function(){function t(){}return t.decorators=[{type:e.Component,args:[{template:'<div fxLayout="row" fxLayoutAlign="center center">\n    <div fxFlex="50">\n        <ng-container ngsDynamicWidgetConfig></ng-container>\n    </div>\n</div>'}]}],t}(),O=[{path:"widget",component:S,children:[{path:"management",component:$},{path:"upsert/:type",component:G},{path:"upsert/:type/:_id",component:G}]}],D=a.RouterModule.forChild(O),A=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t};function F(t,e,n,o){var r,i=arguments.length,s=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,o);else for(var c=t.length-1;0<=c;c--)(r=t[c])&&(s=(i<3?r(s):3<i?r(e,n,s):r(e,n))||s);return 3<i&&s&&Object.defineProperty(e,n,s),s}function q(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var k=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[WIDGET][API][GetWidget] start").pipe(i.map(function(t){return t.payload}),i.switchMap(function(t){return n.service.get(t)}),i.map(function(t){return new b(t)}),i.catchError(function(t){return r.of(new w(t))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:p.Actions},{type:C}]},F([p.Effect(),q("design:type",Object)],t.prototype,"start$",void 0),t}(),L=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[UPSERT_WIDGET][API][UpsertWidget] start").pipe(i.map(function(t){return t.payload}),i.switchMap(function(t){return n.service.upsert(t)}),i.map(function(t){return new I(t)}),i.catchError(function(t){return r.of(new W(t))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:p.Actions},{type:C}]},F([p.Effect(),q("design:type",Object)],t.prototype,"start$",void 0),t}(),U=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.start$=this.actions$.ofType("[GET_WIDGETS][API][GetWidgets] start").pipe(i.switchMap(function(){return n.service.getWidgets().pipe(i.map(function(t){return new h(t)}),i.catchError(function(t){return r.of(new m(t))}))}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:p.Actions},{type:C}]},F([p.Effect(),q("design:type",Object)],t.prototype,"start$",void 0),t}(),B="[WIDGET][DB] UPSERT",V="[WIDGET][DB] DELETE",N=function(t){this.payload=t,this.type=B},H={data:[]};function X(t,e){var n;switch(void 0===t&&(t=H),e.type){case B:n=t.data.concat();var o=e.payload;return o instanceof Array||(o=[o],console.error("'WidgetsActionTypes.UPSERT' does not get array payload")),o.forEach(function(e){var t=n.findIndex(function(t){return t._id==e._id});-1<t?n.splice(t,1,e):n.push(e)}),A({},t,{data:n});case V:n=Object.assign({},t.data);var r=t.data.findIndex(function(t){return t._id==e.payload._id});return n.splice(r,1),A({},t,{data:n});default:return t}}var z={db:X},J=function(){function t(t){this.actions$=t,this.Upsert$=this.actions$.ofType("[WIDGET][API][GetWidget] succeed").pipe(i.pluck("payload"),i.map(function(t){return new N([t])})),this.UpsertMany$=this.actions$.ofType("[GET_WIDGETS][API][GetWidgets] succeed").pipe(i.pluck("payload"),i.map(function(t){return new N(t)}))}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:p.Actions}]},F([p.Effect(),q("design:type",Object)],t.prototype,"Upsert$",void 0),F([p.Effect(),q("design:type",Object)],t.prototype,"UpsertMany$",void 0),t}(),K=function(){function t(t,e,n,o,r,i){this.store=t,this.route=e,this.service=n,this.configurationService=o,this.resolver=r,this.container=i,this._fill_component_map()}return t.prototype.ngOnInit=function(){this._react_base_on_params()},t.prototype._fill_component_map=function(){var e=this;this.configurationService.config$.pipe(i.map(function(t){return t.types}),i.startWith({})).subscribe(function(t){e.mapTypeToComponent=t})},t.prototype._react_base_on_params=function(){var o=this;this.route.params.subscribe(function(t){var e=t.type,n=t._id;n?o.service.selectById(n).subscribe(function(t){o._resolve_correct_component_base_on_widget_type(e,t)}):o._resolve_correct_component_base_on_widget_type(e)})},t.prototype._resolve_correct_component_base_on_widget_type=function(t,e){if(this.component&&this.component.destroy(),!this.mapTypeToComponent[t]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t].upsert);this.component=this.container.createComponent(o),e&&(this.component.instance.widget=e)},t.decorators=[{type:e.Directive,args:[{selector:"[ngsDynamicWidgetConfig]"}]}],t.ctorParameters=function(){return[{type:n.Store},{type:a.ActivatedRoute},{type:C},{type:j},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t}(),Q=function(){function t(t,e,n,o,r,i){this.store=t,this.route=e,this.service=n,this.configurationService=o,this.resolver=r,this.container=i,this._fill_component_map()}return Object.defineProperty(t.prototype,"oid",{set:function(t){this._selectWidget(t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.widget$.pipe(i.filter(function(t){return t!=undefined})).subscribe(function(t){e._resolve_correct_component_base_on_widget_type(t)})},t.prototype._fill_component_map=function(){var e=this;this.configurationService.config$.pipe(i.map(function(t){return t.types}),i.startWith({})).subscribe(function(t){e.mapTypeToComponent=t})},t.prototype._selectWidget=function(t){this.widget$=this.service.selectById(t)},t.prototype._resolve_correct_component_base_on_widget_type=function(t){var e=this;if(!this.mapTypeToComponent[t.type]){var n=Object.keys(this.mapTypeToComponent).join(", ");throw new Error("Trying to use an unsupported type ("+t.type+").\n\t\t  \t\t Supported types: "+n)}var o=this.resolver.resolveComponentFactory(this.mapTypeToComponent[t.type].view);this.component=this.container.createComponent(o),this.widget$.subscribe(function(t){return e.component.instance.widget=t})},t.decorators=[{type:e.Directive,args:[{selector:"[ngsDynamicWidgetView]"}]}],t.ctorParameters=function(){return[{type:n.Store},{type:a.ActivatedRoute},{type:C},{type:j},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},t.propDecorators={oid:[{type:e.Input}]},t}(),Y=function(){function t(){}return t.forRoot=function(t){return{ngModule:Z,providers:[{provide:E,useValue:t},j,C]}},t.decorators=[{type:e.NgModule,args:[{imports:[c.CommonModule,a.RouterModule,f.MatExpansionModule,f.MatSnackBarModule,f.MatIconModule,f.MatButtonModule,f.MatCardModule,f.MatSelectModule,f.MatInputModule,f.MatFormFieldModule,f.MatTabsModule,f.MatRadioModule,d.FlexLayoutModule,u.FormsModule,u.ReactiveFormsModule,f.MatSlideToggleModule,f.MatDividerModule,f.MatCheckboxModule,f.MatTableModule],declarations:[S,$,G,K,Q,R,P],entryComponents:[R,P],exports:[Q,R,P]}]}],t}(),Z=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[Y,D,n.StoreModule.forFeature("widgets",z),p.EffectsModule.forFeature([J,k,U,L])],exports:[Y]}]}],t}(),tt=function(){},et=function(){};t.UpsertWidgetStartAction=x,t.DynamicWidgetViewComponent=P,t.WidgetSelectorComponent=R,t.NgsWidgetModule=Y,t.WidgetModel=T,t.IWidgetView=tt,t.IWidgetUpsert=et,t.ɵh=$,t.ɵg=S,t.ɵn=J,t.ɵm=X,t.ɵo=k,t.ɵq=U,t.ɵs=L,t.ɵf=j,t.ɵe=C,t.ɵj=K,t.ɵi=G,t.ɵk=Q,t.ɵl=D,t.ɵb=E,t.ɵa=Z,t.ɵc=z,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-widget.umd.min.js.map