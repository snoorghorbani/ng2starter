{"version":3,"file":"soushians-socket.umd.js","sources":["ng://@soushians/socket/lib/socket.config.ts","ng://@soushians/socket/lib/services/socket-configuration.service.ts","ng://@soushians/socket/lib/socket.actions.ts","ng://@soushians/socket/lib/services/socket.service.ts","ng://@soushians/socket/lib/socket.reducer.ts","ng://@soushians/socket/lib/socket.module.ts"],"sourcesContent":["import { InjectionToken } from \"@angular/core\";\r\n\r\nexport interface SocketModuleConfig {\r\n\tenv?: {\r\n\t\tproduction: boolean;\r\n\t\tfrontend_server: string;\r\n\t};\r\n}\r\nexport const MODULE_DEFAULT_CONFIG: SocketModuleConfig = {\r\n\tenv: {\r\n\t\tproduction: false,\r\n\t\tfrontend_server: \"frontend_server/did/not/set\"\r\n\t}\r\n};\r\nexport const MODULE_CONFIG_TOKEN = new InjectionToken<SocketModuleConfig>(\"SocketModuleConfig\");\r\n","import { BehaviorSubject } from \"rxjs\";\r\nimport { Inject, Injectable } from \"@angular/core\";\r\nimport { Store } from \"@ngrx/store\";\r\n\r\nimport { getSocketModuleConfig } from \"@soushians/config\";\r\n\r\nimport { SocketModuleConfig, MODULE_DEFAULT_CONFIG, MODULE_CONFIG_TOKEN } from \"../socket.config\";\r\nimport { AppState } from \"../socket.reducer\";\r\n\r\n@Injectable()\r\nexport class SocketConfigurationService {\r\n\tprivate _config: SocketModuleConfig;\r\n\tget config() {\r\n\t\treturn this._config;\r\n\t}\r\n\tconfig$ = new BehaviorSubject(MODULE_DEFAULT_CONFIG);\r\n\r\n\tconstructor(@Inject(MODULE_CONFIG_TOKEN) configFile, private store: Store<AppState>) {\r\n\t\tthis._config = Object.assign({}, MODULE_DEFAULT_CONFIG, configFile);\r\n\t\tthis.config$.next(this._config);\r\n\t\tthis.store.select(getSocketModuleConfig).subscribe(userConfig => {\r\n\t\t\tif (!userConfig) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._config = Object.assign({}, this._config, userConfig.Config);\r\n\t\t\tthis.config$.next(this._config);\r\n\t\t});\r\n\t}\r\n}\r\n","import { Action } from \"@ngrx/store\";\r\n\r\nexport enum SocketActionTypes {\r\n\tSOCKET_RUN_SUCCESSFULLY = \"[SOCKET] SOCKET_RUN_SUCCESSFULLY\",\r\n\tSOCKET_INITIALAZATION_FAILD = \"[SOCKET] SOCKET_INITIALAZATION_FAILD\"\r\n}\r\n\r\nexport class SocketRunSuccessfullyAction implements Action {\r\n\treadonly type = SocketActionTypes.SOCKET_RUN_SUCCESSFULLY;\r\n}\r\nexport class SocketInitialazationFailedAction implements Action {\r\n\treadonly type = SocketActionTypes.SOCKET_INITIALAZATION_FAILD;\r\n}\r\n\r\nexport type SocketActions = SocketRunSuccessfullyAction | SocketInitialazationFailedAction;\r\n","import { Injectable } from \"@angular/core\";\r\nimport { Observable } from \"rxjs\";\r\nimport { map } from \"rxjs/operators\";\r\nimport { Store } from \"@ngrx/store\";\r\nimport * as _io from \"socket.io-client\";\r\nconst io = _io;\r\n\r\nimport { AppState } from \"../socket.reducer\";\r\n\r\nimport { SocketConfigurationService } from \"./socket-configuration.service\";\r\nimport { SocketRunSuccessfullyAction } from \"../socket.actions\";\r\n\r\n@Injectable({\r\n\tprovidedIn: \"root\"\r\n})\r\nexport class SocketService {\r\n\tsocket: any;\r\n\turi: string;\r\n\tconstructor(private configService: SocketConfigurationService, private store: Store<AppState>) {\r\n\t\tthis.configService.config$\r\n\t\t\t.pipe(\r\n\t\t\t\tmap(config => config.env.frontend_server),\r\n\t\t\t\tmap(uri => {\r\n\t\t\t\t\t// console.log(uri, this.configService.config);\r\n\t\t\t\t\tthis.socket = io(uri);\r\n\t\t\t\t\treturn this.store.dispatch(new SocketRunSuccessfullyAction());\r\n\t\t\t\t})\r\n\t\t\t)\r\n\t\t\t.subscribe(() => {\r\n\t\t\t\tthis.socket.on(\"DISPATCH_ACTION\", data => {\r\n\t\t\t\t\tthis.store.dispatch({\r\n\t\t\t\t\t\ttype: data.type,\r\n\t\t\t\t\t\tpayload: data.payload\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t}\r\n\t/**\r\n\t * @example\r\n\t * this.socketService.on<number>(\"chnage-number\").subscribe(data=>{})\r\n\t * @returns\r\n\t * Observable<T>\r\n\t */\r\n\ton<T>(message): Observable<T> {\r\n\t\tconst observer$ = new Observable<T>(observer => {\r\n\t\t\tthis.socket.on(message, (data: T) => {\r\n\t\t\t\tobserver.next(data);\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn observer$;\r\n\t}\r\n\t/**\r\n\t * @example\r\n\t * this.socketService.emit(\"chnage-number\",{number:2})\r\n\t * @returns\r\n\t * void\r\n\t */\r\n\temit(message: string, payload: any): void {\r\n\t\tthis.socket.emit(message, payload);\r\n\t}\r\n}\r\n","import { Action } from \"@ngrx/store\";\r\n\r\nexport interface State {\r\n\tnumber: number;\r\n}\r\nexport const initialState: State = {\r\n\tnumber: 0\r\n};\r\n\r\nexport function Reducer(state = initialState, action: Action): State {\r\n\tswitch (action.type) {\r\n\t\tdefault: {\r\n\t\t\treturn state;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport interface SocketState {\r\n\tchange: State;\r\n}\r\n\r\nexport const SocketReducer = {\r\n\tchange: Reducer\r\n};\r\n\r\nexport interface AppState {\r\n\tsocket: SocketState;\r\n}\r\n","import { NgModule, ModuleWithProviders } from \"@angular/core\";\r\nimport { CommonModule } from \"@angular/common\";\r\nimport { StoreModule } from \"@ngrx/store\";\r\n\r\nimport { SocketModuleConfig, MODULE_CONFIG_TOKEN } from \"./socket.config\";\r\nimport { SocketConfigurationService } from \"./services/socket-configuration.service\";\r\nimport { SocketService } from \"./services/socket.service\";\r\nimport { SocketReducer } from \"./socket.reducer\";\r\n\r\n@NgModule({\r\n\timports: [CommonModule]\r\n})\r\nexport class NgsSocketModule {\r\n\tstatic forRoot(config?: SocketModuleConfig): ModuleWithProviders {\r\n\t\treturn {\r\n\t\t\tngModule: NgsSocketRootModule,\r\n\t\t\tproviders: [{ provide: MODULE_CONFIG_TOKEN, useValue: config }, SocketConfigurationService, SocketService]\r\n\t\t};\r\n\t}\r\n}\r\n\r\n@NgModule({\r\n\timports: [NgsSocketModule, StoreModule.forFeature(\"socket\", SocketReducer)]\r\n})\r\nexport class NgsSocketRootModule {\r\n\tconstructor(private socketService: SocketService) {\r\n\t\t(<any>window).___starter = (<any>window).___starter || {};\r\n\t\t(<any>window).___starter.socket = \"8.0.10\";\r\n\t}\r\n}\r\n"],"names":["InjectionToken","BehaviorSubject","getSocketModuleConfig","Injectable","Inject","Store","map","Observable","NgModule","CommonModule","StoreModule"],"mappings":"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"}