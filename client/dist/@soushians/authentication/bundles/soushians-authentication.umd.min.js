!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ngrx/store"),require("rxjs"),require("@soushians/config"),require("@angular/common/http"),require("@angular/material"),require("rxjs/operators"),require("@angular/material/snack-bar"),require("@angular/router"),require("rxjs/add/operator/do"),require("rxjs/Observable"),require("tslib"),require("rxjs/add/operator/map"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/catch"),require("rxjs/add/observable/empty"),require("@ngrx/effects"),require("@angular/common"),require("@angular/flex-layout"),require("@angular/platform-browser/animations"),require("@angular/forms"),require("@soushians/form")):"function"==typeof define&&define.amd?define("@soushians/authentication",["exports","@angular/core","@ngrx/store","rxjs","@soushians/config","@angular/common/http","@angular/material","rxjs/operators","@angular/material/snack-bar","@angular/router","rxjs/add/operator/do","rxjs/Observable","tslib","rxjs/add/operator/map","rxjs/add/operator/mergeMap","rxjs/add/operator/catch","rxjs/add/observable/empty","@ngrx/effects","@angular/common","@angular/flex-layout","@angular/platform-browser/animations","@angular/forms","@soushians/form"],e):e((t.soushians=t.soushians||{},t.soushians.authentication={}),t.ng.core,null,null,null,t.ng.common.http,t.ng.material,t.Rx.Observable.prototype,t.ng.material["snack-bar"],t.ng.router,t.Rx.Observable.prototype,t.Rx,t.tslib,t.Rx.Observable.prototype,t.Rx.Observable.prototype,t.Rx.Observable.prototype,t.Rx.Observable,null,t.ng.common,t.ng["flex-layout"],t.ng.platformBrowser.animations,t.ng.forms,null)}(this,function(t,e,n,r,o,i,a,s,u,c,p,f,d,l,g,h,I,y,m,v,S,b,j){"use strict";var M,N=function(e){var n=this;this.Roles=[],e&&Object.keys(e).forEach(function(t){t in e&&(n[t]=e[t])})};!function(t){var e=function(){};t.Request=e;var n=function(){function t(e){var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.extractData=function(){return this.Result.User},t}();t.Response=n}(M||(M={}));var _=function(){this.type="[AUTHENTICATION] PROGRESSING_STARTED"},x=function(){this.type="[AUTHENTICATION] PROGRESSING_FINISHED"},R=function(){this.type="[captcha] new captcha"},E={SIGNIN:"[Auth] Signin",SIGNOUT:"[Auth] Signout",SIGNIN_SUCCEED:"[Auth] Signin Success",SIGNIN_FAILURE:"[Auth] Signin Failure",SIGNIN_REDIRECT:"[Auth] Signin Redirect"},O=function(t){this.payload=t,this.type=E.SIGNIN},w=function(t){this.payload=t,this.type=E.SIGNIN_SUCCEED},A=function(t){this.payload=t,this.type=E.SIGNIN_FAILURE},T=function(){this.type=E.SIGNOUT},C={endpoints:{signOut:"",signIn:"",userInformation:""},forms:{signIn:""},env:{production:!1}},P=new e.InjectionToken("ModuleConfig"),$=function(){function t(t,e){var n=this;this.store=e,this.config$=new r.BehaviorSubject(this._config),this._config=Object.assign({},C,t),this.config$.next(this._config),this.store.select(o.getAuthenticationModuleConfig).subscribe(function(t){t&&(n._config=Object.assign({},n._config,t.Config),n.config$.next(n._config))})}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t}();$.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],$.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[P]}]},{type:n.Store}]},$.ngInjectableDef=e.defineInjectable({factory:function(){return new $(e.inject(P),e.inject(n.Store))},token:$,providedIn:"root"});var k=function(){function t(t,e,n){this.http=t,this.configurationService=e,this.snackBar=n}return t.prototype.signin=function(e){var n=this;return this.configurationService.config$.pipe(s.filter(function(t){return""!=t.endpoints.signIn}),s.take(1),s.switchMap(function(t){return n.http.post(n.configurationService.config.endpoints.signIn,e)}),s.map(function(t){return new M.Response(t).extractData()}))},t.prototype.signout=function(){return localStorage.removeItem("[APP] SIGNIN_RESPONSE"),this.http.get(this.configurationService.config.endpoints.signOut,{withCredentials:!0}).map(function(t){return t})},t}();k.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],k.ctorParameters=function(){return[{type:i.HttpClient},{type:$},{type:a.MatSnackBar}]},k.ngInjectableDef=e.defineInjectable({factory:function(){return new k(e.inject(i.HttpClient),e.inject($),e.inject(u.MatSnackBar))},token:k,providedIn:"root"});var G={loggedIn:!1,user:new N({Id:1})};var q={userStatus:function(t,e){switch(void 0===t&&(t=G),e.type){case E.SIGNIN_SUCCEED:return Object.assign({},t,{loggedIn:!0,user:e.payload});case E.SIGNOUT:return G;default:return t}}},F=n.createFeatureSelector("authentication"),U=n.createSelector(F,function(t){return t.userStatus}),D=n.createSelector(U,function(t){return t.loggedIn}),L=n.createSelector(U,function(t){return t.user}),H=function(){function t(t){this.store=t}return t.prototype.canActivate=function(t,e){return this.store.select(L).take(1).map(function(t){return t.Roles.includes("Admin")})},t}();H.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],H.ctorParameters=function(){return[{type:n.Store}]},H.ngInjectableDef=e.defineInjectable({factory:function(){return new H(e.inject(n.Store))},token:H,providedIn:"root"});var B=function(){function t(t){this.store=t}return t.prototype.canActivate=function(t,e){return this.store.select(L).take(1).map(function(t){return t.Roles.includes("Agent")})},t}();B.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],B.ctorParameters=function(){return[{type:n.Store}]},B.ngInjectableDef=e.defineInjectable({factory:function(){return new B(e.inject(n.Store))},token:B,providedIn:"root"});var z=function(){function t(t){this.store=t}return t.prototype.canActivate=function(t,e){return this.store.select(L).take(1).map(function(t){return t.Roles.includes("User")})},t}();z.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],z.ctorParameters=function(){return[{type:n.Store}]},z.ngInjectableDef=e.defineInjectable({factory:function(){return new z(e.inject(n.Store))},token:z,providedIn:"root"});var V=function(){function t(t){this.store=t}return t.prototype.canActivate=function(t,e){return this.store.select(D).take(1).map(function(t){return!t})},t}();V.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],V.ctorParameters=function(){return[{type:n.Store}]},V.ngInjectableDef=e.defineInjectable({factory:function(){return new V(e.inject(n.Store))},token:V,providedIn:"root"});var J=function(){};J.decorators=[{type:e.Component,args:[{template:"\n          <router-outlet></router-outlet>\n        "}]}];var K=function(){function t(t,e){this.configurationService=t,this.store=e,this.formId$=this.configurationService.config$.map(function(t){return t.forms.signIn})}return t.prototype.signIn=function(t){this.store.dispatch(new O(t))},t}();K.decorators=[{type:e.Component,args:[{template:"\n        <auth-signin \n                [formId]='(formId$ | async)'\n                (signedin)=\"signIn($event)\"\n        ></auth-signin>\n  "}]}],K.ctorParameters=function(){return[{type:$},{type:n.Store}]};var Q=[{path:"auth",component:J,children:[{path:"signin",canActivate:[V],component:K}]}],W=c.RouterModule.forChild(Q),X=function(){function t(){this.signedin=new e.EventEmitter}return t.prototype.signin=function(t){t.valid&&this.signedin.emit(t.value)},t}();X.decorators=[{type:e.Component,args:[{selector:"auth-signin",template:'<div fxLayout=\'row\' fxLayoutAlign="center center">\n    <ngs-form-view \n        [id]="formId"\n        (accept)="signin($event)"\n    ></ngs-form-view>\n</div>\n\x3c!-- <div>\n    <a fxFlex="nogrow" routerLink="/user/password/reset" mat-raised-button fxFlexFill>کلمه عبور خود را فراموش کرده اید؟</a>\n</div> --\x3e',styles:[""]}]}],X.ctorParameters=function(){return[]},X.propDecorators={signedin:[{type:e.Output}],formId:[{type:e.Input}]};var Y=function(){function t(t){this.configurationService=t}return t.prototype.intercept=function(t,e){return t.withCredentials=!0,e.handle(t)},t}();Y.decorators=[{type:e.Injectable}],Y.ctorParameters=function(){return[{type:$}]};var Z=function(){function t(t,e){this.router=t,this.store=e}return t.prototype.intercept=function(t,e){var n=this;return e.handle(t).map(function(t){if(t instanceof i.HttpResponse)return t})["catch"](function(t){if(t instanceof i.HttpErrorResponse&&401==t.status&&!t.url.includes("logout"))return n.store.dispatch(new T),f.Observable["throw"]("Unauthorized")})},t}();Z.decorators=[{type:e.Injectable}],Z.ctorParameters=function(){return[{type:c.Router},{type:n.Store}]};var tt=function(t,e,n){var r=this;this.actions$=t,this.router=e,this.signinService=n,this.preSignUpStart$=this.actions$.ofType(E.SIGNIN).pipe(s.switchMap(function(t){return r.signinService.signin(t.payload)}),s.map(function(t){return new w(t)}),s.catchError(function(t){return f.Observable.of(new A(t))})),this.SigninSucceed$=this.actions$.ofType(E.SIGNIN_SUCCEED).pipe(s.tap(function(t){return r.router.navigate(["/"])})),this.AfterSigninFiled$=this.actions$.ofType(E.SIGNIN_FAILURE).map(function(){return new R}),this.redirectToLoginPage$=this.actions$.ofType(E.SIGNIN_REDIRECT,E.SIGNOUT).pipe(s.tap(function(t){return r.router.navigate(["auth/signin"])}))};tt.decorators=[{type:e.Injectable}],tt.ctorParameters=function(){return[{type:y.Actions},{type:c.Router},{type:k}]},d.__decorate([y.Effect(),d.__metadata("design:type",Object)],tt.prototype,"preSignUpStart$",void 0),d.__decorate([y.Effect({dispatch:!1}),d.__metadata("design:type",Object)],tt.prototype,"SigninSucceed$",void 0),d.__decorate([y.Effect(),d.__metadata("design:type",Object)],tt.prototype,"AfterSigninFiled$",void 0),d.__decorate([y.Effect({dispatch:!1}),d.__metadata("design:type",Object)],tt.prototype,"redirectToLoginPage$",void 0);var et=function(t,e){this.actions$=t,this.router=e,this.dispachProgressingStarted$=this.actions$.ofType(E.SIGNIN).pipe(s.map(function(){return new _})),this.dispachProgressingFinished$=this.actions$.ofType(E.SIGNIN_FAILURE,E.SIGNIN_SUCCEED).pipe(s.map(function(){return new x}))};et.decorators=[{type:e.Injectable}],et.ctorParameters=function(){return[{type:y.Actions},{type:c.Router}]},d.__decorate([y.Effect(),d.__metadata("design:type",Object)],et.prototype,"dispachProgressingStarted$",void 0),d.__decorate([y.Effect(),d.__metadata("design:type",Object)],et.prototype,"dispachProgressingFinished$",void 0);var nt=function(){function t(){}return t.forRoot=function(t){return void 0===t&&(t={}),{ngModule:rt,providers:[{provide:P,useValue:t},{provide:i.HTTP_INTERCEPTORS,useClass:Z,multi:!0},{provide:i.HTTP_INTERCEPTORS,useClass:Y,multi:!0},k]}},t}();nt.decorators=[{type:e.NgModule,args:[{imports:[m.CommonModule,c.RouterModule,b.FormsModule,i.HttpClientModule,v.FlexLayoutModule,a.MatIconModule,a.MatButtonModule,a.MatCardModule,a.MatSnackBarModule,a.MatSidenavModule,a.MatExpansionModule,a.MatSelectModule,a.MatFormFieldModule,a.MatListModule,a.MatMenuModule,a.MatRadioModule,a.MatInputModule,a.MatToolbarModule,a.MatDatepickerModule,a.MatProgressBarModule,S.BrowserAnimationsModule,b.ReactiveFormsModule,b.FormsModule,j.NgsFormModule],declarations:[K,X,J],providers:[],exports:[]}]}];var rt=function(){};rt.decorators=[{type:e.NgModule,args:[{imports:[n.StoreModule.forFeature("authentication",q),y.EffectsModule.forFeature([tt,et]),W,nt]}]}],t.UserModel=N,t.SignInActionTypes=E,t.SignoutAction=T,t.SigninService=k,t.SigninServiceStub={},t.NgsAuthenticationModule=nt,t.RootNgsAuthenticationModule=rt,t.ɵk=W,t.ɵb=P,t.ɵf=X,t.ɵj=et,t.ɵi=tt,t.ɵm=Z,t.ɵn=Y,t.ɵh=q,t.ɵl=V,t.ɵa=$,t.ɵg=J,t.ɵd=K,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-authentication.umd.min.js.map
