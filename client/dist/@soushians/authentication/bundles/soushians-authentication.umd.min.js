!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ngrx/store"),require("rxjs"),require("@soushians/config"),require("@angular/router"),require("rxjs/add/operator/do"),require("rxjs/Observable"),require("@angular/common/http"),require("@angular/material"),require("rxjs/operators"),require("tslib"),require("rxjs/add/operator/map"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/catch"),require("rxjs/add/observable/empty"),require("@ngrx/effects"),require("@angular/common"),require("@angular/flex-layout"),require("@angular/platform-browser/animations"),require("@angular/forms"),require("@soushians/form")):"function"==typeof define&&define.amd?define("@soushians/authentication",["exports","@angular/core","@ngrx/store","rxjs","@soushians/config","@angular/router","rxjs/add/operator/do","rxjs/Observable","@angular/common/http","@angular/material","rxjs/operators","tslib","rxjs/add/operator/map","rxjs/add/operator/mergeMap","rxjs/add/operator/catch","rxjs/add/observable/empty","@ngrx/effects","@angular/common","@angular/flex-layout","@angular/platform-browser/animations","@angular/forms","@soushians/form"],e):e((t.soushians=t.soushians||{},t.soushians.authentication={}),t.ng.core,null,null,null,t.ng.router,t.Rx.Observable.prototype,t.Rx,t.ng.common.http,t.ng.material,t.Rx.Observable.prototype,t.tslib,t.Rx.Observable.prototype,t.Rx.Observable.prototype,t.Rx.Observable.prototype,t.Rx.Observable,null,t.ng.common,t.ng["flex-layout"],t.ng.platformBrowser.animations,t.ng.forms,null)}(this,function(t,e,n,r,o,i,a,s,u,c,p,f,d,l,g,h,y,m,I,v,S,b){"use strict";var M,j=function(e){var n=this;this.Roles=[],e&&Object.keys(e).forEach(function(t){t in e&&(n[t]=e[t])})};!function(t){var e=function(){};t.Request=e;var n=function(){function t(e){var n=this;Object.keys(e).forEach(function(t){return n[t]=e[t]})}return t.prototype.extractData=function(){return this.Result.User},t}();t.Response=n}(M||(M={}));var N=function(){this.type="[AUTHENTICATION] PROGRESSING_STARTED"},_=function(){this.type="[AUTHENTICATION] PROGRESSING_FINISHED"},x=function(){this.type="[captcha] new captcha"},R={SIGNIN:"[Auth] Signin",SIGNOUT:"[Auth] Signout",SIGNIN_SUCCEED:"[Auth] Signin Success",SIGNIN_FAILURE:"[Auth] Signin Failure",SIGNIN_REDIRECT:"[Auth] Signin Redirect"},E=function(t){this.payload=t,this.type=R.SIGNIN},O=function(t){this.payload=t,this.type=R.SIGNIN_SUCCEED},A=function(t){this.payload=t,this.type=R.SIGNIN_FAILURE},T=function(){this.type=R.SIGNOUT},w={endpoints:{signOut:"",signIn:"",userInformation:""},forms:{signIn:""},env:{production:!1}},C=new e.InjectionToken("ModuleConfig"),P={loggedIn:!1,user:new j({Id:1})};var $={userStatus:function(t,e){switch(void 0===t&&(t=P),e.type){case R.SIGNIN_SUCCEED:return Object.assign({},t,{loggedIn:!0,user:e.payload});case R.SIGNOUT:return P;default:return t}}},G=n.createFeatureSelector("authentication"),F=n.createSelector(G,function(t){return t.userStatus}),q=n.createSelector(F,function(t){return t.loggedIn}),U=n.createSelector(F,function(t){return t.user}),k=function(){function t(t){this.store=t}return t.prototype.canActivate=function(t,e){return this.store.select(U).take(1).map(function(t){return t.Roles.includes("Admin")})},t}();k.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],k.ctorParameters=function(){return[{type:n.Store}]},k.ngInjectableDef=e.defineInjectable({factory:function(){return new k(e.inject(n.Store))},token:k,providedIn:"root"});var D=function(){function t(t){this.store=t}return t.prototype.canActivate=function(t,e){return this.store.select(U).take(1).map(function(t){return t.Roles.includes("Agent")})},t}();D.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],D.ctorParameters=function(){return[{type:n.Store}]},D.ngInjectableDef=e.defineInjectable({factory:function(){return new D(e.inject(n.Store))},token:D,providedIn:"root"});var L=function(){function t(t){this.store=t}return t.prototype.canActivate=function(t,e){return this.store.select(U).take(1).map(function(t){return t.Roles.includes("User")})},t}();L.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],L.ctorParameters=function(){return[{type:n.Store}]},L.ngInjectableDef=e.defineInjectable({factory:function(){return new L(e.inject(n.Store))},token:L,providedIn:"root"});var H=function(){function t(t){this.store=t}return t.prototype.canActivate=function(t,e){return this.store.select(q).take(1).map(function(t){return!t})},t}();H.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],H.ctorParameters=function(){return[{type:n.Store}]},H.ngInjectableDef=e.defineInjectable({factory:function(){return new H(e.inject(n.Store))},token:H,providedIn:"root"});var B=function(){};B.decorators=[{type:e.Component,args:[{template:"\n          <router-outlet></router-outlet>\n        "}]}];var z=function(){function t(t,e){var n=this;this.store=e,this.config$=new r.BehaviorSubject(this._config),this._config=Object.assign({},w,t),this.config$.next(this._config),this.store.select(o.getAuthenticationModuleConfig).subscribe(function(t){t&&(n._config=Object.assign({},n._config,t.Config),n.config$.next(n._config))})}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t}();z.decorators=[{type:e.Injectable}],z.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[C]}]},{type:n.Store}]};var V=function(){function t(t,e){this.configurationService=t,this.store=e,this.formId$=this.configurationService.config$.map(function(t){return t.forms.signIn})}return t.prototype.signIn=function(t){this.store.dispatch(new E(t))},t}();V.decorators=[{type:e.Component,args:[{template:"\n        <auth-signin \n                [formId]='(formId$ | async)'\n                (signedin)=\"signIn($event)\"\n        ></auth-signin>\n  "}]}],V.ctorParameters=function(){return[{type:z},{type:n.Store}]};var J=[{path:"auth",component:B,children:[{path:"signin",canActivate:[H],component:V}]}],K=i.RouterModule.forChild(J),Q=function(){function t(){this.signedin=new e.EventEmitter}return t.prototype.signin=function(t){t.valid&&this.signedin.emit(t.value)},t}();Q.decorators=[{type:e.Component,args:[{selector:"auth-signin",template:'<div fxLayout=\'row\' fxLayoutAlign="center center">\n    <ngs-form-view \n        [id]="formId"\n        (accept)="signin($event)"\n    ></ngs-form-view>\n</div>\n\x3c!-- <div>\n    <a fxFlex="nogrow" routerLink="/user/password/reset" mat-raised-button fxFlexFill>کلمه عبور خود را فراموش کرده اید؟</a>\n</div> --\x3e',styles:[""]}]}],Q.ctorParameters=function(){return[]},Q.propDecorators={signedin:[{type:e.Output}],formId:[{type:e.Input}]};var W=function(){function t(t){this.configurationService=t}return t.prototype.intercept=function(t,e){return t.withCredentials=!0,e.handle(t)},t}();W.decorators=[{type:e.Injectable}],W.ctorParameters=function(){return[{type:z}]};var X=function(){function t(t,e){this.router=t,this.store=e}return t.prototype.intercept=function(t,e){var n=this;return e.handle(t).map(function(t){if(t instanceof u.HttpResponse)return t})["catch"](function(t){if(t instanceof u.HttpErrorResponse&&401==t.status&&!t.url.includes("logout"))return n.store.dispatch(new T),s.Observable["throw"]("Unauthorized")})},t}();X.decorators=[{type:e.Injectable}],X.ctorParameters=function(){return[{type:i.Router},{type:n.Store}]};var Y=function(){function t(t,e,n){this.http=t,this.configurationService=e,this.snackBar=n}return t.prototype.signin=function(e){var n=this;return this.configurationService.config$.pipe(p.filter(function(t){return""!=t.endpoints.signIn}),p.take(1),p.switchMap(function(t){return n.http.post(n.configurationService.config.endpoints.signIn,e)}),p.map(function(t){return new M.Response(t).extractData()}))},t.prototype.signout=function(){return localStorage.removeItem("[APP] SIGNIN_RESPONSE"),this.http.get(this.configurationService.config.endpoints.signOut,{withCredentials:!0}).map(function(t){return t})},t}();Y.decorators=[{type:e.Injectable}],Y.ctorParameters=function(){return[{type:u.HttpClient},{type:z},{type:c.MatSnackBar}]};var Z=function(t,e,n){var r=this;this.actions$=t,this.router=e,this.signinService=n,this.preSignUpStart$=this.actions$.ofType(R.SIGNIN).pipe(p.switchMap(function(t){return r.signinService.signin(t.payload)}),p.map(function(t){return new O(t)}),p.catchError(function(t){return s.Observable.of(new A(t))})),this.SigninSucceed$=this.actions$.ofType(R.SIGNIN_SUCCEED).pipe(p.tap(function(t){return r.router.navigate(["/"])})),this.AfterSigninFiled$=this.actions$.ofType(R.SIGNIN_FAILURE).map(function(){return new x}),this.redirectToLoginPage$=this.actions$.ofType(R.SIGNIN_REDIRECT,R.SIGNOUT).pipe(p.tap(function(t){return r.router.navigate(["auth/signin"])}))};Z.decorators=[{type:e.Injectable}],Z.ctorParameters=function(){return[{type:y.Actions},{type:i.Router},{type:Y}]},f.__decorate([y.Effect(),f.__metadata("design:type",Object)],Z.prototype,"preSignUpStart$",void 0),f.__decorate([y.Effect({dispatch:!1}),f.__metadata("design:type",Object)],Z.prototype,"SigninSucceed$",void 0),f.__decorate([y.Effect(),f.__metadata("design:type",Object)],Z.prototype,"AfterSigninFiled$",void 0),f.__decorate([y.Effect({dispatch:!1}),f.__metadata("design:type",Object)],Z.prototype,"redirectToLoginPage$",void 0);var tt=function(t,e){this.actions$=t,this.router=e,this.dispachProgressingStarted$=this.actions$.ofType(R.SIGNIN).pipe(p.map(function(){return new N})),this.dispachProgressingFinished$=this.actions$.ofType(R.SIGNIN_FAILURE,R.SIGNIN_SUCCEED).pipe(p.map(function(){return new _}))};tt.decorators=[{type:e.Injectable}],tt.ctorParameters=function(){return[{type:y.Actions},{type:i.Router}]},f.__decorate([y.Effect(),f.__metadata("design:type",Object)],tt.prototype,"dispachProgressingStarted$",void 0),f.__decorate([y.Effect(),f.__metadata("design:type",Object)],tt.prototype,"dispachProgressingFinished$",void 0);var et=function(){function t(){}return t.forRoot=function(t){return void 0===t&&(t={}),{ngModule:nt,providers:[{provide:C,useValue:t},{provide:u.HTTP_INTERCEPTORS,useClass:X,multi:!0},{provide:u.HTTP_INTERCEPTORS,useClass:W,multi:!0}]}},t}();et.decorators=[{type:e.NgModule,args:[{imports:[m.CommonModule,i.RouterModule,S.FormsModule,u.HttpClientModule,I.FlexLayoutModule,c.MatIconModule,c.MatButtonModule,c.MatCardModule,c.MatSnackBarModule,c.MatSidenavModule,c.MatExpansionModule,c.MatSelectModule,c.MatFormFieldModule,c.MatListModule,c.MatMenuModule,c.MatRadioModule,c.MatInputModule,c.MatToolbarModule,c.MatDatepickerModule,c.MatProgressBarModule,v.BrowserAnimationsModule,S.ReactiveFormsModule,S.FormsModule,b.NgsFormModule],declarations:[V,Q,B],exports:[]}]}];var nt=function(){};nt.decorators=[{type:e.NgModule,args:[{imports:[n.StoreModule.forFeature("authentication",$),y.EffectsModule.forFeature([Z,tt]),K,et]}]}],t.UserModel=j,t.SignInActionTypes=R,t.SignoutAction=T,t.NgsAuthenticationModule=et,t.RootNgsAuthenticationModule=nt,t.ɵl=K,t.ɵc=C,t.ɵf=Q,t.ɵk=tt,t.ɵi=Z,t.ɵn=X,t.ɵo=W,t.ɵh=$,t.ɵm=H,t.ɵb=z,t.ɵj=Y,t.ɵg=B,t.ɵa=V,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-authentication.umd.min.js.map
