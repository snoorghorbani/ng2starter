!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@ngrx/store"),require("@angular/forms"),require("@angular/core"),require("@angular/common/http"),require("rxjs/Rx"),require("@angular/router"),require("rxjs/Observable"),require("@ngrx/effects"),require("rxjs/observable/of"),require("rxjs/operators"),require("@angular/common"),require("@angular/flex-layout"),require("@angular/material"),require("@angular/platform-browser"),require("@angular/platform-browser/animations"),require("@soushians/shared")):"function"==typeof define&&define.amd?define("@soushians/source",["exports","@ngrx/store","@angular/forms","@angular/core","@angular/common/http","rxjs/Rx","@angular/router","rxjs/Observable","@ngrx/effects","rxjs/observable/of","rxjs/operators","@angular/common","@angular/flex-layout","@angular/material","@angular/platform-browser","@angular/platform-browser/animations","@soushians/shared"],e):e((t.soushians=t.soushians||{},t.soushians.source={}),null,t.ng.forms,t.ng.core,t.ng.common.http,t.rxjs.Rx,t.ng.router,t.rxjs.Observable,null,t.rxjs["observable/of"],t.rxjs.operators,t.ng.common,t.ng["flex-layout"],t.ng.material,t.ng.platformBrowser,t.ng.platformBrowser.animations,null)}(this,function(t,e,n,r,o,a,i,u,c,s,l,d,f,m,p,h,x){"use strict";var y=function(){return(y=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function v(t,e,r,o){var n,a=arguments.length,i=a<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,o);else for(var u=t.length-1;0<=u;u--)(n=t[u])&&(i=(a<3?n(i):3<a?n(e,r,i):n(e,r))||i);return 3<a&&i&&Object.defineProperty(e,r,i),i}function g(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var b="[SOURCE] source submit",F="[SOURCE] source submit succeed",M="[SOURCE] source submit failed",w=function D(t){this.payload=t,this.type=b},I=function V(){this.type=F},S=function _(){this.type=M},q={data:[]};function j(t,e){switch(void 0===t&&(t=q),e.type){case b:case F:case M:return y({},t);default:return t}}var R,C,L={sources:j},O=e.createFeatureSelector("source");e.createSelector(O,function(t){return t.list});!function(t){var e=function(){function t(e){void 0===e&&(e={});var r=this;Object.keys(e).forEach(function(t){return r[t]=e[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=e;var r=function o(){};t.Response=r}(R||(R={})),function(t){var e=function(){function t(e){void 0===e&&(e={});var r=this;Object.keys(e).forEach(function(t){return r[t]=e[t]})}return t.prototype.getRequestBody=function(){return{_id:this._id,Endpoint:this.Endpoint,Interval:this.Interval,IsActive:this.IsActive,Thresholds:this.Thresholds}},Object.defineProperty(t,"formGroup",{get:function(){return new n.FormGroup({_id:new n.FormControl("",[n.Validators.required]),Endpoint:new n.FormControl("",[n.Validators.required]),Interval:new n.FormControl("",[n.Validators.required]),IsActive:new n.FormControl("false",[n.Validators.required]),Thresholds:new n.FormArray([])})},enumerable:!0,configurable:!0}),t}();t.Request=e;var r=function o(){};t.Response=r}(C||(C={}));var A=function(){function t(t){this.http=t}return t.prototype.getSources=function(){return this.http.get("http://localhost:3000/api/source").map(function(t){return t})["catch"](function(t){return a.Observable["throw"](t)})},t.prototype.getSourceById=function(t){return this.http.get("http://localhost:3000/api/source/"+t).map(function(t){return t.Result})["catch"](function(t){return a.Observable["throw"](t)})},t.prototype.upsertSource=function(t){var e=new C.Request(t);return this.http.put("http://localhost:3000/api/source",e.getRequestBody(),{withCredentials:!1}).map(function(t){return t})["catch"](function(t){return a.Observable["throw"](t)})},t.prototype.getData=function(t,e){return void 0===e&&(e=0),this.http.get("http://localhost:3000/api/data",{params:{sourceId:t._id,time:null}}).map(function(t){return t.Result})},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.HttpClient}]},t.ngInjectableDef=r.defineInjectable({factory:function(){return new t(r.inject(o.HttpClient))},token:t,providedIn:"root"}),t}(),E=function(){function t(t){this.service=t}return t.prototype.ngOnInit=function(){},t.decorators=[{type:r.Component,args:[{selector:"source-module-container",template:'<div fxLayoutAlign="" fxflex="100" fxLayout="column">\n    <router-outlet></router-outlet>\n</div>\n'}]}],t.ctorParameters=function(){return[{type:A}]},t}(),G=function(){function t(t){this.sourceService=t,this.sources=this.sourceService.getSources()}return t.prototype.ngOnInit=function(){},t.decorators=[{type:r.Component,args:[{selector:"source-list",template:'<div fxFlexLayout="row" fxLayoutWrap fxLayoutAlign="start center">\n  <mat-card class="source-box" *ngFor="let source of (sources | async)?.Result" [fxFlex]="32">\n      <mat-card-title fxFlexLayout="row" flexLayoutAlign="space-between center">\n        \n        <a [routerLink]="[\'edit\' ,  source._id]" fxFlex="40px">\n          <mat-icon fxLayoutAlign="start center" aria-label="edit source">edit</mat-icon>\n        </a>\n        <span fxFlex fxLayoutAlign="end center" fxFlexAlign="center">{{source.Endpoint}}</span>\n      </mat-card-title>\n    \n  </mat-card>\n\n  <div fxLayoutAlign=\'end center\'>\n    <button mat-fab routerLink="../source/add" class="add-btn">\n      <mat-icon>add</mat-icon>\n    </button>\n  </div>\n</div>\n\n\n',styles:[":host{width:100%}.source-box{margin:5px}.source-box a{text-decoration:none}.add-btn{position:fixed;bottom:50px;left:25px;z-index:1}"]}]}],t.ctorParameters=function(){return[{type:A}]},t}(),T=function(){function t(t,e,r,o){var n=this;this.sourceService=t,this.formBuilder=e,this.route=r,this.store=o,this.formGroup=C.Request.formGroup,this.types=["critical","goal"],this.thresholds=this.formGroup.controls.Thresholds.controls,this.route.params.subscribe(function(t){var e=t.id;e&&n.sourceService.getSourceById(e).subscribe(function(t){n.formGroup.patchValue({_id:t._id,Endpoint:t.Endpoint,Interval:t.Interval,IsActive:t.IsActive||!1,Thresholds:t.Thresholds}),t.Thresholds.forEach(function(t){return n.addItem(t.Name,t.Formula,t.Message,t.Type)})})})}return t.prototype.ngOnInit=function(){},t.prototype.addItem=function(t,e,r,o){void 0===t&&(t=""),void 0===e&&(e=""),void 0===r&&(r=""),void 0===o&&(o="critical"),this.formGroup.controls.Thresholds.push(new n.FormGroup({Name:new n.FormControl(t,[n.Validators.required]),Formula:new n.FormControl(e,[n.Validators.required]),Message:new n.FormControl(r,[n.Validators.required]),Type:new n.FormControl(o,[n.Validators.required])}))},t.prototype.removeItem=function(t){this.formGroup.controls.Thresholds.removeAt(t)},t.prototype.getData=function(){var e=this,t=this.sourceService.getData(this.formGroup.value);return t.subscribe(function(t){e.data=t.Data}),t},t.prototype.add=function(t){this.store.dispatch(new w(this.formGroup.value))},t.decorators=[{type:r.Component,args:[{selector:"source-source-upsert",template:'<div fxLayout="column">\n  <div fxFlex="100">\n    <mat-card fxLayout="column" fxFlex="50">\n      <form [formGroup]="formGroup" fxLayout=\'column\'>\n\n        <mat-card-header>\n          <mat-card-title>افزودن نمودار جدید</mat-card-title>\n        </mat-card-header>\n        <mat-card-content>\n          <mat-form-field fxFlexFill>\n            <input matInput placeholder="آدرس" formControlName="Endpoint">\n          </mat-form-field>\n\n          <mat-form-field fxFlexFill>\n            <input matInput placeholder="مدت زمان به روز رسانی داده" formControlName="Interval">\n          </mat-form-field>\n          <div>\n            <mat-checkbox formControlName="IsActive" fxFlexFill>وضعیت</mat-checkbox>\n          </div>\n        </mat-card-content>\n      </form>\n    </mat-card>\n\n    <mat-card fxLayout="column" fxFlex="20">\n      <mat-card-content fxLayout="column">\n        <div>\n          <button fxFlex mat-raised-button color="primary" (click)="getData()">ساختار دیتا</button>\n        </div>\n        <div class="item-margin">\n          \x3c!-- TODO: --\x3e\n          \x3c!-- <data-mapper destination="value" [data]="data"></data-mapper> --\x3e\n        </div>\n      </mat-card-content>\n    </mat-card>\n\n    <mat-card fxLayout="column" fxFlex="30">\n      <mat-card-content fxLayout="column">\n        <div fxLayout="column" fxLayoutGap="5px">\n          <div *ngFor="let threshold of thresholds; let i=index" fxFlex="100" class="add-item">\n            <div fxLayout="column">\n              <div [formGroup]="thresholds[i]" fxLayout="column">\n                <mat-form-field fxFlexFill>\n                  <input matInput placeholder="نام" formControlName="Name">\n                </mat-form-field>\n                <mat-form-field fxFlexFill>\n                  <input class="ltr" matInput placeholder="فرمول" formControlName="Formula">\n                </mat-form-field>\n                <mat-form-field fxFlexFill>\n                  <input matInput placeholder="توضیح" formControlName="Message">\n                </mat-form-field>\n                <mat-radio-group formControlName="Type" fxFlexFill>\n                  <label>نوع :</label>\n                  <mat-radio-button *ngFor="let item of types" [value]="item" class="form-element-margin">\n                    {{item}}\n                  </mat-radio-button>\n                </mat-radio-group>\n\n                <button (click)="removeItem(i)" fxFlex mat-button color="primary" type="button">پاک کردن</button>\n              </div>\n              <br />\n            </div>\n          </div>\n        </div>\n        <div class="item-margin">\n          <button (click)="addItem()" fxFlex mat-raised-button color="primary" type="button">افزودن آستانه</button>\n        </div>\n      </mat-card-content>\n    </mat-card>\n  </div>\n  <div fxFlex="100">\n    <mat-card fxLayoutAlign="end center" fxLayout="row" fxFlex="100">\n      <mat-card-content>\n        <button mat-raised-button fxFlex color="primary" (click)="add($event)">ثبت</button>\n        <button fxFlex mat-raised-button routerLink=\'/source\'  fxLayoutGap="5px">انصراف</button>\n      </mat-card-content>\n    </mat-card>\n  </div>\n</div>\n',styles:["mat-card{margin:5px}.add-item{border:1px solid #eaeaea;padding:10px;margin:5px 0}.item-margin{margin-top:10px}button[type=submit]{margin-left:5px}.ltr{direction:ltr}.form-element-margin{margin:5px 10px}"]}]}],t.ctorParameters=function(){return[{type:A},{type:n.FormBuilder},{type:i.ActivatedRoute},{type:e.Store}]},t}(),k=[{path:"source",component:E,children:[{path:"",component:G},{path:"edit/:id",component:T},{path:"add",component:T}]}],B=i.RouterModule.forChild(k),N=function(){function t(t,e,r){var o=this;this.actions$=t,this.router=e,this.sourceService=r,this.afterSubmitSource$=this.actions$.ofType(b).pipe(l.map(function(t){return t.payload}),l.switchMap(function(t){return o.sourceService.upsertSource(t).pipe(l.map(function(t){return new I}),l.catchError(function(){return s.of(new S)}))})),this.SigninSucceed$=this.actions$.ofType(F).pipe(l.switchMap(function(){return o.router.navigate(["source"]),u.Observable.empty()}))}return t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:c.Actions},{type:i.Router},{type:A}]},v([c.Effect(),g("design:type",Object)],t.prototype,"afterSubmitSource$",void 0),v([c.Effect(),g("design:type",Object)],t.prototype,"SigninSucceed$",void 0),t}(),P=function(){function t(){}return t.decorators=[{type:r.NgModule,args:[{imports:[d.CommonModule,i.RouterModule,n.FormsModule,n.ReactiveFormsModule,o.HttpClientModule,f.FlexLayoutModule,m.MatIconModule,m.MatButtonModule,m.MatCardModule,m.MatSnackBarModule,m.MatSidenavModule,m.MatExpansionModule,m.MatSelectModule,m.MatFormFieldModule,m.MatListModule,m.MatMenuModule,m.MatCheckboxModule,m.MatRadioModule,m.MatInputModule,m.MatToolbarModule,m.MatDatepickerModule,m.MatProgressBarModule,p.BrowserModule,e.StoreModule.forFeature("source",L),h.BrowserAnimationsModule,B,c.EffectsModule.forFeature([N]),x.SharedModule],declarations:[G,T,E],exports:[]}]}],t}();t.SourceModule=P,t.ɵi=N,t.ɵa=L,t.ɵb=j,t.ɵe=A,t.ɵf=G,t.ɵd=E,t.ɵg=T,t.ɵc=B,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-source.umd.min.js.map