!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@ngrx/store"),require("@ngrx/effects"),require("@angular/common"),require("@angular/router"),require("@angular/forms"),require("@angular/common/http"),require("@angular/flex-layout"),require("@angular/material"),require("@angular/platform-browser"),require("@angular/platform-browser/animations"),require("@soushians/shared"),require("rxjs/Rx"),require("rxjs/Observable"),require("rxjs/observable/of"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@soushians/source",["exports","@angular/core","@ngrx/store","@ngrx/effects","@angular/common","@angular/router","@angular/forms","@angular/common/http","@angular/flex-layout","@angular/material","@angular/platform-browser","@angular/platform-browser/animations","@soushians/shared","rxjs/Rx","rxjs/Observable","rxjs/observable/of","rxjs/operators"],r):r(((t=t||self).soushians=t.soushians||{},t.soushians.source={}),t.ng.core,t.store,t.effects,t.ng.common,t.ng.router,t.ng.forms,t.ng.common.http,t.ng["flex-layout"],t.ng.material,t.ng.platformBrowser,t.ng.platformBrowser.animations,t.shared,t.rxjs.Rx,t.rxjs.Observable,t.rxjs["observable/of"],t.rxjs.operators)}(this,(function(t,r,e,o,n,a,i,u,c,s,l,d,f,m,p,h,x){"use strict";var v=function(){return(v=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var n in r=arguments[e])Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);return t}).apply(this,arguments)};function y(t,r,e,o){var n,a=arguments.length,i=a<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,r,e,o);else for(var u=t.length-1;u>=0;u--)(n=t[u])&&(i=(a<3?n(i):a>3?n(r,e,i):n(r,e))||i);return a>3&&i&&Object.defineProperty(r,e,i),i}function g(t,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,r)}var b={SOURCE_SUBMIT:"[SOURCE] source submit",SOURCE_SUBMIT_SUCCEED:"[SOURCE] source submit succeed",SOURCE_SUBMIT_FAILED:"[SOURCE] source submit failed"},M=function(t){this.payload=t,this.type=b.SOURCE_SUBMIT};var F=function(){this.type=b.SOURCE_SUBMIT_SUCCEED};var S=function(){this.type=b.SOURCE_SUBMIT_FAILED};var I={data:[]};function C(t,r){switch(void 0===t&&(t=I),r.type){case b.SOURCE_SUBMIT:case b.SOURCE_SUBMIT_SUCCEED:case b.SOURCE_SUBMIT_FAILED:return v({},t);default:return t}}var w={sources:C};var R,E,O=e.createFeatureSelector("source");e.createSelector(O,(function(t){return t.list}));(function(t){var r=function(){function t(t){var r=this;void 0===t&&(t={}),Object.keys(t).forEach((function(e){return r[e]=t[e]}))}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=r;var e=function(){};t.Response=e})(R||(R={})),function(t){var r=function(){function t(t){var r=this;void 0===t&&(t={}),Object.keys(t).forEach((function(e){return r[e]=t[e]}))}return t.prototype.getRequestBody=function(){return{_id:this._id,Endpoint:this.Endpoint,Interval:this.Interval,IsActive:this.IsActive,Thresholds:this.Thresholds}},Object.defineProperty(t,"formGroup",{get:function(){return new i.FormGroup({_id:new i.FormControl("",[i.Validators.required]),Endpoint:new i.FormControl("",[i.Validators.required]),Interval:new i.FormControl("",[i.Validators.required]),IsActive:new i.FormControl("false",[i.Validators.required]),Thresholds:new i.FormArray([])})},enumerable:!0,configurable:!0}),t}();t.Request=r;var e=function(){};t.Response=e}(E||(E={}));var _=function(){function t(t){this.http=t}return t.prototype.getSources=function(){return this.http.get("http://localhost:3000/api/source").map((function(t){return t})).catch((function(t){return m.Observable.throw(t)}))},t.prototype.getSourceById=function(t){return this.http.get("http://localhost:3000/api/source/"+t).map((function(t){return t.Result})).catch((function(t){return m.Observable.throw(t)}))},t.prototype.upsertSource=function(t){var r=new E.Request(t);return this.http.put("http://localhost:3000/api/source",r.getRequestBody(),{withCredentials:!1}).map((function(t){return t})).catch((function(t){return m.Observable.throw(t)}))},t.prototype.getData=function(t,r){return void 0===r&&(r=0),this.http.get("http://localhost:3000/api/data",{params:{sourceId:t._id,time:null}}).map((function(t){return t.Result}))},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:u.HttpClient}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(u.HttpClient))},token:t,providedIn:"root"}),t}();var L=function(){function t(t){this.service=t}return t.prototype.ngOnInit=function(){},t.decorators=[{type:r.Component,args:[{selector:"source-module-container",template:'<div fxLayoutAlign="" fxflex="100" fxLayout="column">\r\n    <router-outlet></router-outlet>\r\n</div>\r\n'}]}],t.ctorParameters=function(){return[{type:_}]},t}();var q=function(){function t(t){this.sourceService=t,this.sources=this.sourceService.getSources()}return t.prototype.ngOnInit=function(){},t.decorators=[{type:r.Component,args:[{selector:"source-list",template:'<div fxFlexLayout="row" fxLayoutWrap fxLayoutAlign="start center">\r\n  <mat-card class="source-box" *ngFor="let source of (sources | async)?.Result" [fxFlex]="32">\r\n      <mat-card-title fxFlexLayout="row" flexLayoutAlign="space-between center">\r\n        \r\n        <a [routerLink]="[\'edit\' ,  source._id]" fxFlex="40px">\r\n          <mat-icon fxLayoutAlign="start center" aria-label="edit source">edit</mat-icon>\r\n        </a>\r\n        <span fxFlex fxLayoutAlign="end center" fxFlexAlign="center">{{source.Endpoint}}</span>\r\n      </mat-card-title>\r\n    \r\n  </mat-card>\r\n\r\n  <div fxLayoutAlign=\'end center\'>\r\n    <button mat-fab routerLink="../source/add" class="add-btn">\r\n      <mat-icon>add</mat-icon>\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n\r\n',styles:[":host{width:100%}.source-box{margin:5px}.source-box a{text-decoration:none}.add-btn{position:fixed;bottom:50px;left:25px;z-index:1}"]}]}],t.ctorParameters=function(){return[{type:_}]},t}();var j=function(){function t(t,r,e,o){var n=this;this.sourceService=t,this.formBuilder=r,this.route=e,this.store=o,this.formGroup=E.Request.formGroup,this.types=["critical","goal"],this.thresholds=this.formGroup.controls.Thresholds.controls,this.route.params.subscribe((function(t){var r=t.id;r&&n.sourceService.getSourceById(r).subscribe((function(t){n.formGroup.patchValue({_id:t._id,Endpoint:t.Endpoint,Interval:t.Interval,IsActive:t.IsActive||!1,Thresholds:t.Thresholds}),t.Thresholds.forEach((function(t){return n.addItem(t.Name,t.Formula,t.Message,t.Type)}))}))}))}return t.prototype.ngOnInit=function(){},t.prototype.addItem=function(t,r,e,o){void 0===t&&(t=""),void 0===r&&(r=""),void 0===e&&(e=""),void 0===o&&(o="critical"),this.formGroup.controls.Thresholds.push(new i.FormGroup({Name:new i.FormControl(t,[i.Validators.required]),Formula:new i.FormControl(r,[i.Validators.required]),Message:new i.FormControl(e,[i.Validators.required]),Type:new i.FormControl(o,[i.Validators.required])}))},t.prototype.removeItem=function(t){this.formGroup.controls.Thresholds.removeAt(t)},t.prototype.getData=function(){var t=this,r=this.sourceService.getData(this.formGroup.value);return r.subscribe((function(r){t.data=r.Data})),r},t.prototype.add=function(t){this.store.dispatch(new M(this.formGroup.value))},t.decorators=[{type:r.Component,args:[{selector:"source-source-upsert",template:'<div fxLayout="column">\r\n  <div fxFlex="100">\r\n    <mat-card fxLayout="column" fxFlex="50">\r\n      <form [formGroup]="formGroup" fxLayout=\'column\'>\r\n\r\n        <mat-card-header>\r\n          <mat-card-title>افزودن نمودار جدید</mat-card-title>\r\n        </mat-card-header>\r\n        <mat-card-content>\r\n          <mat-form-field fxFlexFill>\r\n            <input matInput placeholder="آدرس" formControlName="Endpoint">\r\n          </mat-form-field>\r\n\r\n          <mat-form-field fxFlexFill>\r\n            <input matInput placeholder="مدت زمان به روز رسانی داده" formControlName="Interval">\r\n          </mat-form-field>\r\n          <div>\r\n            <mat-checkbox formControlName="IsActive" fxFlexFill>وضعیت</mat-checkbox>\r\n          </div>\r\n        </mat-card-content>\r\n      </form>\r\n    </mat-card>\r\n\r\n    <mat-card fxLayout="column" fxFlex="20">\r\n      <mat-card-content fxLayout="column">\r\n        <div>\r\n          <button fxFlex mat-raised-button color="primary" (click)="getData()">ساختار دیتا</button>\r\n        </div>\r\n        <div class="item-margin">\r\n          \x3c!-- TODO: --\x3e\r\n          \x3c!-- <data-mapper destination="value" [data]="data"></data-mapper> --\x3e\r\n        </div>\r\n      </mat-card-content>\r\n    </mat-card>\r\n\r\n    <mat-card fxLayout="column" fxFlex="30">\r\n      <mat-card-content fxLayout="column">\r\n        <div fxLayout="column" fxLayoutGap="5px">\r\n          <div *ngFor="let threshold of thresholds; let i=index" fxFlex="100" class="add-item">\r\n            <div fxLayout="column">\r\n              <div [formGroup]="thresholds[i]" fxLayout="column">\r\n                <mat-form-field fxFlexFill>\r\n                  <input matInput placeholder="نام" formControlName="Name">\r\n                </mat-form-field>\r\n                <mat-form-field fxFlexFill>\r\n                  <input class="ltr" matInput placeholder="فرمول" formControlName="Formula">\r\n                </mat-form-field>\r\n                <mat-form-field fxFlexFill>\r\n                  <input matInput placeholder="توضیح" formControlName="Message">\r\n                </mat-form-field>\r\n                <mat-radio-group formControlName="Type" fxFlexFill>\r\n                  <label>نوع :</label>\r\n                  <mat-radio-button *ngFor="let item of types" [value]="item" class="form-element-margin">\r\n                    {{item}}\r\n                  </mat-radio-button>\r\n                </mat-radio-group>\r\n\r\n                <button (click)="removeItem(i)" fxFlex mat-button color="primary" type="button">پاک کردن</button>\r\n              </div>\r\n              <br />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class="item-margin">\r\n          <button (click)="addItem()" fxFlex mat-raised-button color="primary" type="button">افزودن آستانه</button>\r\n        </div>\r\n      </mat-card-content>\r\n    </mat-card>\r\n  </div>\r\n  <div fxFlex="100">\r\n    <mat-card fxLayoutAlign="end center" fxLayout="row" fxFlex="100">\r\n      <mat-card-content>\r\n        <button mat-raised-button fxFlex color="primary" (click)="add($event)">ثبت</button>\r\n        <button fxFlex mat-raised-button routerLink=\'/source\'  fxLayoutGap="5px">انصراف</button>\r\n      </mat-card-content>\r\n    </mat-card>\r\n  </div>\r\n</div>\r\n',styles:["mat-card{margin:5px}.add-item{border:1px solid #eaeaea;padding:10px;margin:5px 0}.item-margin{margin-top:10px}button[type=submit]{margin-left:5px}.ltr{direction:ltr}.form-element-margin{margin:5px 10px}"]}]}],t.ctorParameters=function(){return[{type:_},{type:i.FormBuilder},{type:a.ActivatedRoute},{type:e.Store}]},t}();var U=[{path:"source",component:L,children:[{path:"",component:q},{path:"edit/:id",component:j},{path:"add",component:j}]}],T=a.RouterModule.forChild(U),B=function(){function t(t,r,e){var n=this;this.actions$=t,this.router=r,this.sourceService=e,this.afterSubmitSource$=this.actions$.pipe(o.ofType(b.SOURCE_SUBMIT),x.pluck("payload"),x.switchMap((function(t){return n.sourceService.upsertSource(t).pipe(x.map((function(t){return new F})),x.catchError((function(){return h.of(new S)})))}))),this.SigninSucceed$=this.actions$.pipe(o.ofType(b.SOURCE_SUBMIT_SUCCEED),x.switchMap((function(){return n.router.navigate(["source"]),p.Observable.empty()})))}return t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:o.Actions},{type:a.Router},{type:_}]},y([o.Effect(),g("design:type",Object)],t.prototype,"afterSubmitSource$",void 0),y([o.Effect(),g("design:type",Object)],t.prototype,"SigninSucceed$",void 0),t}();var A=function(){function t(){window.___starter=window.___starter||{},window.___starter.source="8.0.10"}return t.decorators=[{type:r.NgModule,args:[{imports:[n.CommonModule,a.RouterModule,i.FormsModule,i.ReactiveFormsModule,u.HttpClientModule,c.FlexLayoutModule,s.MatIconModule,s.MatButtonModule,s.MatCardModule,s.MatSnackBarModule,s.MatSidenavModule,s.MatExpansionModule,s.MatSelectModule,s.MatFormFieldModule,s.MatListModule,s.MatMenuModule,s.MatCheckboxModule,s.MatRadioModule,s.MatInputModule,s.MatToolbarModule,s.MatDatepickerModule,s.MatProgressBarModule,l.BrowserModule,e.StoreModule.forFeature("source",w),d.BrowserAnimationsModule,T,o.EffectsModule.forFeature([B]),f.SharedModule],declarations:[q,j,L],exports:[]}]}],t.ctorParameters=function(){return[]},t}();t.SourceModule=A,t.ɵa=w,t.ɵb=C,t.ɵc=T,t.ɵd=L,t.ɵe=_,t.ɵf=q,t.ɵg=j,t.ɵi=B,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=soushians-source.umd.min.js.map