!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ngrx/store"),require("@angular/core"),require("rxjs"),require("@angular/router"),require("@angular/common/http"),require("@angular/material"),require("rxjs/operators"),require("@angular/material/snack-bar"),require("rxjs/Observable"),require("@ngrx/effects"),require("@soushians/user"),require("@angular/common"),require("@angular/flex-layout"),require("@angular/platform-browser/animations"),require("@angular/forms"),require("@soushians/form")):"function"==typeof define&&define.amd?define("@soushians/frontend-authentication",["exports","@ngrx/store","@angular/core","rxjs","@angular/router","@angular/common/http","@angular/material","rxjs/operators","@angular/material/snack-bar","rxjs/Observable","@ngrx/effects","@soushians/user","@angular/common","@angular/flex-layout","@angular/platform-browser/animations","@angular/forms","@soushians/form"],t):t((e.soushians=e.soushians||{},e.soushians["frontend-authentication"]={}),null,e.ng.core,e.rxjs,e.ng.router,e.ng.common.http,e.ng.material,e.rxjs.operators,e.ng.material["snack-bar"],e.rxjs.Observable,null,null,e.ng.common,e.ng["flex-layout"],e.ng.platformBrowser.animations,e.ng.forms,null)}(this,function(e,t,n,a,o,r,i,u,s,c,f,p,d,g,l,h,I){"use strict";var m=function(t){var n=this;this.Roles=[],t&&Object.keys(t).forEach(function(e){e in t&&(n[e]=t[e])})},y={WHO_AM_I:"[FRONTEND_AUTHENTICATION] who am i",SIGNIN:"[FRONTEND_AUTHENTICATION] Signin",DO_SIGNOUT:"[FRONTEND_AUTHENTICATION] Do Signout",SIGNOUT:"[FRONTEND_AUTHENTICATION] Signout",SIGNIN_SUCCEED:"[FRONTEND_AUTHENTICATION][Signin] Success",SIGNIN_FAILURE:"[FRONTEND_AUTHENTICATION][Signin] Failure",SIGNIN_REDIRECT:"[FRONTEND_AUTHENTICATION][Signin] Redirect",SIGNIN_REQUIRED:"[FRONTEND_AUTHENTICATION][Signin] Required"},S=function(e){this.payload=e,this.type=y.SIGNIN},v=function(e){this.payload=e,this.type=y.SIGNIN_SUCCEED},N=function(e){this.payload=e,this.type=y.SIGNIN_FAILURE},M=function(){this.type=y.DO_SIGNOUT},T=function(){this.type=y.SIGNOUT},b=function(){this.type=y.SIGNIN_REQUIRED},O=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};function E(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var u=e.length-1;0<=u;u--)(r=e[u])&&(a=(i<3?r(a):3<i?r(t,n,a):r(t,n))||a);return 3<i&&a&&Object.defineProperty(t,n,a),a}function j(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var R={loggedIn:!1,user:new m({Id:1})};function $(e,t){switch(void 0===e&&(e=R),t.type){case y.SIGNIN_SUCCEED:return O({},e,{loggedIn:!0,user:t.payload});case y.SIGNOUT:return O({},e,{loggedIn:!1,user:new m});default:return e}}var w={userStatus:$},A=t.createFeatureSelector("frontend-authentication"),_=t.createSelector(A,function(e){return e.userStatus}),x=t.createSelector(_,function(e){return e.loggedIn}),F=t.createSelector(_,function(e){return e.user}),C=function(){function e(){}return e.decorators=[{type:n.Component,args:[{template:"\n          <router-outlet></router-outlet>\n        "}]}],e}(),D={endpoints:{signIn:"/api/user/signin",signOut:"/api/user/signout",whoAmI:"/api/user/account/profile"},forms:{signIn:"5a951cfbfd791632a09b3bc6"},env:{production:!1,frontend_server:"auth/module/frontend/server/not/set",server:"auth/module/server/not/set"},afterSignoutRedirectTo:"/"},U=new n.InjectionToken("ModuleConfig"),G=function(){function e(e,t){this.store=t,this.config$=new a.BehaviorSubject(this._config),this._config=Object.assign({},D,e),this.config$.next(this._config)}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Inject,args:[U]}]},{type:t.Store}]},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e(n.inject(U),n.inject(t.Store))},token:e,providedIn:"root"}),e}(),q=function(){function e(e,t){this.configurationService=e,this.store=t,this.signedIn$=new n.EventEmitter,this.formId$=this.configurationService.config$.map(function(e){return e.forms.signIn})}return e.prototype.signIn=function(e){this.store.dispatch(new S(e)),this.signedIn$.emit(!0)},e.decorators=[{type:n.Component,args:[{template:"\n        <auth-signin \n                [formId]='(formId$ | async)'\n                (signedin)=\"signIn($event)\"\n        ></auth-signin>\n  "}]}],e.ctorParameters=function(){return[{type:G},{type:t.Store}]},e.propDecorators={signedIn$:[{type:n.Output}]},e}(),k=[{path:"auth/frontend",component:C,children:[{path:"signin",component:q}]}],H=o.RouterModule.forChild(k),P=function(){function e(){this.signedin=new n.EventEmitter}return e.prototype.signin=function(e){e.valid&&this.signedin.emit(e.value)},e.decorators=[{type:n.Component,args:[{selector:"auth-signin",template:'<div fxLayout=\'row\' fxLayoutAlign="center center">\n    <ngs-form-view \n        [id]="formId"\n        [card]="true"\n        (accept)="signin($event)"\n    ></ngs-form-view>\n</div>\n\x3c!-- <div>\n    <a fxFlex="nogrow" routerLink="/user/password/reset" mat-raised-button fxFlexFill>کلمه عبور خود را فراموش کرده اید؟</a>\n</div> --\x3e',styles:[""]}]}],e.ctorParameters=function(){return[]},e.propDecorators={signedin:[{type:n.Output}],formId:[{type:n.Input}]},e}(),B=function(){function e(e,t,n,o){this.http=e,this.store=t,this.configurationService=n,this.snackBar=o}return e.prototype.signin=function(t){var n=this;return this.configurationService.config$.subscribe(function(e){}),this.configurationService.config$.pipe(u.filter(function(e){return""!=e.endpoints.signIn}),u.take(1),u.switchMap(function(e){return n.http.post(e.env.frontend_server+e.endpoints.signIn,{token:t})}),u.map(function(e){var t=Object.assign({},e.Result);return t.Role&&(t.Roles=[t.Role]),t}))},e.prototype.signout=function(){return this.http.get(this.configurationService.config.env.frontend_server+this.configurationService.config.endpoints.signOut).map(function(e){return e})},e.prototype.whoAmI=function(){return this.http.get(this.configurationService.config.env.frontend_server+this.configurationService.config.endpoints.whoAmI).map(function(e){return e})},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:r.HttpClient},{type:t.Store},{type:G},{type:i.MatSnackBar}]},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e(n.inject(r.HttpClient),n.inject(t.Store),n.inject(G),n.inject(s.MatSnackBar))},token:e,providedIn:"root"}),e}(),L=function(){function e(e,t,n,o,r){var i=this;this.actions$=e,this.router=t,this.FrontendSigninService=n,this.configurationService=o,this.bottomSheet=r,this.whoAmI$=this.actions$.ofType(y.WHO_AM_I).pipe(u.switchMap(function(){return i.FrontendSigninService.whoAmI()}),u.map(function(e){return new v(e)}),u.catchError(function(e){return c.Observable.of(new N(e))})),this.Signin$=this.actions$.ofType(y.SIGNIN).pipe(u.pluck("payload"),u.switchMap(function(e){return i.FrontendSigninService.signin(e)}),u.map(function(e){return new v(e)}),u.catchError(function(e){return c.Observable.of(new N(e))})),this.SignInRequired$=this.actions$.ofType(y.SIGNIN_REQUIRED).pipe(u.tap(function(e){var t=i.bottomSheet.open(q,{panelClass:"clear-mat-card-box"});return t.instance.signedIn$.subscribe(function(){t.dismiss()}),t})),this.SigninSucceed$=this.actions$.ofType(y.SIGNIN_SUCCEED).pipe(u.tap(function(e){-1<location.pathname.indexOf("signin")&&i.router.navigate(["/"])})),this.DoSignout$=this.actions$.ofType(y.DO_SIGNOUT).pipe(u.switchMap(function(e){return i.FrontendSigninService.signout().pipe(u.map(function(){return new T}),u.catchError(function(e){return a.of(e)}))})),this.redirectToLoginPage$=this.actions$.ofType(y.SIGNIN_REDIRECT).pipe(u.tap(function(e){return i.router.navigate(["auth/signin"])})),this.redirectAfterSignout$=this.actions$.ofType(y.SIGNOUT).pipe(u.tap(function(e){return i.router.navigate([i.configurationService.config$.getValue().afterSignoutRedirectTo])}))}return e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:f.Actions},{type:o.Router},{type:B},{type:G},{type:i.MatBottomSheet}]},E([f.Effect(),j("design:type",Object)],e.prototype,"whoAmI$",void 0),E([f.Effect(),j("design:type",Object)],e.prototype,"Signin$",void 0),E([f.Effect({dispatch:!1}),j("design:type",Object)],e.prototype,"SignInRequired$",void 0),E([f.Effect({dispatch:!1}),j("design:type",Object)],e.prototype,"SigninSucceed$",void 0),E([f.Effect(),j("design:type",Object)],e.prototype,"DoSignout$",void 0),E([f.Effect({dispatch:!1}),j("design:type",Object)],e.prototype,"redirectToLoginPage$",void 0),E([f.Effect({dispatch:!1}),j("design:type",Object)],e.prototype,"redirectAfterSignout$",void 0),e}(),Q=function(){function e(e,t){var n=this;this.actions$=e,this.service=t,this.goToList$=this.actions$.ofType(p.UserActionTypes.REFRESH_USER_INFO).pipe(u.map(function(e){return e.payload}),u.filter(function(e){return null!=e.Token}),u.switchMap(function(e){return n.service.signin(e.Token).map(function(e){return new v(e)})}))}return e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:f.Actions},{type:B}]},E([f.Effect(),j("design:type",Object)],e.prototype,"goToList$",void 0),e}(),V=function(){function e(){}return e.forRoot=function(e){return void 0===e&&(e={}),{ngModule:W,providers:[{provide:U,useValue:e},B]}},e.decorators=[{type:n.NgModule,args:[{imports:[d.CommonModule,o.RouterModule,h.FormsModule,r.HttpClientModule,g.FlexLayoutModule,i.MatIconModule,i.MatButtonModule,i.MatCardModule,i.MatSnackBarModule,i.MatSidenavModule,i.MatExpansionModule,i.MatSelectModule,i.MatBottomSheetModule,i.MatFormFieldModule,i.MatListModule,i.MatMenuModule,i.MatRadioModule,i.MatInputModule,i.MatToolbarModule,i.MatDatepickerModule,i.MatProgressBarModule,l.BrowserAnimationsModule,h.ReactiveFormsModule,h.FormsModule,I.NgsFormModule],declarations:[q,P,C],entryComponents:[q],providers:[],exports:[]}]}],e}(),W=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{imports:[t.StoreModule.forFeature("frontend-authentication",w),f.EffectsModule.forFeature([Q,L]),H,V]}]}],e}();e.UserModel=m,e.SignInActionTypes=y,e.DoSignoutAction=M,e.SigninRequiredAction=b,e.getFrontendAuthenticationState=x,e.getFrontendUser=F,e.NgsFrontendAuthenticationModule=V,e.ɵg=P,e.ɵm=L,e.ɵn=H,e.ɵd=U,e.ɵk=Q,e.ɵa=W,e.ɵi=w,e.ɵj=$,e.ɵc=G,e.ɵl=B,e.ɵh=C,e.ɵb=q,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-frontend-authentication.umd.min.js.map