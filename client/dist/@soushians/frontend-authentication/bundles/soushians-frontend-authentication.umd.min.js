!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@ngrx/store"),require("@angular/core"),require("@angular/common"),require("@angular/router"),require("@angular/common/http"),require("@angular/flex-layout"),require("@angular/material"),require("@angular/platform-browser/animations"),require("@angular/forms"),require("@ngrx/effects"),require("@soushians/form"),require("rxjs"),require("rxjs/operators"),require("@angular/material/snack-bar"),require("@soushians/user")):"function"==typeof define&&define.amd?define("@soushians/frontend-authentication",["exports","@ngrx/store","@angular/core","@angular/common","@angular/router","@angular/common/http","@angular/flex-layout","@angular/material","@angular/platform-browser/animations","@angular/forms","@ngrx/effects","@soushians/form","rxjs","rxjs/operators","@angular/material/snack-bar","@soushians/user"],e):e(((t=t||self).soushians=t.soushians||{},t.soushians["frontend-authentication"]={}),t.store,t.ng.core,t.ng.common,t.ng.router,t.ng.common.http,t.ng["flex-layout"],t.ng.material,t.ng.platformBrowser.animations,t.ng.forms,t.effects,t.form,t.rxjs,t.rxjs.operators,t.ng.material["snack-bar"],t.user)}(this,(function(t,e,n,r,o,i,a,u,s,c,f,p,d,g,l,h){"use strict";var I=function(){return(I=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function m(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function y(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var v=function(t){var e=this;this.Roles=[],t&&Object.keys(t).forEach((function(n){n in t&&(e[n]=t[n])}))};var S={WHO_AM_I:"[FRONTEND_AUTHENTICATION] who am i",SIGNIN:"[FRONTEND_AUTHENTICATION] Signin",DO_SIGNOUT:"[FRONTEND_AUTHENTICATION] Do Signout",SIGNOUT:"[FRONTEND_AUTHENTICATION] Signout",SIGNIN_SUCCEED:"[FRONTEND_AUTHENTICATION][Signin] Success",SIGNIN_FAILURE:"[FRONTEND_AUTHENTICATION][Signin] Failure",SIGNIN_REDIRECT:"[FRONTEND_AUTHENTICATION][Signin] Redirect",SIGNIN_REQUIRED:"[FRONTEND_AUTHENTICATION][Signin] Required"};var N=function(t){this.payload=t,this.type=S.SIGNIN};var M=function(t){this.payload=t,this.type=S.SIGNIN_SUCCEED};var T=function(t){this.payload=t,this.type=S.SIGNIN_FAILURE};var E=function(){this.type=S.DO_SIGNOUT};var O=function(){this.type=S.SIGNOUT};var b=function(){this.type=S.SIGNIN_REQUIRED};var _={loggedIn:!1,user:new v({Id:1})};function R(t,e){switch(void 0===t&&(t=_),e.type){case S.SIGNIN_SUCCEED:return I({},t,{loggedIn:!0,user:e.payload});case S.SIGNOUT:return I({},t,{loggedIn:!1,user:new v});default:return t}}var w=function(t){return t.loggedIn},j=function(t){return t.user};var $={userStatus:R},A=e.createFeatureSelector("frontend-authentication"),x=e.createSelector(A,(function(t){return t.userStatus})),C=e.createSelector(x,w),D=e.createSelector(x,j),F=function(){function t(){}return t.decorators=[{type:n.Component,args:[{template:"\n          <router-outlet></router-outlet>\n        "}]}],t}();var U={endpoints:{signIn:"/api/user/signin",signOut:"/api/user/signout",whoAmI:"/api/user/account/profile"},forms:{signIn:"5a951cfbfd791632a09b3bc6"},env:{production:!1,frontend_server:"auth/module/frontend/server/not/set",server:"auth/module/server/not/set"},afterSignoutRedirectTo:"/"},G=new n.InjectionToken("ModuleConfig"),q=function(){function t(t,e){this.store=e,this.config$=new d.BehaviorSubject(this._config),this._config=Object.assign({},U,t),this.config$.next(this._config)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:void 0,decorators:[{type:n.Inject,args:[G]}]},{type:e.Store}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(G),n.ɵɵinject(e.Store))},token:t,providedIn:"root"}),t}();var k=function(){function t(t,e){this.configurationService=t,this.store=e,this.signedIn$=new n.EventEmitter,this.formId$=this.configurationService.config$.map((function(t){return t.forms.signIn}))}return t.prototype.signIn=function(t){this.store.dispatch(new N(t)),this.signedIn$.emit(!0)},t.decorators=[{type:n.Component,args:[{template:"\n        <auth-signin \n                [formId]='(formId$ | async)'\n                (signedin)=\"signIn($event)\"\n        ></auth-signin>\n  "}]}],t.ctorParameters=function(){return[{type:q},{type:e.Store}]},t.propDecorators={signedIn$:[{type:n.Output}]},t}();var P=[{path:"auth/frontend",component:F,children:[{path:"signin",component:k}]}],H=o.RouterModule.forChild(P),B=function(){function t(){this.signedin=new n.EventEmitter}return t.prototype.signin=function(t){t.valid&&this.signedin.emit(t.value)},t.decorators=[{type:n.Component,args:[{selector:"auth-signin",template:'<div fxLayout=\'row\' fxLayoutAlign="center center">\r\n    <ngs-form-view \r\n        [id]="formId"\r\n        [card]="true"\r\n        (accept)="signin($event)"\r\n    ></ngs-form-view>\r\n</div>\r\n\x3c!-- <div>\r\n    <a fxFlex="nogrow" routerLink="/user/password/reset" mat-raised-button fxFlexFill>کلمه عبور خود را فراموش کرده اید؟</a>\r\n</div> --\x3e',styles:[""]}]}],t.ctorParameters=function(){return[]},t.propDecorators={signedin:[{type:n.Output}],formId:[{type:n.Input}]},t}();var L=function(){function t(t,e,n,r){this.http=t,this.store=e,this.configurationService=n,this.snackBar=r}return t.prototype.signin=function(t){var e=this;return this.configurationService.config$.subscribe((function(t){})),this.configurationService.config$.pipe(g.filter((function(t){return""!=t.endpoints.signIn})),g.take(1),g.switchMap((function(n){return e.http.post(n.env.frontend_server+n.endpoints.signIn,{token:t})})),g.map((function(t){var e=Object.assign({},t.Result);return e.Role&&(e.Roles=[e.Role]),e})))},t.prototype.signout=function(){return this.http.get(this.configurationService.config.env.frontend_server+this.configurationService.config.endpoints.signOut).map((function(t){return t}))},t.prototype.whoAmI=function(){return this.http.get(this.configurationService.config.env.frontend_server+this.configurationService.config.endpoints.whoAmI).map((function(t){return t}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:e.Store},{type:q},{type:u.MatSnackBar}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(i.HttpClient),n.ɵɵinject(e.Store),n.ɵɵinject(q),n.ɵɵinject(l.MatSnackBar))},token:t,providedIn:"root"}),t}();var Q=function(){function t(t,e,n,r,o){var i=this;this.actions$=t,this.router=e,this.frontendSigninService=n,this.configurationService=r,this.bottomSheet=o,this.whoAmI$=this.actions$.pipe(f.ofType(S.WHO_AM_I),g.switchMap((function(){return i.frontendSigninService.whoAmI()})),g.map((function(t){return new M(t)})),g.catchError((function(t){return d.of(new T(t))}))),this.Signin$=this.actions$.pipe(f.ofType(S.SIGNIN),g.pluck("payload"),g.switchMap((function(t){return i.frontendSigninService.signin(t)})),g.map((function(t){return new M(t)})),g.catchError((function(t){return d.of(new T(t))}))),this.SignInRequired$=this.actions$.pipe(f.ofType(S.SIGNIN_REQUIRED),g.tap((function(t){var e=i.bottomSheet.open(k,{panelClass:"clear-mat-card-box"});return e.instance.signedIn$.subscribe((function(){e.dismiss()})),e}))),this.SigninSucceed$=this.actions$.pipe(f.ofType(S.SIGNIN_SUCCEED),g.tap((function(t){location.pathname.indexOf("signin")>-1&&i.router.navigate(["/"])}))),this.DoSignout$=this.actions$.pipe(f.ofType(S.DO_SIGNOUT),g.switchMap((function(t){return i.frontendSigninService.signout().pipe(g.map((function(){return new O})),g.catchError((function(t){return d.of(t)})))}))),this.redirectToLoginPage$=this.actions$.pipe(f.ofType(S.SIGNIN_REDIRECT),g.tap((function(t){return i.router.navigate(["auth/signin"])}))),this.redirectAfterSignout$=this.actions$.pipe(f.ofType(S.SIGNOUT),g.tap((function(t){return i.router.navigate([i.configurationService.config$.getValue().afterSignoutRedirectTo])})))}return t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:o.Router},{type:L},{type:q},{type:u.MatBottomSheet}]},m([f.Effect(),y("design:type",Object)],t.prototype,"whoAmI$",void 0),m([f.Effect(),y("design:type",Object)],t.prototype,"Signin$",void 0),m([f.Effect({dispatch:!1}),y("design:type",Object)],t.prototype,"SignInRequired$",void 0),m([f.Effect({dispatch:!1}),y("design:type",Object)],t.prototype,"SigninSucceed$",void 0),m([f.Effect(),y("design:type",Object)],t.prototype,"DoSignout$",void 0),m([f.Effect({dispatch:!1}),y("design:type",Object)],t.prototype,"redirectToLoginPage$",void 0),m([f.Effect({dispatch:!1}),y("design:type",Object)],t.prototype,"redirectAfterSignout$",void 0),t}();var V=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.goToList$=this.actions$.pipe(f.ofType(h.UserActionTypes.REFRESH_USER_INFO),g.map((function(t){return t.payload})),g.filter((function(t){return null!=t.Token})),g.switchMap((function(t){return n.service.signin(t.Token).map((function(t){return new M(t)}))})))}return t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:f.Actions},{type:L}]},m([f.Effect(),y("design:type",Object)],t.prototype,"goToList$",void 0),t}();var W=function(){function t(){}return t.forRoot=function(t){return void 0===t&&(t={}),{ngModule:z,providers:[{provide:G,useValue:t},L]}},t.decorators=[{type:n.NgModule,args:[{imports:[r.CommonModule,o.RouterModule,c.FormsModule,i.HttpClientModule,a.FlexLayoutModule,u.MatIconModule,u.MatButtonModule,u.MatCardModule,u.MatSnackBarModule,u.MatSidenavModule,u.MatExpansionModule,u.MatSelectModule,u.MatBottomSheetModule,u.MatFormFieldModule,u.MatListModule,u.MatMenuModule,u.MatRadioModule,u.MatInputModule,u.MatToolbarModule,u.MatDatepickerModule,u.MatProgressBarModule,s.BrowserAnimationsModule,c.ReactiveFormsModule,c.FormsModule,p.NgsFormModule],declarations:[k,B,F],entryComponents:[k],providers:[],exports:[]}]}],t}(),z=function(){function t(){window.___starter=window.___starter||{},window.___starter.frontend_authentication="8.0.10"}return t.decorators=[{type:n.NgModule,args:[{imports:[e.StoreModule.forFeature("frontend-authentication",$),f.EffectsModule.forFeature([V,Q]),H,W]}]}],t.ctorParameters=function(){return[]},t}();t.DoSignoutAction=E,t.NgsFrontendAuthenticationModule=W,t.SignInActionTypes=S,t.SigninRequiredAction=b,t.UserModel=v,t.getFrontendAuthenticationState=C,t.getFrontendUser=D,t.ɵa=$,t.ɵb=A,t.ɵc=x,t.ɵd=z,t.ɵe=R,t.ɵf=w,t.ɵg=j,t.ɵh=k,t.ɵi=q,t.ɵj=G,t.ɵm=B,t.ɵn=F,t.ɵo=V,t.ɵp=L,t.ɵq=Q,t.ɵr=H,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=soushians-frontend-authentication.umd.min.js.map