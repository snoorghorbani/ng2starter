!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/flex-layout"),require("@angular/platform-browser/animations"),require("@angular/forms"),require("@soushians/form"),require("@angular/common/http"),require("@ngrx/store"),require("@angular/material/snack-bar"),require("@angular/router"),require("rxjs"),require("@angular/material"),require("@angular/core"),require("@ngrx/effects"),require("rxjs/operators"),require("@soushians/user")):"function"==typeof define&&define.amd?define("@soushians/frontend-authentication",["exports","@angular/common","@angular/flex-layout","@angular/platform-browser/animations","@angular/forms","@soushians/form","@angular/common/http","@ngrx/store","@angular/material/snack-bar","@angular/router","rxjs","@angular/material","@angular/core","@ngrx/effects","rxjs/operators","@soushians/user"],e):e((t.soushians=t.soushians||{},t.soushians["frontend-authentication"]={}),t.ng.common,t.ng["flex-layout"],t.ng.platformBrowser.animations,t.ng.forms,t.form,t.ng.common.http,t.i2,t.ng.material["snack-bar"],t.ng.router,t.rxjs,t.ng.material,t.ng.core,t.effects,t.rxjs.operators,t.user)}(this,function(t,e,n,o,r,i,a,u,s,c,f,p,d,g,l,h){"use strict";var I=function J(e){var n=this;this.Roles=[],e&&Object.keys(e).forEach(function(t){t in e&&(n[t]=e[t])})},m={WHO_AM_I:"[FRONTEND_AUTHENTICATION] who am i",SIGNIN:"[FRONTEND_AUTHENTICATION] Signin",DO_SIGNOUT:"[FRONTEND_AUTHENTICATION] Do Signout",SIGNOUT:"[FRONTEND_AUTHENTICATION] Signout",SIGNIN_SUCCEED:"[FRONTEND_AUTHENTICATION][Signin] Success",SIGNIN_FAILURE:"[FRONTEND_AUTHENTICATION][Signin] Failure",SIGNIN_REDIRECT:"[FRONTEND_AUTHENTICATION][Signin] Redirect",SIGNIN_REQUIRED:"[FRONTEND_AUTHENTICATION][Signin] Required"},y=function K(t){this.payload=t,this.type=m.SIGNIN},S=function X(t){this.payload=t,this.type=m.SIGNIN_SUCCEED},v=function Y(t){this.payload=t,this.type=m.SIGNIN_FAILURE},N=function Z(){this.type=m.DO_SIGNOUT},M=function tt(){this.type=m.SIGNOUT},T=function et(){this.type=m.SIGNIN_REQUIRED},E=function(){return(E=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function O(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var u=t.length-1;0<=u;u--)(r=t[u])&&(a=(i<3?r(a):3<i?r(e,n,a):r(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a}function b(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var R={loggedIn:!1,user:new I({Id:1})};function j(t,e){switch(void 0===t&&(t=R),e.type){case m.SIGNIN_SUCCEED:return E({},t,{loggedIn:!0,user:e.payload});case m.SIGNOUT:return E({},t,{loggedIn:!1,user:new I});default:return t}}var $=function(t){return t.loggedIn},w=function(t){return t.user},A={userStatus:j},_=u.createFeatureSelector("frontend-authentication"),x=u.createSelector(_,function(t){return t.userStatus}),C=u.createSelector(x,$),D=u.createSelector(x,w),F=function(){function t(){}return t.decorators=[{type:d.Component,args:[{template:"\n          <router-outlet></router-outlet>\n        "}]}],t}(),U={endpoints:{signIn:"/api/user/signin",signOut:"/api/user/signout",whoAmI:"/api/user/account/profile"},forms:{signIn:"5a951cfbfd791632a09b3bc6"},env:{production:!1,frontend_server:"auth/module/frontend/server/not/set",server:"auth/module/server/not/set"},afterSignoutRedirectTo:"/"},G=new d.InjectionToken("ModuleConfig"),q=function(){function t(t,e){this.store=e,this.config$=new f.BehaviorSubject(this._config),this._config=Object.assign({},U,t),this.config$.next(this._config)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.decorators=[{type:d.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:d.Inject,args:[G]}]},{type:u.Store}]},t.ngInjectableDef=d.defineInjectable({factory:function(){return new t(d.inject(G),d.inject(u.Store))},token:t,providedIn:"root"}),t}(),k=function(){function t(t,e){this.configurationService=t,this.store=e,this.signedIn$=new d.EventEmitter,this.formId$=this.configurationService.config$.map(function(t){return t.forms.signIn})}return t.prototype.signIn=function(t){this.store.dispatch(new y(t)),this.signedIn$.emit(!0)},t.decorators=[{type:d.Component,args:[{template:"\n        <auth-signin \n                [formId]='(formId$ | async)'\n                (signedin)=\"signIn($event)\"\n        ></auth-signin>\n  "}]}],t.ctorParameters=function(){return[{type:q},{type:u.Store}]},t.propDecorators={signedIn$:[{type:d.Output}]},t}(),H=[{path:"auth/frontend",component:F,children:[{path:"signin",component:k}]}],P=c.RouterModule.forChild(H),B=function(){function t(){this.signedin=new d.EventEmitter}return t.prototype.signin=function(t){t.valid&&this.signedin.emit(t.value)},t.decorators=[{type:d.Component,args:[{selector:"auth-signin",template:'<div fxLayout=\'row\' fxLayoutAlign="center center">\r\n    <ngs-form-view \r\n        [id]="formId"\r\n        [card]="true"\r\n        (accept)="signin($event)"\r\n    ></ngs-form-view>\r\n</div>\r\n\x3c!-- <div>\r\n    <a fxFlex="nogrow" routerLink="/user/password/reset" mat-raised-button fxFlexFill>کلمه عبور خود را فراموش کرده اید؟</a>\r\n</div> --\x3e',styles:[""]}]}],t.ctorParameters=function(){return[]},t.propDecorators={signedin:[{type:d.Output}],formId:[{type:d.Input}]},t}(),L=function(){function t(t,e,n,o){this.http=t,this.store=e,this.configurationService=n,this.snackBar=o}return t.prototype.signin=function(e){var n=this;return this.configurationService.config$.subscribe(function(t){}),this.configurationService.config$.pipe(l.filter(function(t){return""!=t.endpoints.signIn}),l.take(1),l.switchMap(function(t){return n.http.post(t.env.frontend_server+t.endpoints.signIn,{token:e})}),l.map(function(t){var e=Object.assign({},t.Result);return e.Role&&(e.Roles=[e.Role]),e}))},t.prototype.signout=function(){return this.http.get(this.configurationService.config.env.frontend_server+this.configurationService.config.endpoints.signOut).map(function(t){return t})},t.prototype.whoAmI=function(){return this.http.get(this.configurationService.config.env.frontend_server+this.configurationService.config.endpoints.whoAmI).map(function(t){return t})},t.decorators=[{type:d.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.HttpClient},{type:u.Store},{type:q},{type:p.MatSnackBar}]},t.ngInjectableDef=d.defineInjectable({factory:function(){return new t(d.inject(a.HttpClient),d.inject(u.Store),d.inject(q),d.inject(s.MatSnackBar))},token:t,providedIn:"root"}),t}(),Q=function(){function t(t,e,n,o,r){var i=this;this.actions$=t,this.router=e,this.frontendSigninService=n,this.configurationService=o,this.bottomSheet=r,this.whoAmI$=this.actions$.ofType(m.WHO_AM_I).pipe(l.switchMap(function(){return i.frontendSigninService.whoAmI()}),l.map(function(t){return new S(t)}),l.catchError(function(t){return f.of(new v(t))})),this.Signin$=this.actions$.ofType(m.SIGNIN).pipe(l.pluck("payload"),l.switchMap(function(t){return i.frontendSigninService.signin(t)}),l.map(function(t){return new S(t)}),l.catchError(function(t){return f.of(new v(t))})),this.SignInRequired$=this.actions$.ofType(m.SIGNIN_REQUIRED).pipe(l.tap(function(t){var e=i.bottomSheet.open(k,{panelClass:"clear-mat-card-box"});return e.instance.signedIn$.subscribe(function(){e.dismiss()}),e})),this.SigninSucceed$=this.actions$.ofType(m.SIGNIN_SUCCEED).pipe(l.tap(function(t){-1<location.pathname.indexOf("signin")&&i.router.navigate(["/"])})),this.DoSignout$=this.actions$.ofType(m.DO_SIGNOUT).pipe(l.switchMap(function(t){return i.frontendSigninService.signout().pipe(l.map(function(){return new M}),l.catchError(function(t){return f.of(t)}))})),this.redirectToLoginPage$=this.actions$.ofType(m.SIGNIN_REDIRECT).pipe(l.tap(function(t){return i.router.navigate(["auth/signin"])})),this.redirectAfterSignout$=this.actions$.ofType(m.SIGNOUT).pipe(l.tap(function(t){return i.router.navigate([i.configurationService.config$.getValue().afterSignoutRedirectTo])}))}return t.decorators=[{type:d.Injectable}],t.ctorParameters=function(){return[{type:g.Actions},{type:c.Router},{type:L},{type:q},{type:p.MatBottomSheet}]},O([g.Effect(),b("design:type",Object)],t.prototype,"whoAmI$",void 0),O([g.Effect(),b("design:type",Object)],t.prototype,"Signin$",void 0),O([g.Effect({dispatch:!1}),b("design:type",Object)],t.prototype,"SignInRequired$",void 0),O([g.Effect({dispatch:!1}),b("design:type",Object)],t.prototype,"SigninSucceed$",void 0),O([g.Effect(),b("design:type",Object)],t.prototype,"DoSignout$",void 0),O([g.Effect({dispatch:!1}),b("design:type",Object)],t.prototype,"redirectToLoginPage$",void 0),O([g.Effect({dispatch:!1}),b("design:type",Object)],t.prototype,"redirectAfterSignout$",void 0),t}(),V=function(){function t(t,e){var n=this;this.actions$=t,this.service=e,this.goToList$=this.actions$.ofType(h.UserActionTypes.REFRESH_USER_INFO).pipe(l.map(function(t){return t.payload}),l.filter(function(t){return null!=t.Token}),l.switchMap(function(t){return n.service.signin(t.Token).map(function(t){return new S(t)})}))}return t.decorators=[{type:d.Injectable}],t.ctorParameters=function(){return[{type:g.Actions},{type:L}]},O([g.Effect(),b("design:type",Object)],t.prototype,"goToList$",void 0),t}(),W=function(){function t(){}return t.forRoot=function(t){return void 0===t&&(t={}),{ngModule:z,providers:[{provide:G,useValue:t},L]}},t.decorators=[{type:d.NgModule,args:[{imports:[e.CommonModule,c.RouterModule,r.FormsModule,a.HttpClientModule,n.FlexLayoutModule,p.MatIconModule,p.MatButtonModule,p.MatCardModule,p.MatSnackBarModule,p.MatSidenavModule,p.MatExpansionModule,p.MatSelectModule,p.MatBottomSheetModule,p.MatFormFieldModule,p.MatListModule,p.MatMenuModule,p.MatRadioModule,p.MatInputModule,p.MatToolbarModule,p.MatDatepickerModule,p.MatProgressBarModule,o.BrowserAnimationsModule,r.ReactiveFormsModule,r.FormsModule,i.NgsFormModule],declarations:[k,B,F],entryComponents:[k],providers:[],exports:[]}]}],t}(),z=function(){function t(){}return t.decorators=[{type:d.NgModule,args:[{imports:[u.StoreModule.forFeature("frontend-authentication",A),g.EffectsModule.forFeature([V,Q]),P,W]}]}],t}();t.UserModel=I,t.SignInActionTypes=m,t.DoSignoutAction=N,t.SigninRequiredAction=T,t.getFrontendAuthenticationState=C,t.getFrontendUser=D,t.NgsFrontendAuthenticationModule=W,t.ɵm=B,t.ɵq=Q,t.ɵr=P,t.ɵj=G,t.ɵo=V,t.ɵd=z,t.ɵa=A,t.ɵc=x,t.ɵb=_,t.ɵe=j,t.ɵf=$,t.ɵg=w,t.ɵi=q,t.ɵp=L,t.ɵn=F,t.ɵh=k,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-frontend-authentication.umd.min.js.map