!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/common"),require("@angular/flex-layout"),require("@angular/material"),require("@angular/platform-browser"),require("@angular/platform-browser/animations"),require("@soushians/shared"),require("@angular/common/http"),require("rxjs/Rx"),require("@angular/forms"),require("@ngrx/store"),require("@angular/core"),require("rxjs/Observable"),require("@ngrx/effects"),require("rxjs/observable/of"),require("rxjs/operators"),require("@angular/router")):"function"==typeof define&&define.amd?define("@soushians/source",["exports","@angular/common","@angular/flex-layout","@angular/material","@angular/platform-browser","@angular/platform-browser/animations","@soushians/shared","@angular/common/http","rxjs/Rx","@angular/forms","@ngrx/store","@angular/core","rxjs/Observable","@ngrx/effects","rxjs/observable/of","rxjs/operators","@angular/router"],r):r((t.soushians=t.soushians||{},t.soushians.source={}),t.ng.common,t.ng["flex-layout"],t.ng.material,t.ng.platformBrowser,t.ng.platformBrowser.animations,t.shared,t.ng.common.http,t.rxjs.Rx,t.ng.forms,t.store,t.ng.core,t.rxjs.Observable,t.effects,t.rxjs["observable/of"],t.rxjs.operators,t.ng.router)}(this,function(t,r,e,o,n,a,i,u,c,s,l,d,f,m,p,h,x){"use strict";var y=function(){return(y=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var n in r=arguments[e])Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);return t}).apply(this,arguments)};function v(t,r,e,o){var n,a=arguments.length,i=a<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,r,e,o);else for(var u=t.length-1;0<=u;u--)(n=t[u])&&(i=(a<3?n(i):3<a?n(r,e,i):n(r,e))||i);return 3<a&&i&&Object.defineProperty(r,e,i),i}function g(t,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,r)}var b="[SOURCE] source submit",F="[SOURCE] source submit succeed",M="[SOURCE] source submit failed",w=function D(t){this.payload=t,this.type=b},I=function V(){this.type=F},S=function _(){this.type=M},q={data:[]};function j(t,r){switch(void 0===t&&(t=q),r.type){case b:case F:case M:return y({},t);default:return t}}var R,C,L={sources:j},O=l.createFeatureSelector("source");l.createSelector(O,function(t){return t.list});!function(t){var r=function(){function t(r){void 0===r&&(r={});var e=this;Object.keys(r).forEach(function(t){return e[t]=r[t]})}return t.prototype.getRequestBody=function(){return{}},t}();t.Request=r;var e=function o(){};t.Response=e}(R||(R={})),function(t){var r=function(){function t(r){void 0===r&&(r={});var e=this;Object.keys(r).forEach(function(t){return e[t]=r[t]})}return t.prototype.getRequestBody=function(){return{_id:this._id,Endpoint:this.Endpoint,Interval:this.Interval,IsActive:this.IsActive,Thresholds:this.Thresholds}},Object.defineProperty(t,"formGroup",{get:function(){return new s.FormGroup({_id:new s.FormControl("",[s.Validators.required]),Endpoint:new s.FormControl("",[s.Validators.required]),Interval:new s.FormControl("",[s.Validators.required]),IsActive:new s.FormControl("false",[s.Validators.required]),Thresholds:new s.FormArray([])})},enumerable:!0,configurable:!0}),t}();t.Request=r;var e=function o(){};t.Response=e}(C||(C={}));var A=function(){function t(t){this.http=t}return t.prototype.getSources=function(){return this.http.get("http://localhost:3000/api/source").map(function(t){return t})["catch"](function(t){return c.Observable["throw"](t)})},t.prototype.getSourceById=function(t){return this.http.get("http://localhost:3000/api/source/"+t).map(function(t){return t.Result})["catch"](function(t){return c.Observable["throw"](t)})},t.prototype.upsertSource=function(t){var r=new C.Request(t);return this.http.put("http://localhost:3000/api/source",r.getRequestBody(),{withCredentials:!1}).map(function(t){return t})["catch"](function(t){return c.Observable["throw"](t)})},t.prototype.getData=function(t,r){return void 0===r&&(r=0),this.http.get("http://localhost:3000/api/data",{params:{sourceId:t._id,time:null}}).map(function(t){return t.Result})},t.decorators=[{type:d.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:u.HttpClient}]},t.ngInjectableDef=d.defineInjectable({factory:function(){return new t(d.inject(u.HttpClient))},token:t,providedIn:"root"}),t}(),E=function(){function t(t){this.service=t}return t.prototype.ngOnInit=function(){},t.decorators=[{type:d.Component,args:[{selector:"source-module-container",template:'<div fxLayoutAlign="" fxflex="100" fxLayout="column">\r\n    <router-outlet></router-outlet>\r\n</div>\r\n'}]}],t.ctorParameters=function(){return[{type:A}]},t}(),k=function(){function t(t){this.sourceService=t,this.sources=this.sourceService.getSources()}return t.prototype.ngOnInit=function(){},t.decorators=[{type:d.Component,args:[{selector:"source-list",template:'<div fxFlexLayout="row" fxLayoutWrap fxLayoutAlign="start center">\r\n  <mat-card class="source-box" *ngFor="let source of (sources | async)?.Result" [fxFlex]="32">\r\n      <mat-card-title fxFlexLayout="row" flexLayoutAlign="space-between center">\r\n        \r\n        <a [routerLink]="[\'edit\' ,  source._id]" fxFlex="40px">\r\n          <mat-icon fxLayoutAlign="start center" aria-label="edit source">edit</mat-icon>\r\n        </a>\r\n        <span fxFlex fxLayoutAlign="end center" fxFlexAlign="center">{{source.Endpoint}}</span>\r\n      </mat-card-title>\r\n    \r\n  </mat-card>\r\n\r\n  <div fxLayoutAlign=\'end center\'>\r\n    <button mat-fab routerLink="../source/add" class="add-btn">\r\n      <mat-icon>add</mat-icon>\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n\r\n',styles:[":host{width:100%}.source-box{margin:5px}.source-box a{text-decoration:none}.add-btn{position:fixed;bottom:50px;left:25px;z-index:1}"]}]}],t.ctorParameters=function(){return[{type:A}]},t}(),G=function(){function t(t,r,e,o){var n=this;this.sourceService=t,this.formBuilder=r,this.route=e,this.store=o,this.formGroup=C.Request.formGroup,this.types=["critical","goal"],this.thresholds=this.formGroup.controls.Thresholds.controls,this.route.params.subscribe(function(t){var r=t.id;r&&n.sourceService.getSourceById(r).subscribe(function(t){n.formGroup.patchValue({_id:t._id,Endpoint:t.Endpoint,Interval:t.Interval,IsActive:t.IsActive||!1,Thresholds:t.Thresholds}),t.Thresholds.forEach(function(t){return n.addItem(t.Name,t.Formula,t.Message,t.Type)})})})}return t.prototype.ngOnInit=function(){},t.prototype.addItem=function(t,r,e,o){void 0===t&&(t=""),void 0===r&&(r=""),void 0===e&&(e=""),void 0===o&&(o="critical"),this.formGroup.controls.Thresholds.push(new s.FormGroup({Name:new s.FormControl(t,[s.Validators.required]),Formula:new s.FormControl(r,[s.Validators.required]),Message:new s.FormControl(e,[s.Validators.required]),Type:new s.FormControl(o,[s.Validators.required])}))},t.prototype.removeItem=function(t){this.formGroup.controls.Thresholds.removeAt(t)},t.prototype.getData=function(){var r=this,t=this.sourceService.getData(this.formGroup.value);return t.subscribe(function(t){r.data=t.Data}),t},t.prototype.add=function(t){this.store.dispatch(new w(this.formGroup.value))},t.decorators=[{type:d.Component,args:[{selector:"source-source-upsert",template:'<div fxLayout="column">\r\n  <div fxFlex="100">\r\n    <mat-card fxLayout="column" fxFlex="50">\r\n      <form [formGroup]="formGroup" fxLayout=\'column\'>\r\n\r\n        <mat-card-header>\r\n          <mat-card-title>افزودن نمودار جدید</mat-card-title>\r\n        </mat-card-header>\r\n        <mat-card-content>\r\n          <mat-form-field fxFlexFill>\r\n            <input matInput placeholder="آدرس" formControlName="Endpoint">\r\n          </mat-form-field>\r\n\r\n          <mat-form-field fxFlexFill>\r\n            <input matInput placeholder="مدت زمان به روز رسانی داده" formControlName="Interval">\r\n          </mat-form-field>\r\n          <div>\r\n            <mat-checkbox formControlName="IsActive" fxFlexFill>وضعیت</mat-checkbox>\r\n          </div>\r\n        </mat-card-content>\r\n      </form>\r\n    </mat-card>\r\n\r\n    <mat-card fxLayout="column" fxFlex="20">\r\n      <mat-card-content fxLayout="column">\r\n        <div>\r\n          <button fxFlex mat-raised-button color="primary" (click)="getData()">ساختار دیتا</button>\r\n        </div>\r\n        <div class="item-margin">\r\n          \x3c!-- TODO: --\x3e\r\n          \x3c!-- <data-mapper destination="value" [data]="data"></data-mapper> --\x3e\r\n        </div>\r\n      </mat-card-content>\r\n    </mat-card>\r\n\r\n    <mat-card fxLayout="column" fxFlex="30">\r\n      <mat-card-content fxLayout="column">\r\n        <div fxLayout="column" fxLayoutGap="5px">\r\n          <div *ngFor="let threshold of thresholds; let i=index" fxFlex="100" class="add-item">\r\n            <div fxLayout="column">\r\n              <div [formGroup]="thresholds[i]" fxLayout="column">\r\n                <mat-form-field fxFlexFill>\r\n                  <input matInput placeholder="نام" formControlName="Name">\r\n                </mat-form-field>\r\n                <mat-form-field fxFlexFill>\r\n                  <input class="ltr" matInput placeholder="فرمول" formControlName="Formula">\r\n                </mat-form-field>\r\n                <mat-form-field fxFlexFill>\r\n                  <input matInput placeholder="توضیح" formControlName="Message">\r\n                </mat-form-field>\r\n                <mat-radio-group formControlName="Type" fxFlexFill>\r\n                  <label>نوع :</label>\r\n                  <mat-radio-button *ngFor="let item of types" [value]="item" class="form-element-margin">\r\n                    {{item}}\r\n                  </mat-radio-button>\r\n                </mat-radio-group>\r\n\r\n                <button (click)="removeItem(i)" fxFlex mat-button color="primary" type="button">پاک کردن</button>\r\n              </div>\r\n              <br />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class="item-margin">\r\n          <button (click)="addItem()" fxFlex mat-raised-button color="primary" type="button">افزودن آستانه</button>\r\n        </div>\r\n      </mat-card-content>\r\n    </mat-card>\r\n  </div>\r\n  <div fxFlex="100">\r\n    <mat-card fxLayoutAlign="end center" fxLayout="row" fxFlex="100">\r\n      <mat-card-content>\r\n        <button mat-raised-button fxFlex color="primary" (click)="add($event)">ثبت</button>\r\n        <button fxFlex mat-raised-button routerLink=\'/source\'  fxLayoutGap="5px">انصراف</button>\r\n      </mat-card-content>\r\n    </mat-card>\r\n  </div>\r\n</div>\r\n',styles:["mat-card{margin:5px}.add-item{border:1px solid #eaeaea;padding:10px;margin:5px 0}.item-margin{margin-top:10px}button[type=submit]{margin-left:5px}.ltr{direction:ltr}.form-element-margin{margin:5px 10px}"]}]}],t.ctorParameters=function(){return[{type:A},{type:s.FormBuilder},{type:x.ActivatedRoute},{type:l.Store}]},t}(),T=[{path:"source",component:E,children:[{path:"",component:k},{path:"edit/:id",component:G},{path:"add",component:G}]}],B=x.RouterModule.forChild(T),N=function(){function t(t,r,e){var o=this;this.actions$=t,this.router=r,this.sourceService=e,this.afterSubmitSource$=this.actions$.pipe(m.ofType(b),h.pluck("payload"),h.switchMap(function(t){return o.sourceService.upsertSource(t).pipe(h.map(function(t){return new I}),h.catchError(function(){return p.of(new S)}))})),this.SigninSucceed$=this.actions$.pipe(m.ofType(F),h.switchMap(function(){return o.router.navigate(["source"]),f.Observable.empty()}))}return t.decorators=[{type:d.Injectable}],t.ctorParameters=function(){return[{type:m.Actions},{type:x.Router},{type:A}]},v([m.Effect(),g("design:type",Object)],t.prototype,"afterSubmitSource$",void 0),v([m.Effect(),g("design:type",Object)],t.prototype,"SigninSucceed$",void 0),t}(),P=function(){function t(){}return t.decorators=[{type:d.NgModule,args:[{imports:[r.CommonModule,x.RouterModule,s.FormsModule,s.ReactiveFormsModule,u.HttpClientModule,e.FlexLayoutModule,o.MatIconModule,o.MatButtonModule,o.MatCardModule,o.MatSnackBarModule,o.MatSidenavModule,o.MatExpansionModule,o.MatSelectModule,o.MatFormFieldModule,o.MatListModule,o.MatMenuModule,o.MatCheckboxModule,o.MatRadioModule,o.MatInputModule,o.MatToolbarModule,o.MatDatepickerModule,o.MatProgressBarModule,n.BrowserModule,l.StoreModule.forFeature("source",L),a.BrowserAnimationsModule,B,m.EffectsModule.forFeature([N]),i.SharedModule],declarations:[k,G,E],exports:[]}]}],t}();t.SourceModule=P,t.ɵi=N,t.ɵa=L,t.ɵb=j,t.ɵe=A,t.ɵf=k,t.ɵd=E,t.ɵg=G,t.ɵc=B,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=soushians-source.umd.min.js.map